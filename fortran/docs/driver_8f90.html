<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dice Fortran Backend Documentation: repo/src/driver.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dice Fortran Backend Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('driver_8f90.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">driver.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="driver_8f90_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memItemLeft" align="right" valign="top">program&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="driver_8f90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">main</a></td></tr>
<tr class="memdesc:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main program, contains the driver subroutine that runs all other code.  <a href="driver_8f90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">More...</a><br /></td></tr>
<tr class="separator:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae94725eafaedc467ab9bfefcae9769e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="driver_8f90.html#aae94725eafaedc467ab9bfefcae9769e">driver</a> ()</td></tr>
<tr class="memdesc:aae94725eafaedc467ab9bfefcae9769e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine for running the main code (needed for Doxygen compatability).  <a href="driver_8f90.html#aae94725eafaedc467ab9bfefcae9769e">More...</a><br /></td></tr>
<tr class="separator:aae94725eafaedc467ab9bfefcae9769e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a8ec2266d83cd6c0b762cbcbc92c0af3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ec2266d83cd6c0b762cbcbc92c0af3d">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">program main</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main program, contains the driver subroutine that runs all other code. </p>
<p>Packaged as a separate subroutine within this program so that it remains compatible with Doxygen, which otherwise ignores any further documentation. </p>

<p class="definition">Definition at line <a class="el" href="driver_8f90_source.html#l00014">14</a> of file <a class="el" href="driver_8f90_source.html">driver.f90</a>.</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph.png" border="0" usemap="#adriver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph" alt=""/></div>
<map name="adriver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph" id="adriver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph">
<area shape="rect" title="Main program, contains the driver subroutine that runs all other code." alt="" coords="5,461,56,488"/>
<area shape="rect" href="driver_8f90.html#aae94725eafaedc467ab9bfefcae9769e" title="Subroutine for running the main code (needed for Doxygen compatability)." alt="" coords="104,461,159,488"/>
<area shape="rect" href="namespacevqmc.html#a70dc752a6b037f137c1264dd8753bac2" title="Automatically finds the best variational parameter &#160;for the &#160;problem at a given bond length." alt="" coords="246,56,359,83"/>
<area shape="rect" href="namespacevqmc.html#a0a07ef5b098cdc478b253de26c49aadc" title="Automatically finds the best variational parameter &#160;for the &#160;problem at given bond length." alt="" coords="231,208,375,235"/>
<area shape="rect" href="namespacevqmc.html#ab066adc59fec1fcaaba764a46128c935" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="245,107,360,133"/>
<area shape="rect" href="namespacevqmc.html#a169c06cb168984ca6285231ad80a0243" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="229,259,376,285"/>
<area shape="rect" href="namespacevqmc.html#a5d73324fcbe9c3ef7fe11309581af529" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="245,360,360,387"/>
<area shape="rect" href="namespacevqmc.html#a08bc46270707aab6c2d5114b589c176c" title="Performs a grid search to find the optimal value for the variational parameter &#160;in the &#160;problem." alt="" coords="248,5,357,32"/>
<area shape="rect" href="namespacevqmc.html#a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb" title="Performs a grid search to find the optimal value for the variational parameter &#160;in the &#160;problem." alt="" coords="233,157,373,184"/>
<area shape="rect" href="namespacevqmc.html#a726aff689b64924586b655d2e8a846d1" title="Performs VQMC on an array of values for the variational parameter ." alt="" coords="248,309,357,336"/>
<area shape="rect" href="namespacesolvers.html#a38259c21a02a250a91f45d79e4165742" title="Calculates a value for a given the bond length s by Newton&#45;Raphson iteration." alt="" coords="689,1453,816,1480"/>
<area shape="rect" href="namespacevqmc.html#aed182179994b5465f5466b4d909a764e" title="Initialiser for the random number generator." alt="" coords="248,461,357,488"/>
<area shape="rect" href="namespacevqmc.html#a6b89c5b7a64a3e438695787b90a62359" title="Adaptation of numpy&#39;s linspace function." alt="" coords="699,612,807,639"/>
<area shape="rect" href="namespacerestart__fns.html#a828b3e20a4454d53f3e9f89cb80ba310" title="Reads restart files with energies, variances and acceptence arrays." alt="" coords="217,579,388,605"/>
<area shape="rect" href="namespacerestart__fns.html#aa562723430cab2682d10733e3a48bb7d" title="Reads restart files with energies, variances and acceptence arrays. Also reads two extra arrays of op..." alt="" coords="207,629,399,656"/>
<area shape="rect" href="namespacerestart__fns.html#a22e2a14111f6a4ff686f7f7b2b47f206" title="Reads restart files with energies, variances and acceptence arrays. Also reads one extra array of opt..." alt="" coords="217,513,388,554"/>
<area shape="rect" href="namespaceinput__parser.html#a3c35b8a909f420e7aa4f19d1392d74ea" title="Main input parser function that reads the input file params.txt and calls the required namelist parse..." alt="" coords="241,681,365,722"/>
<area shape="rect" href="namespacetesting.html#a426ebe0ada45b0bc1c4ebba3f469a5c6" title="Runs all of the unit tests, reporting successes and failures." alt="" coords="241,1248,365,1275"/>
<area shape="rect" href="namespacewrite__netcdf.html#a8d49ffe8b78e85c17f3127d8dc89a83b" title="Output results of H2 MCMC run." alt="" coords="239,1939,366,1981"/>
<area shape="rect" href="namespacewrite__netcdf.html#a4bf61fdf7f8ca9add5bb9b1663906542" title="Output results of H2plus MCMC run." alt="" coords="239,1874,366,1915"/>
<area shape="rect" href="namespacerestart__fns.html#a08fcc6eaab415d68620bccc8048b610e" title="Writes the restart file res_nml.txt, using the current states of simulation variables." alt="" coords="243,2005,362,2046"/>
<area shape="rect" href="namespacevqmc.html#a12f60b20a934a7eb8c6e3cdaaac0b1cc" title="Performs VQMC for the &#160;system." alt="" coords="484,56,604,83"/>
<area shape="rect" href="namespacevqmc.html#a8213f95bb390d7a9eff8260f527c00b8" title="Performs VQMC for the &#160;system." alt="" coords="469,208,619,235"/>
<area shape="rect" href="namespacevqmc.html#a05315751002a983c9976851c9f21f0f0" title="Performs VQMC for the QHO system." alt="" coords="484,335,604,361"/>
<area shape="rect" href="namespacerestart__fns.html#a23054262d0eeb017dee69fd5f9ca1250" title="Checks error status at each point of the NetCDF read." alt="" coords="486,462,602,503"/>
<area shape="rect" href="namespaceinput__parser.html#a17a93a7f5e509724de92cf330dbc597a" title="Reads the CONTROL namelist in params.txt and assigns its data to the corresponding global variables d..." alt="" coords="482,579,606,621"/>
<area shape="rect" href="namespaceinput__parser.html#a163a65b1b9201a421da32ba2a7c92148" title="Reads the PARAMETER namelist in params.txt for the H2 molecule system. Assigns the input data to the ..." alt="" coords="471,645,617,672"/>
<area shape="rect" href="namespaceinput__parser.html#a3ebe204fa7f63e19fbf29c36f580ee74" title="Reads the PARAMETER namelist in params.txt for the H2 ion system. Assigns the input data to the corre..." alt="" coords="482,697,606,738"/>
<area shape="rect" href="namespaceinput__parser.html#aa9a77c1395d69d54ce38420acdb3f87f" title="Reads the PARAMETER namelist in params.txt for the QHO system. Assigns the input data to the correspo..." alt="" coords="468,763,620,789"/>
<area shape="rect" href="namespacerestart__fns.html#a34c01a8b391a8c3a4ba40e9f5ec644d3" title="Reads the RESTART namelist in res_nml.txt. Assigns the input data to the corresponding variables in t..." alt="" coords="460,528,628,555"/>
<area shape="rect" href="namespacetesting.html#a12c0e6c6469c658e1bd6b30e9fc3f5da" title="Tests the H1s_wfn function in the solvers module." alt="" coords="471,1504,617,1531"/>
<area shape="rect" href="namespacetesting.html#abe0f62bb50fbee5f3ebd52fcd43bf1e6" title="Tests the H2s_wfn function in the solvers module." alt="" coords="471,1555,617,1581"/>
<area shape="rect" href="namespacetesting.html#ade975131820e8f24948af289d5ad3879" title="Tests the H_2_cusp function in the solvers module." alt="" coords="468,1067,620,1093"/>
<area shape="rect" href="namespacetesting.html#a313d78f649070a104e89a7535811d6a5" title="Tests the H_2_Energy function in the solvers module." alt="" coords="463,1605,625,1632"/>
<area shape="rect" href="namespacetesting.html#a95de4751adddb42c59a3c44f9076db8d" title="Tests the H_2_plus_Energy function in the solvers module." alt="" coords="470,1657,618,1698"/>
<area shape="rect" href="namespacetesting.html#a15f3412ac40e1145572a5269c6f1b971" title="Tests the H_2_plus_Prob function in the solvers module." alt="" coords="454,1723,634,1749"/>
<area shape="rect" href="namespacetesting.html#a80e1436c4713c7cbaaf1e7caf11ad79c" title="Tests the H_2_plus_update_c function in the solvers module." alt="" coords="470,1774,618,1815"/>
<area shape="rect" href="namespacetesting.html#ad1d0b5a5ff6ea4b8b8f29cc2a0e1982a" title="Tests the H_2_plus_wfn function in the solvers module." alt="" coords="456,864,632,891"/>
<area shape="rect" href="namespacetesting.html#ad02da7e5d742236c571c965b4f80992c" title="Tests the H_2_Prob function in the solvers module." alt="" coords="469,915,619,941"/>
<area shape="rect" href="namespacetesting.html#a068ba31ebf16e82a5baf606a38511048" title="Tests the H_2_update_beta function in the solvers module." alt="" coords="447,965,641,992"/>
<area shape="rect" href="namespacetesting.html#a70f58338fe8165f65417781dae734e68" title="Tests the H_2_wfn function in the solvers module." alt="" coords="471,1016,617,1043"/>
<area shape="rect" href="namespacetesting.html#a5fce9aca0a9c6be18a50bdb72c2facb1" title="Tests the linspace function in the vqmc module." alt="" coords="472,813,616,840"/>
<area shape="rect" href="namespacetesting.html#a55374b3e27ef78754002549b1b423118" title="Tests the QHO_Energy function in the solvers module." alt="" coords="463,1117,625,1144"/>
<area shape="rect" href="namespacetesting.html#a3cd96e3cb653762262d063e2aed44ab7" title="Tests the QHO_Prob function in the solvers module." alt="" coords="469,1168,619,1195"/>
<area shape="rect" href="namespacetesting.html#adb38a97b7ceaad408410367f1510e997" title="Tests the ran1 function in the vqmc module." alt="" coords="483,1219,605,1245"/>
<area shape="rect" href="namespacetesting.html#acbf13e7eaa077016d7d1712b58fc5223" title="Tests the random_normal function in the vqmc module." alt="" coords="475,1270,613,1311"/>
<area shape="rect" href="namespacetesting.html#a2899caabc4df5d19bd020a37ff17eb51" title="Tests the VQMC_H_2 function in the vqmc module." alt="" coords="466,1336,622,1363"/>
<area shape="rect" href="namespacetesting.html#acc995bb41da9539c11b06377089d74c6" title="Tests the VQMC_H_2_plus function in the vqmc module." alt="" coords="480,1387,608,1429"/>
<area shape="rect" href="namespacetesting.html#addd4dbf88accb481fe96433855e3cb64" title="Tests the VQMC_QHO function in the vqmc module." alt="" coords="466,1453,622,1480"/>
<area shape="rect" href="namespacewrite__netcdf.html#aca2bb13e88c9dbfc7d0027b1bd83d9d0" title="Checks error status at each point of NetCDF file build." alt="" coords="481,1907,607,1949"/>
</map>
</div>

</div>
</div>
<a id="aae94725eafaedc467ab9bfefcae9769e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae94725eafaedc467ab9bfefcae9769e">&#9670;&nbsp;</a></span>driver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine main::driver</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine for running the main code (needed for Doxygen compatability). </p>
<p>The main driver code for the VQMC program. Links all other modules to run VQMC calculations on the Quantum Harmonic Oscillator (QHO), the Hydrogen Molecular Ion (H2plus) and the Hydrogen Molecule (H2).</p>
<p>Reads inputs from a provided input file, either generated by a Python frontend script or handwritten in the Fortran Namelist I/O format. Determines the problem to be solved, then runs VQMC routines. These can be run over a set parameter space, or in the case of the H2plus and H2 problems, can automatically determine the best variational parameter for the current bond length. Outputs results in NetCDF format, to be read by a Python frontend visualisation notebook for analysis.</p>
<p>Also includes extensions to start separate equilibration runs for determining optimal burning/thinning parameters for the Markov chain, and to write the energy traces for each parameter / parameter combination. Also capable of logging the full Markov chain to file (slow, should only be used for debug). </p>

<p class="definition">Definition at line <a class="el" href="driver_8f90_source.html#l00053">53</a> of file <a class="el" href="driver_8f90_source.html">driver.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">! SECTION: Variable Declarations</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: p_arr</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: bonds</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: H2plus_param_c_array</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: H2_param_a_array</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: H2_param_beta_array</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: energies</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: variances</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">    real</span>(real64), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: accept_rates</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keywordtype">    real</span>(real64) :: H2plus_param_c_guess</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keywordtype">    real</span>(real64) :: H2plus_param_c_opt</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keywordtype">    real</span>(real64) :: H2_param_beta_guess</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">    real</span>(real64) :: H2_param_beta_opt</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keywordtype">    real</span>(real64) :: H2_param_a</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keywordtype">    real</span>(real64) :: energy</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keywordtype">    real</span>(real64) :: variance</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keywordtype">    real</span>(real64) :: accept_rate</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">integer</span> :: b, i</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">integer</span> :: logiostat</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">integer</span> :: ierr</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">character(len=1)</span> :: H2plus_c_converged</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">character(len=1)</span> :: H2_beta_converged</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">! SECTION: Initial Setup</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">! Initialise MPI</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">! Initialize MPI</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keyword">call </span>mpi_init(mpierr)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">! Find number of processors and current rank</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">call </span>mpi_comm_size(mpi_comm_world,p,mpierr)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">call </span>mpi_comm_rank(mpi_comm_world,my_rank,mpierr)  </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">! Read the input parameters.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">call </span>read_inputs()</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">! File management from rank 0</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">! Notify user of the system </span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;System: &#39;, A)&quot;</span>) p_system</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>) </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="comment">! Make sure the equilibration output directory exists if needed.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">! There is no simple way to check directory existence that works</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment">! with both ifort and gfortran, so mkdir is just run with stderr</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">! suppressed instead.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">if</span> (run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keyword">call </span>system(<span class="stringliteral">&#39;mkdir ./equil_out 2&gt;/dev/null&#39;</span>)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Dice QMC started in Equilibration Mode&#39;)&quot;</span>)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="comment">! Check step length</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">if</span>(run_steps&gt;max_chain_len) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="keyword">write</span>(*,<span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;A, I7, A&#39;)&quot;</span>) <span class="stringliteral">&#39;WARNING: The program will be slow at writing equilibration files, &amp;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                           &amp;as the requested number of steps exceeds the recommended &amp;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                           &amp;upper limit of &#39;</span>, max_chain_len, <span class="stringliteral">&#39; steps. Refer to the user manual for details.&#39;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keyword">write</span>(*,<span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">! Same directory check as above for write_chains.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> (write_chains) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keyword">call </span>system(<span class="stringliteral">&#39;mkdir ./chains_out 2&gt;/dev/null&#39;</span>)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Dice QMC started in full VQMC mode with additional Markov chain outputting&#39;)&quot;</span>) </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="comment">! Check step length</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">if</span>(run_steps&gt;max_chain_len) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;NOTE: For efficiency, only the first &#39;</span>, max_chain_len,<span class="stringliteral">&#39; entries of the Markov chain &amp;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                               &amp;(after burning and thinning) will be written out to the chains_out folder.&#39;</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                error stop <span class="stringliteral">&quot;Dice QMC cannot be started with both run_equil and write_chains set &amp;</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                &amp;to TRUE. Check your input params.txt and try again.&quot;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment">! Initialise the log file if required.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="comment">! Open the logfile</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keyword">open</span>(logid, file=logfile, status=<span class="stringliteral">&#39;unknown&#39;</span>, access=<span class="stringliteral">&#39;sequential&#39;</span>, &amp;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                form=<span class="stringliteral">&#39;formatted&#39;</span>, iostat=logiostat)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">if</span> (logiostat .ne. 0) <span class="keyword">write</span>(0, *) <span class="stringliteral">&#39;Error opening log file &#39;</span>, logfile</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="comment">! Write program details to logfile</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;*** Dice QMC log file ***&#39;)&quot;</span>) <span class="comment">! include date/time?</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;-------------------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keyword">write</span>(logid, *) <span class="stringliteral">&#39;System: &#39;</span>, p_system</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="comment">! Update log-writer tag for rank 0</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            i_log = .true.</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keywordflow">        endif</span> </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">! If p_system=&#39;test&#39;, run test module.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (trim(p_system)==<span class="stringliteral">&#39;test&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">! Tests need to run on a single processor</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keyword">call </span>unit_tests()</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">! Exit the program</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keyword">call </span>mpi_finalize(mpierr)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keyword">call </span>exit()</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">! If not a test job, setup MPI worksharing.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">! Equilibrations will be run serially on rank 0.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">! For non-equilibration runs:</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">! Split workload for VQMC runs</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        my_steps = run_steps / p <span class="comment">! Integer division</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> (my_rank &lt; (run_steps-(my_steps*p))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            my_steps = my_steps+1</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keywordflow">        endif</span> </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">! Pre-calculate frequently used factors.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        my_size = my_steps/tstep <span class="comment">! Integer division</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keyword">call </span>mpi_reduce(my_size,tot_size,1,mpi_integer,mpi_sum,0,mpi_comm_world,mpierr)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">! Factor representing division by total chain size after burning &amp; thinning</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            per_step = 1.0_real64 / real(tot_size,kind=real64)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="comment">! Factor representing division by number of processors</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            per_proc = 1.0_real64 / real(p,kind=real64)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="comment">! Factor representing division by square of number of processors</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            per_proc2 = per_proc**2</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">! The factor &#39;per_proc&#39; is required on all ranks for auto_grad calculations.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">! To ensure floating point agreement, broadcaste it from rank 0, rather than re-calculating on every rank.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keyword">call </span>mpi_bcast(per_proc,1,mpi_double_precision,0,mpi_comm_world,mpierr)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">! Initialise the random number generator</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">! Run calculations on one processor (rank 0)</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        p = 1</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">if</span>(my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">! Initialise the seed on rank 0</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keyword">call </span>init_ran1() </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="comment">! Update logfile if required</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Initial seed from /dev/urandom: &#39;, I20)&quot;</span>) seed</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="comment">! Ensure auto_params is disabled</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">if</span> (trim(p_system) .eq. <span class="stringliteral">&#39;H2plus&#39;</span> .and. h2plus%auto_params) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                h2plus%auto_params = .false.</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;WARNING: H2plus%auto_params should not be .TRUE. when in Equilibration Mode, disabling...&#39;)&quot;</span>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (trim(p_system) .eq. <span class="stringliteral">&#39;H2&#39;</span> .and. h2%auto_params) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                h2%auto_params = .false.</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;WARNING: H2plus%auto_params should not be .TRUE. when in Equilibration Mode, disabling...&#39;)&quot;</span>)</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">! For non-equil VQMC runs,</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">! Initialise a seed on each MPI rank</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keyword">call </span>init_ran1() </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">! Update logfile if required</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">if</span> (my_rank&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="comment">! Send the seeds to rank 0</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="keyword">call </span>mpi_send(seed,1,mpi_integer,0,tag_seed,mpi_comm_world,mpierr)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="comment">! Write seed of rank=0 to logfile</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Rank &#39;,I2,&#39;. Initial seed from /dev/urandom: &#39;, I20)&quot;</span>) my_rank, seed</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="keywordflow">do</span> ip = 1, p-1</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                    <span class="comment">! Receive seed value from rank=ip</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    <span class="keyword">call </span>mpi_recv(ip_seed,1,mpi_integer,ip,tag_seed,mpi_comm_world,status,mpierr) </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                    <span class="comment">! Write seed of rank=ip to logfile</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Rank &#39;,I2,&#39;. Initial seed from /dev/urandom: &#39;, I20)&quot;</span>) ip, ip_seed</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordflow">                end do</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keywordflow">            endif</span> </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keywordflow">        endif</span> </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keywordflow">    endif</span> </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">! SECTION: VQMC Loops</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">! ---------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">! Execute problem-dependent routines.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">select case</span>(trim(p_system))</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">!   SUBSECTION: Quantum Harmonic Oscillator</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;QHO&#39;</span>)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="comment">! Print out system info.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Doing VQMC runs across &#39;, I3, &#39; parameter(s).&#39;)&quot;</span>) int(qho%alpha(3))</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Steps: &#39;, I10, &#39;, Burn Steps: &#39;, I7, &#39;, Thin Every &#39;, I7, &#39; Steps.&#39;)&quot;</span>) &amp;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    qho%steps, qho%burn_step, qho%thin_step</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="comment">! Set up alpha array.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            p_arr = linspace(qho%alpha(1), qho%alpha(2), qho%alpha(3))</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">if</span>(my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Array of alpha values: &#39;)&quot;</span>)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="keywordflow">do</span> i = 1, int(qho%alpha(3))</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(F12.8)&quot;</span>) p_arr(i)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordflow">                    end do</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">            endif</span> </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="comment">! Main VQMC callers.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">if</span> (run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="comment">! For restarts, input_parser would have already set alpha_start</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    <span class="keyword">call </span>equil_qho(p_arr)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="keywordflow">                endif</span> </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="comment">! Initialise arrays</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="keyword">allocate</span>(energies(int(qho%alpha(3)))); energies(:) = 0.0_real64</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keyword">allocate</span>(variances(int(qho%alpha(3)))); variances(:) = 0.0_real64</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="keyword">allocate</span>(accept_rates(int(qho%alpha(3)))); accept_rates(:) = 0.0_real64</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="comment">! Sort out restarting</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">if</span> (run_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    <span class="comment">! Insert optimised parameters, energies, accept_rates, and variances into arrays</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="keyword">call </span>read_energies(resfile_etot, energies, variances, accept_rates)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keywordflow">                endif</span> </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="comment">! Run the grid evaluation</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keyword">call </span>grid_qho(p_arr, energies, accept_rates, variances)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">!   SUBSECTION: Hydrogen Molecular Ion</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;H2plus&#39;</span>)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="comment">! Initialise arrays</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keyword">allocate</span>(energies(int(h2plus%bond(3))))</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keyword">allocate</span>(variances(int(h2plus%bond(3))))</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keyword">allocate</span>(accept_rates(int(h2plus%bond(3))))</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keyword">allocate</span>(h2plus_param_c_array(int(h2plus%bond(3))))</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="comment">! Print out system info.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Doing VQMC runs across &#39;, I7, &#39; bond lengths.&#39;)&quot;</span>) int(h2plus%bond(3))</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Steps: &#39;, I10, &#39;, Burn Steps: &#39;, I7, &#39;, Thin Every &#39;, &amp;</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                    &amp; I7, &#39; Steps.&#39;)&quot;</span>) h2plus%steps, h2plus%burn_step, h2plus%thin_step</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="comment">! Set up bond length array</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            bonds = linspace(h2plus%bond(1), h2plus%bond(2), h2plus%bond(3))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">if</span> (i_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Array of bond lengths: &#39;)&quot;</span>)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <span class="keywordflow">do</span> i = 1, int(h2plus%bond(3))</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Bond length &#39;, I4, &#39;: &#39;, F7.4)&quot;</span>) i, bonds(i)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keywordflow">                end do</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="comment">! Set up parameter array, if doing a grid search</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">if</span> (h2plus%auto_params .eqv. .false.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                p_arr = linspace(h2plus%c_grid(1), h2plus%c_grid(2), h2plus%c_grid(3))</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordflow">            endif</span> </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">! Update user from rank 0</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">if</span> (h2plus%auto_params .eqv. .false.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Array of c values: &#39;)&quot;</span>)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <span class="keywordflow">do</span> i = 1, int(h2plus%c_grid(3))</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                            <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(F12.8)&quot;</span>) p_arr(i)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordflow">                        end do</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Automatic search across parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Automatic search across parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">! Set starting guess value</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">if</span> ((.not. run_equil) .and. h2plus%auto_params) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="keywordflow">if</span> ( run_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    <span class="keywordflow">if</span> (.not. res%auto) error stop <span class="stringliteral">&#39;Error: Inconsistency in auto_params setting between params.txt and res_nml.txt.&#39;</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    h2plus_param_c_guess = res%guess</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                    h2plus_param_c_guess = h2plus%c</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="comment">! Set up printed output for the loop.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;------------------ Begin VQMC Runs ------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Bond Length    Converged?    Optimised c       Energy&#39;)&quot;</span>)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;------------------ Begin VQMC Runs ------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <span class="comment">! Loop over bond lengths</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">do</span> b = bond_start, int(h2plus%bond(3))</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="comment">! Store bond index for restart writing</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                i_bond = b</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                <span class="keywordflow">if</span> (i_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;  ------------- Bond Length = &#39;, F7.4, &#39; -------------  &#39;)&quot;</span>) &amp;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        bonds(b)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="comment">! Main VQMC callers</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    <span class="comment">! Sort out restarting</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                    <span class="keywordflow">if</span> (run_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        <span class="comment">! Insert optimised parameters, energies, accept_rates, and variances into arrays</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        <span class="keyword">call </span>read_energies_h2plus(resfile_etot, energies, variances, accept_rates,h2plus_param_c_array)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordflow">                    endif</span> </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    <span class="keywordflow">if</span> (h2plus%auto_params) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        <span class="comment">! Search for best param at this bond length</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        <span class="keyword">call </span>auto_h_2_plus(h2plus_param_c_guess, bonds(b), h2plus_param_c_opt, &amp;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        energy, variance, accept_rate, h2plus_c_converged)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        <span class="comment">! Reset start counter</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                        auto_start=1</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                        <span class="comment">! Use current optimised value of c as guess for next bond length&#39;s c,</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                        <span class="comment">! provided calculations converged this loop</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        <span class="keywordflow">if</span> (h2plus_c_converged .eq. <span class="stringliteral">&#39;Y&#39;</span>) h2plus_param_c_guess = h2plus_param_c_opt</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        <span class="keywordflow">if</span> (write_restart .and. my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2plus%auto_params,h2plus_param_c_guess)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                            <span class="keyword">call </span>write_h2plus_main(h2plus_param_c_array, bonds, energies, variances, &amp;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        resfile_etot, ierr, h2plus, accept_rates)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">                        endif</span> </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        <span class="comment">! Find best param in grid at this bond length</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <span class="keyword">call </span>grid_h_2_plus(p_arr, bonds(b), h2plus_param_c_opt, energy, &amp;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            variance, accept_rate)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        <span class="comment">! Reset start counter</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                        grid_start=1</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        <span class="keywordflow">if</span> (write_restart .and. my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2plus%auto_params)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                            <span class="keyword">call </span>write_h2plus_main(h2plus_param_c_array, bonds, energies, variances, &amp;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        resfile_etot, ierr, h2plus, accept_rates)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">                        endif</span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    <span class="comment">! Append energy and parameters to arrays, on rank 0</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    <span class="keywordflow">if</span>(my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                        h2plus_param_c_array(b) = h2plus_param_c_opt</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        energies(b) = energy</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        variances(b) = variance</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                        accept_rates(b) = accept_rate</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordflow">                    endif</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                    <span class="comment">! Run equilibrations serially on rank 0</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                        <span class="keyword">call </span>equil_h_2_plus(p_arr, bonds(b), b)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        <span class="keywordflow">if</span> (write_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2plus%auto_params)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordflow">                        endif</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordflow">                    endif</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;------------------- End VQMC Runs -------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="comment">! If not in equilibration mode, write results</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(2A)&quot;</span>) <span class="stringliteral">&#39;Calculations finished, writing results to NetCDF output file &#39;</span>, &amp;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        outfile</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(2A)&quot;</span>) <span class="stringliteral">&#39;Calculations finished, writing results to NetCDF &amp;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                            &amp;output file &#39;</span>, outfile</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    <span class="keyword">call </span>write_h2plus_main(h2plus_param_c_array, bonds, energies, variances, &amp;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        outfile, ierr, h2plus, accept_rates)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">!   SUBSECTION: Hydrogen Molecule</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">! -----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">case</span>(<span class="stringliteral">&#39;H2&#39;</span>)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="comment">! Initialise arrays</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keyword">allocate</span>(energies(int(h2%bond(3))))</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keyword">allocate</span>(variances(int(h2%bond(3))))</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keyword">allocate</span>(accept_rates(int(h2%bond(3))))</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keyword">allocate</span>(h2_param_a_array(int(h2%bond(3))))</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keyword">allocate</span>(h2_param_beta_array(int(h2%bond(3))))</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="comment">! Print out system info.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Doing VQMC runs across &#39;, I7, &#39; bond lengths.&#39;)&quot;</span>) int(h2%bond(3))</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Steps: &#39;, I10, &#39;, Burn Steps: &#39;, I7, &#39;, Thin Every &#39;, I7, &#39; Steps.&#39;)&quot;</span>) &amp;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                        h2%steps, h2%burn_step, h2%thin_step</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="comment">! Set up bond length array</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            bonds = linspace(h2%bond(1), h2%bond(2), h2%bond(3))</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="keywordflow">if</span> (i_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Array of bond lengths: &#39;)&quot;</span>)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <span class="keywordflow">do</span> i = 1, int(h2%bond(3))</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Bond length &#39;, I4, &#39;: &#39;, F7.4)&quot;</span>) i, bonds(i)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordflow">                end do</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="comment">! Set up parameter array, if doing a grid search</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">if</span> (h2%auto_params .eqv. .false.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                p_arr = linspace(h2%beta_grid(1), h2%beta_grid(2), h2%beta_grid(3))</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keywordflow">            endif</span> </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="comment">! Update user from rank 0</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <span class="keywordflow">if</span> (h2%auto_params .eqv. .false.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Grid search across linearly spaced parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Array of beta values: &#39;)&quot;</span>)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <span class="keywordflow">do</span> i = 1, int(h2%beta_grid(3))</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                            <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(F12.8)&quot;</span>) p_arr(i)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keywordflow">                        end do</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Automatic search across parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;Automatic search across parameters enabled.&#39;)&quot;</span>)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="comment">! Set starting guess value</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keywordflow">if</span> ((.not. run_equil) .and. h2%auto_params) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                <span class="keywordflow">if</span> (run_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <span class="keywordflow">if</span> (.not. res%auto) error stop <span class="stringliteral">&#39;Error: Inconsistency in auto_params setting between params.txt and res_nml.txt.&#39;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    h2_param_beta_guess = res%guess</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    h2_param_beta_guess = h2%beta</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="comment">! Set up printed output for the loop.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;------------------ Begin VQMC Runs ------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;Bond Length    Converged?    Optimised Beta    Energy&#39;)&quot;</span>)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="keywordflow">if</span> (i_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;------------------ Begin VQMC Runs ------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="comment">! Loop over bond lengths</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">do</span> b = bond_start, int(h2%bond(3))</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="comment">! Store bond index for restart writing</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                i_bond = b</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="keywordflow">if</span> (i_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(&#39;  ------------- Bond Length = &#39;, F7.4, &#39; -------------  &#39;)&quot;</span>) &amp;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        bonds(b)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="comment">! Calculate parameter a at this bond length by Newton-Raphson iteration.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                h2_param_a = h_2_cusp(bonds(b))</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="comment">! Main VQMC callers</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    <span class="comment">! Sort out restarting</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="keywordflow">if</span> (run_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        <span class="comment">! Insert optimised parameters, energies, accept_rates, and variances into arrays</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        <span class="keyword">call </span>read_energies_h2(resfile_etot, energies, variances, accept_rates,h2_param_a_array,h2_param_beta_array)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordflow">                    endif</span> </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    <span class="comment">! Either iterate through beta values, or automatically search for best beta.</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    <span class="keywordflow">if</span> (h2%auto_params) <span class="keywordflow">then</span> <span class="comment">! ie. if auto searching</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        <span class="comment">! Solve value of beta at this bond length.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                        <span class="keyword">call </span>auto_h_2(h2_param_a, h2_param_beta_guess, bonds(b), h2_param_beta_opt, &amp;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                            energy, variance, accept_rate, h2_beta_converged)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                        <span class="comment">! Use current optimised value of beta as guess for next bond length&#39;s beta,</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        <span class="comment">! provided calculations converged this loop</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                        <span class="keywordflow">if</span> (h2_beta_converged .eq. <span class="stringliteral">&#39;Y&#39;</span>) h2_param_beta_guess = h2_param_beta_opt</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                        <span class="comment">! Reset start counter</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                        auto_start=1</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                        <span class="keywordflow">if</span> (write_restart .and. my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2%auto_params,h2_param_beta_guess)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordflow">                        endif</span> </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                    </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                    <span class="keywordflow">else</span> <span class="comment">! ie. if doing a grid search</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                        <span class="comment">! Get best value of beta at this bond length</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                        <span class="keyword">call </span>grid_h_2(h2_param_a, p_arr, bonds(b), h2_param_beta_opt, energy, &amp;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        variance, accept_rate)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        <span class="comment">! Reset start counter</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                        grid_start=1</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                        <span class="keywordflow">if</span> (write_restart .and. my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2%auto_params)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                            <span class="keyword">call </span>write_h2_main(h2_param_a_array, h2_param_beta_array, bonds, &amp;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        energies, variances, resfile_etot, ierr, h2, accept_rates)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordflow">                        endif</span> </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                        <span class="comment">! Append energy and parameters to arrays</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        h2_param_a_array(b) = h2_param_a</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                        h2_param_beta_array(b) = h2_param_beta_opt</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                        energies(b) = energy</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                        variances(b) = variance</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        accept_rates(b) = accept_rate</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keywordflow">                    endif</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                    <span class="comment">! Run equilibrations</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                    <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                        <span class="keyword">call </span>equil_h_2(h2_param_a, p_arr, bonds(b), b)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                        <span class="comment">! Write restart files, if required</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                        <span class="keywordflow">if</span> (write_restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                            <span class="keyword">call </span>write_res_nml(b+1,1,h2%auto_params)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                            <span class="keyword">call </span>write_h2_main(h2_param_a_array, h2_param_beta_array, bonds, &amp;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                        energies, variances, resfile_etot, ierr, h2, accept_rates)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">                        endif</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordflow">                    endif</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="keywordflow">if</span> (my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;------------------- End VQMC Runs -------------------&#39;)&quot;</span>)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(&#39;&#39;)&quot;</span>)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                <span class="comment">! If not in equilibration mode, write results</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                <span class="keywordflow">if</span> (.not. run_equil) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                    <span class="keyword">write</span>(*, <span class="stringliteral">&quot;(2A)&quot;</span>) <span class="stringliteral">&#39;Calculations finished, writing results to NetCDF output file &#39;</span>, &amp;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                        outfile</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                    <span class="keywordflow">if</span> (write_log) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                        <span class="keyword">write</span>(logid, <span class="stringliteral">&quot;(2A)&quot;</span>) <span class="stringliteral">&#39;Calculations finished, writing results to NetCDF &amp;</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                            &amp;output file &#39;</span>, outfile</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="keywordflow">                    end if</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    <span class="keyword">call </span>write_h2_main(h2_param_a_array, h2_param_beta_array, bonds, &amp;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                        energies, variances, outfile, ierr, h2, accept_rates)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">! Default case, for if none of the cases match. Should be invalidated by checks in input_parser.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordflow">        case default</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            error stop <span class="stringliteral">&#39;Unknown case. How did you get here?&#39;</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">! Close logfile from rank 0</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span> (i_log) <span class="keyword">close</span>(logid)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">! End MPI parallelism</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keyword">call </span>mpi_finalize(mpierr)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="driver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph.png" border="0" usemap="#adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph" alt=""/></div>
<map name="adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph" id="adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph">
<area shape="rect" title="Subroutine for running the main code (needed for Doxygen compatability)." alt="" coords="5,747,60,773"/>
<area shape="rect" href="namespacevqmc.html#a70dc752a6b037f137c1264dd8753bac2" title="Automatically finds the best variational parameter &#160;for the &#160;problem at a given bond length." alt="" coords="147,56,261,83"/>
<area shape="rect" href="namespacevqmc.html#a0a07ef5b098cdc478b253de26c49aadc" title="Automatically finds the best variational parameter &#160;for the &#160;problem at given bond length." alt="" coords="132,208,276,235"/>
<area shape="rect" href="namespacevqmc.html#ab066adc59fec1fcaaba764a46128c935" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="147,107,261,133"/>
<area shape="rect" href="namespacevqmc.html#a169c06cb168984ca6285231ad80a0243" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="131,259,277,285"/>
<area shape="rect" href="namespacevqmc.html#a5d73324fcbe9c3ef7fe11309581af529" title="Performs VQMC on an array of values for the variational parameter , outputting energy traces for each..." alt="" coords="147,360,261,387"/>
<area shape="rect" href="namespacevqmc.html#a08bc46270707aab6c2d5114b589c176c" title="Performs a grid search to find the optimal value for the variational parameter &#160;in the &#160;problem." alt="" coords="149,5,259,32"/>
<area shape="rect" href="namespacevqmc.html#a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb" title="Performs a grid search to find the optimal value for the variational parameter &#160;in the &#160;problem." alt="" coords="134,157,274,184"/>
<area shape="rect" href="namespacevqmc.html#a726aff689b64924586b655d2e8a846d1" title="Performs VQMC on an array of values for the variational parameter ." alt="" coords="149,309,259,336"/>
<area shape="rect" href="namespacesolvers.html#a38259c21a02a250a91f45d79e4165742" title="Calculates a value for a given the bond length s by Newton&#45;Raphson iteration." alt="" coords="591,528,717,555"/>
<area shape="rect" href="namespacevqmc.html#aed182179994b5465f5466b4d909a764e" title="Initialiser for the random number generator." alt="" coords="149,1213,259,1240"/>
<area shape="rect" href="namespacevqmc.html#a6b89c5b7a64a3e438695787b90a62359" title="Adaptation of numpy&#39;s linspace function." alt="" coords="600,1260,708,1287"/>
<area shape="rect" href="namespacerestart__fns.html#a828b3e20a4454d53f3e9f89cb80ba310" title="Reads restart files with energies, variances and acceptence arrays." alt="" coords="119,1264,289,1291"/>
<area shape="rect" href="namespacerestart__fns.html#aa562723430cab2682d10733e3a48bb7d" title="Reads restart files with energies, variances and acceptence arrays. Also reads two extra arrays of op..." alt="" coords="108,1315,300,1341"/>
<area shape="rect" href="namespacerestart__fns.html#a22e2a14111f6a4ff686f7f7b2b47f206" title="Reads restart files with energies, variances and acceptence arrays. Also reads one extra array of opt..." alt="" coords="119,1366,289,1407"/>
<area shape="rect" href="namespaceinput__parser.html#a3c35b8a909f420e7aa4f19d1392d74ea" title="Main input parser function that reads the input file params.txt and calls the required namelist parse..." alt="" coords="142,1461,266,1502"/>
<area shape="rect" href="namespacetesting.html#a426ebe0ada45b0bc1c4ebba3f469a5c6" title="Runs all of the unit tests, reporting successes and failures." alt="" coords="142,747,266,773"/>
<area shape="rect" href="namespacewrite__netcdf.html#a8d49ffe8b78e85c17f3127d8dc89a83b" title="Output results of H2 MCMC run." alt="" coords="141,1591,267,1633"/>
<area shape="rect" href="namespacewrite__netcdf.html#a4bf61fdf7f8ca9add5bb9b1663906542" title="Output results of H2plus MCMC run." alt="" coords="141,1526,267,1567"/>
<area shape="rect" href="namespacerestart__fns.html#a08fcc6eaab415d68620bccc8048b610e" title="Writes the restart file res_nml.txt, using the current states of simulation variables." alt="" coords="145,1657,263,1698"/>
<area shape="rect" href="namespacevqmc.html#a12f60b20a934a7eb8c6e3cdaaac0b1cc" title="Performs VQMC for the &#160;system." alt="" coords="385,56,505,83"/>
<area shape="rect" href="namespacevqmc.html#a01b80444204a0cd0b5cddde82cbc7651" title="Implementation of Press et al&#39;s random number generator." alt="" coords="611,132,697,159"/>
<area shape="rect" href="namespacevqmc.html#a8213f95bb390d7a9eff8260f527c00b8" title="Performs VQMC for the &#160;system." alt="" coords="370,107,521,133"/>
<area shape="rect" href="namespacevqmc.html#a05315751002a983c9976851c9f21f0f0" title="Performs VQMC for the QHO system." alt="" coords="385,157,505,184"/>
<area shape="rect" href="namespacerestart__fns.html#a23054262d0eeb017dee69fd5f9ca1250" title="Checks error status at each point of the NetCDF read." alt="" coords="387,1337,503,1378"/>
<area shape="rect" href="namespaceinput__parser.html#a17a93a7f5e509724de92cf330dbc597a" title="Reads the CONTROL namelist in params.txt and assigns its data to the corresponding global variables d..." alt="" coords="383,1570,507,1611"/>
<area shape="rect" href="namespaceinput__parser.html#a163a65b1b9201a421da32ba2a7c92148" title="Reads the PARAMETER namelist in params.txt for the H2 molecule system. Assigns the input data to the ..." alt="" coords="373,1636,518,1663"/>
<area shape="rect" href="namespaceinput__parser.html#a3ebe204fa7f63e19fbf29c36f580ee74" title="Reads the PARAMETER namelist in params.txt for the H2 ion system. Assigns the input data to the corre..." alt="" coords="383,1402,507,1443"/>
<area shape="rect" href="namespaceinput__parser.html#aa9a77c1395d69d54ce38420acdb3f87f" title="Reads the PARAMETER namelist in params.txt for the QHO system. Assigns the input data to the correspo..." alt="" coords="369,1468,521,1495"/>
<area shape="rect" href="namespacerestart__fns.html#a34c01a8b391a8c3a4ba40e9f5ec644d3" title="Reads the RESTART namelist in res_nml.txt. Assigns the input data to the corresponding variables in t..." alt="" coords="361,1519,529,1545"/>
<area shape="rect" href="namespacetesting.html#a12c0e6c6469c658e1bd6b30e9fc3f5da" title="Tests the H1s_wfn function in the solvers module." alt="" coords="373,1184,518,1211"/>
<area shape="rect" href="namespacetesting.html#abe0f62bb50fbee5f3ebd52fcd43bf1e6" title="Tests the H2s_wfn function in the solvers module." alt="" coords="373,309,518,336"/>
<area shape="rect" href="namespacetesting.html#ade975131820e8f24948af289d5ad3879" title="Tests the H_2_cusp function in the solvers module." alt="" coords="369,848,521,875"/>
<area shape="rect" href="namespacetesting.html#a313d78f649070a104e89a7535811d6a5" title="Tests the H_2_Energy function in the solvers module." alt="" coords="364,360,527,387"/>
<area shape="rect" href="namespacetesting.html#a95de4751adddb42c59a3c44f9076db8d" title="Tests the H_2_plus_Energy function in the solvers module." alt="" coords="371,411,519,453"/>
<area shape="rect" href="namespacetesting.html#a15f3412ac40e1145572a5269c6f1b971" title="Tests the H_2_plus_Prob function in the solvers module." alt="" coords="355,477,535,504"/>
<area shape="rect" href="namespacetesting.html#a80e1436c4713c7cbaaf1e7caf11ad79c" title="Tests the H_2_plus_update_c function in the solvers module." alt="" coords="371,529,519,570"/>
<area shape="rect" href="namespacetesting.html#ad1d0b5a5ff6ea4b8b8f29cc2a0e1982a" title="Tests the H_2_plus_wfn function in the solvers module." alt="" coords="357,595,533,621"/>
<area shape="rect" href="namespacetesting.html#ad02da7e5d742236c571c965b4f80992c" title="Tests the H_2_Prob function in the solvers module." alt="" coords="371,645,520,672"/>
<area shape="rect" href="namespacetesting.html#a068ba31ebf16e82a5baf606a38511048" title="Tests the H_2_update_beta function in the solvers module." alt="" coords="348,696,543,723"/>
<area shape="rect" href="namespacetesting.html#a70f58338fe8165f65417781dae734e68" title="Tests the H_2_wfn function in the solvers module." alt="" coords="373,747,518,773"/>
<area shape="rect" href="namespacetesting.html#a5fce9aca0a9c6be18a50bdb72c2facb1" title="Tests the linspace function in the vqmc module." alt="" coords="373,1235,517,1261"/>
<area shape="rect" href="namespacetesting.html#a55374b3e27ef78754002549b1b423118" title="Tests the QHO_Energy function in the solvers module." alt="" coords="364,797,527,824"/>
<area shape="rect" href="namespacetesting.html#a3cd96e3cb653762262d063e2aed44ab7" title="Tests the QHO_Prob function in the solvers module." alt="" coords="371,899,520,925"/>
<area shape="rect" href="namespacetesting.html#adb38a97b7ceaad408410367f1510e997" title="Tests the ran1 function in the vqmc module." alt="" coords="385,259,506,285"/>
<area shape="rect" href="namespacetesting.html#acbf13e7eaa077016d7d1712b58fc5223" title="Tests the random_normal function in the vqmc module." alt="" coords="376,950,515,991"/>
<area shape="rect" href="namespacetesting.html#a2899caabc4df5d19bd020a37ff17eb51" title="Tests the VQMC_H_2 function in the vqmc module." alt="" coords="367,1016,523,1043"/>
<area shape="rect" href="namespacetesting.html#acc995bb41da9539c11b06377089d74c6" title="Tests the VQMC_H_2_plus function in the vqmc module." alt="" coords="381,1067,509,1109"/>
<area shape="rect" href="namespacetesting.html#addd4dbf88accb481fe96433855e3cb64" title="Tests the VQMC_QHO function in the vqmc module." alt="" coords="367,1133,523,1160"/>
<area shape="rect" href="namespacewrite__netcdf.html#aca2bb13e88c9dbfc7d0027b1bd83d9d0" title="Checks error status at each point of NetCDF file build." alt="" coords="383,1687,508,1729"/>
</map>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="driver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph.png" border="0" usemap="#adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph" alt=""/></div>
<map name="adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph" id="adriver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph">
<area shape="rect" title="Subroutine for running the main code (needed for Doxygen compatability)." alt="" coords="104,5,159,32"/>
<area shape="rect" href="driver_8f90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d" title="Main program, contains the driver subroutine that runs all other code." alt="" coords="5,5,56,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_752f9258976072ab3e06b31dacb87d2d.html">repo</a></li><li class="navelem"><a class="el" href="dir_79e04574ead3dbd7de3bc806ea6ac3aa.html">src</a></li><li class="navelem"><a class="el" href="driver_8f90.html">driver.f90</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
