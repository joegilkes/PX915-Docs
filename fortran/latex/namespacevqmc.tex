\hypertarget{namespacevqmc}{}\doxysection{vqmc Module Reference}
\label{namespacevqmc}\index{vqmc@{vqmc}}


Contains a random number generator, a sub-\/routine that draws from a normal distribution and a VQMC solver for the three different problems.  


\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacevqmc_aed182179994b5465f5466b4d909a764e}{init\+\_\+ran1}} ()
\begin{DoxyCompactList}\small\item\em Initialise random number generator by drawing a seed from /dev/urandom. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}{ran1}} (sample, dseed)
\begin{DoxyCompactList}\small\item\em Implementation of David Quigley\textquotesingle{}s random number generator. \end{DoxyCompactList}\item 
real(real64) function, dimension(\+:), allocatable \mbox{\hyperlink{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}{linspace}} (start, end, num)
\begin{DoxyCompactList}\small\item\em Adaptation of numpy\textquotesingle{}s linspace function. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}{random\+\_\+normal}} (dim, x)
\begin{DoxyCompactList}\small\item\em Draws a sample from a normal distribution. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a05315751002a983c9976851c9f21f0f0}{vqmc\+\_\+qho}} (sigma, N, burn, thin, alpha\+\_\+const, X\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, energy\+\_\+mean, energy\+\_\+variance, x\+\_\+start)
\begin{DoxyCompactList}\small\item\em Performs VQMC for QHO. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a4856736e8ffc45caa57893a6b96318d3}{grid\+\_\+qho}} (alpha\+\_\+array, energies, acc\+\_\+rates)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a5d73324fcbe9c3ef7fe11309581af529}{equil\+\_\+qho}} (alpha\+\_\+array)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a8213f95bb390d7a9eff8260f527c00b8}{vqmc\+\_\+h\+\_\+2\+\_\+plus}} (sigma, N, burn, thin, c\+\_\+const, R\+\_\+a, R\+\_\+b, X\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, energy\+\_\+mean, energy\+\_\+variance, Dphi\+Dc\+\_\+chain, x\+\_\+start)
\begin{DoxyCompactList}\small\item\em Performs VQMC for H\+\_\+2\+\_\+plus ~\newline
 \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a0a07ef5b098cdc478b253de26c49aadc}{auto\+\_\+h\+\_\+2\+\_\+plus}} (c\+\_\+in, bond\+\_\+length, c\+\_\+out, energy\+\_\+out, variance\+\_\+out, accept\+\_\+out, converged)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb}{grid\+\_\+h\+\_\+2\+\_\+plus}} (c\+\_\+array, bond\+\_\+length, c\+\_\+out, energy\+\_\+out, variance\+\_\+out, accept\+\_\+out)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a169c06cb168984ca6285231ad80a0243}{equil\+\_\+h\+\_\+2\+\_\+plus}} (c\+\_\+array, bond\+\_\+length, bonds\+\_\+pos)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a12f60b20a934a7eb8c6e3cdaaac0b1cc}{vqmc\+\_\+h\+\_\+2}} (sigma, N, burn, thin, a, beta, R\+\_\+a, R\+\_\+b, X\+\_\+1\+\_\+burnt, X\+\_\+2\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, energy\+\_\+mean, energy\+\_\+variance, Dphi\+Dbeta\+\_\+chain, x\+\_\+start\+\_\+1, x\+\_\+start\+\_\+2)
\begin{DoxyCompactList}\small\item\em Performs VQMC for H\+\_\+2 ~\newline
 \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a70dc752a6b037f137c1264dd8753bac2}{auto\+\_\+h\+\_\+2}} (a, beta\+\_\+in, bond\+\_\+length, beta\+\_\+out, energy\+\_\+out, variance\+\_\+out, accept\+\_\+out, converged)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_a08bc46270707aab6c2d5114b589c176c}{grid\+\_\+h\+\_\+2}} (a, beta\+\_\+array, bond\+\_\+length, beta\+\_\+out, energy\+\_\+out, variance\+\_\+out, accept\+\_\+out)
\item 
subroutine \mbox{\hyperlink{namespacevqmc_ab066adc59fec1fcaaba764a46128c935}{equil\+\_\+h\+\_\+2}} (a, beta\+\_\+array, bond\+\_\+length, bonds\+\_\+pos)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
integer, parameter \mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}} = 32
\item 
integer(int64), dimension(\mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}}), save \mbox{\hyperlink{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}{iv}} = 0
\item 
integer(int64), save \mbox{\hyperlink{namespacevqmc_a1608372d703310a49afc4243ccf27368}{iy}} = 0
\item 
integer(int64), public \mbox{\hyperlink{namespacevqmc_a986f071589794992c4bc31de25c63976}{seed}}
\item 
integer \mbox{\hyperlink{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}{logfrac}} = 10
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Contains a random number generator, a sub-\/routine that draws from a normal distribution and a VQMC solver for the three different problems. 

Module contains the VQMC solver for quantum harmonic oscillator (QHO), hydrogen ion (H\+\_\+2\+\_\+plus) and hydrogen molecule (H\+\_\+2). It also has the sub\+\_\+routine random normal which generates a sample from a normal distribution using the Box-\/\+Muller transfrom, which is needed for the Metropolis algorythm used in VQMC. The VQMC solvers uses the module \textquotesingle{}solvers\textquotesingle{} to obtain the transitional probabilities needed for the Metropolis algorythm and to calculate the local energies given the position of the random walker. 

\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacevqmc_aed182179994b5465f5466b4d909a764e}\label{namespacevqmc_aed182179994b5465f5466b4d909a764e}} 
\index{vqmc@{vqmc}!init\_ran1@{init\_ran1}}
\index{init\_ran1@{init\_ran1}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{init\_ran1()}{init\_ran1()}}
{\footnotesize\ttfamily subroutine vqmc\+::init\+\_\+ran1}



Initialise random number generator by drawing a seed from /dev/urandom. 



Definition at line 60 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{61 }
\DoxyCodeLine{62         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64         \textcolor{keywordtype}{integer} :: fu, rc, l\_seed}
\DoxyCodeLine{65         \textcolor{keywordtype}{character(len=30)} :: c\_seed}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \textcolor{keyword}{open} (access=\textcolor{stringliteral}{'stream'}, action=\textcolor{stringliteral}{'read'}, file=\textcolor{stringliteral}{'/dev/urandom'}, \&}
\DoxyCodeLine{68         form=\textcolor{stringliteral}{'unformatted'}, iostat=rc, newunit=fu)}
\DoxyCodeLine{69 }
\DoxyCodeLine{70         \textcolor{keywordflow}{if} (rc == 0) \textcolor{keyword}{read} (fu) seed}
\DoxyCodeLine{71 }
\DoxyCodeLine{72         \textcolor{keyword}{close} (fu)}
\DoxyCodeLine{73 }
\DoxyCodeLine{74         \textcolor{keyword}{write}(c\_seed, \textcolor{stringliteral}{"{}(I30)"{}}) seed}
\DoxyCodeLine{75         l\_seed = len(c\_seed)}
\DoxyCodeLine{76         c\_seed = adjustl(c\_seed)}
\DoxyCodeLine{77         c\_seed = c\_seed(7:l\_seed)}
\DoxyCodeLine{78         \textcolor{keyword}{read}(c\_seed, *) seed}
\DoxyCodeLine{79 }
\DoxyCodeLine{80         \textcolor{keywordflow}{if} (seed .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{81             seed = -\/seed}
\DoxyCodeLine{82 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{85             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Initial seed from /dev/urandom: ', I20)"{}}) seed}
\DoxyCodeLine{86             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{87 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{88 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=313pt]{namespacevqmc_aed182179994b5465f5466b4d909a764e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}\label{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}} 
\index{vqmc@{vqmc}!ran1@{ran1}}
\index{ran1@{ran1}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{ran1()}{ran1()}}
{\footnotesize\ttfamily subroutine vqmc\+::ran1 (\begin{DoxyParamCaption}\item[{real(real64), intent(out)}]{sample,  }\item[{integer(int64), intent(inout)}]{dseed }\end{DoxyParamCaption})}



Implementation of David Quigley\textquotesingle{}s random number generator. 

Variable dseed must be a negative integer. 

Definition at line 103 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{104 }
\DoxyCodeLine{105         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{intent(inout)} :: dseed}
\DoxyCodeLine{108 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: sample}
\DoxyCodeLine{109 }
\DoxyCodeLine{110         \textcolor{comment}{! Constants defined in Press et al}}
\DoxyCodeLine{111         \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{parameter} :: ia = 16807, im = 2147483647, iq = 1\textcolor{comment}{27773}}
\DoxyCodeLine{112 \textcolor{comment}{}        \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{parameter} :: ir = 2836, \&}
\DoxyCodeLine{113                                      ndiv = 1 + floor((real(im, kind=real64\textcolor{comment}{)-\/1.0)/ntab)}}
\DoxyCodeLine{114 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{parameter} :: am = 1.0/real(im, kind=real64), eps =\textcolor{comment}{ 1.2e-\/7, \&}}
\DoxyCodeLine{115 \textcolor{comment}{}                                   rnmx = 1.0-\/eps}
\DoxyCodeLine{116 }
\DoxyCodeLine{117         \textcolor{comment}{! Loop counters}}
\DoxyCodeLine{118         \textcolor{keywordtype}{integer(int64)} :: j, k}
\DoxyCodeLine{119 }
\DoxyCodeLine{120         \textcolor{comment}{! The following is transcribed directly from Press et al}}
\DoxyCodeLine{121         \textcolor{keywordflow}{if} (dseed<=0 .or. iy==0) \textcolor{keywordflow}{then} \textcolor{comment}{! initialization}}
\DoxyCodeLine{122                                       \textcolor{comment}{! NB this may need to be modified to allow for restarting as iy will be 0}}
\DoxyCodeLine{123             dseed = max(-\/dseed,1)}
\DoxyCodeLine{124 }
\DoxyCodeLine{125             \textcolor{keywordflow}{do} j = ntab+8, 1, -\/1}
\DoxyCodeLine{126                 k = floor(real(dseed, kind=real64)/real(iq, kind=real64)\textcolor{comment}{)}}
\DoxyCodeLine{127 \textcolor{comment}{}                dseed = ia * (dseed-\/k*iq) -\/ ir * k}
\DoxyCodeLine{128                 \textcolor{keywordflow}{if} (dseed < 0) dseed = dseed + im}
\DoxyCodeLine{129                 \textcolor{keywordflow}{if} (j <= ntab) iv(j) = dseed}
\DoxyCodeLine{130 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132             iy = iv(1)}
\DoxyCodeLine{133 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135         k = floor(real(dseed, kind=real64)/real(iq, kind=real64))}
\DoxyCodeLine{136         dseed = ia * (dseed-\/k*iq) -\/ ir * k}
\DoxyCodeLine{137         \textcolor{keywordflow}{if} (dseed < 0) dseed = dseed + im}
\DoxyCodeLine{138         j = 1\_int64 + iy / ndiv}
\DoxyCodeLine{139         iy = iv(j)}
\DoxyCodeLine{140         iv(j) = dseed}
\DoxyCodeLine{141         sample = min(am*iy, rnmx)}
\DoxyCodeLine{142 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}\label{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}} 
\index{vqmc@{vqmc}!linspace@{linspace}}
\index{linspace@{linspace}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{linspace()}{linspace()}}
{\footnotesize\ttfamily real(real64) function, dimension(\+:), allocatable vqmc\+::linspace (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{start,  }\item[{real(real64), intent(in)}]{end,  }\item[{real(real64), intent(in)}]{num }\end{DoxyParamCaption})}



Adaptation of numpy\textquotesingle{}s linspace function. 

Uses a REAL value for num for compatbility with parameter arrays, then converts to int internally. Returns a length 1 array just containing the start value if num is equal to 1. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em start} & Starting value of the sequence \\
\hline
\mbox{\texttt{ in}}  & {\em end} & End value of the sequence \\
\hline
\mbox{\texttt{ in}}  & {\em num} & Number of samples to generate between start and end value ~\newline
 \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em ls\+\_\+array} & An array with evenly specified numbers over an interval \\
\hline
\end{DoxyRetVals}


Definition at line 167 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{168 }
\DoxyCodeLine{169         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: start, end, num}
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: ls\_array}
\DoxyCodeLine{174 }
\DoxyCodeLine{175         \textcolor{keywordtype}{integer} :: inum                                         \textcolor{comment}{! The integer type of num}}
\DoxyCodeLine{176         \textcolor{keywordtype}{integer} :: i                                            \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{177 \textcolor{keywordtype}{        real}(real64) :: step                                    \textcolor{comment}{! Spacing between two numbers in the array}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179         \textcolor{comment}{! Handle real value for num}}
\DoxyCodeLine{180         inum = int(num)}
\DoxyCodeLine{181         \textcolor{comment}{! Handle single values}}
\DoxyCodeLine{182         \textcolor{keywordflow}{if} (inum .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{183             \textcolor{keyword}{allocate}(ls\_array(inum))}
\DoxyCodeLine{184             ls\_array(1) = start}
\DoxyCodeLine{185         \textcolor{comment}{! Handle multiple values}}
\DoxyCodeLine{186         \textcolor{keywordflow}{else}}
\DoxyCodeLine{187             \textcolor{comment}{! Generate array}}
\DoxyCodeLine{188             \textcolor{keyword}{allocate}(ls\_array(inum))}
\DoxyCodeLine{189             \textcolor{comment}{! Find step size}}
\DoxyCodeLine{190             step = (\textcolor{keyword}{end }-\/ start) / real(inum-\/1, kind=real64)}
\DoxyCodeLine{191             \textcolor{comment}{! Fill array}}
\DoxyCodeLine{192             \textcolor{keywordflow}{do} i = 1, inum}
\DoxyCodeLine{193                 ls\_array(i) = start + (i-\/1)*step}
\DoxyCodeLine{194 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{195 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{196 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=312pt]{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}\label{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}} 
\index{vqmc@{vqmc}!random\_normal@{random\_normal}}
\index{random\_normal@{random\_normal}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{random\_normal()}{random\_normal()}}
{\footnotesize\ttfamily subroutine vqmc\+::random\+\_\+normal (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{dim,  }\item[{real(real64), dimension(\+:), intent(out)}]{x }\end{DoxyParamCaption})}



Draws a sample from a normal distribution. 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em dim} & The dimension of the random vector \\
\hline
\mbox{\texttt{ out}}  & {\em x} & The sample from the normal distribution \\
\hline
\end{DoxyParams}


Definition at line 213 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{214         }
\DoxyCodeLine{215         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{216 }
\DoxyCodeLine{217         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: dim}
\DoxyCodeLine{218 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)} :: x }
\DoxyCodeLine{219         }
\DoxyCodeLine{220 \textcolor{keywordtype}{        real}(real64) :: u\_1, u\_2                        \textcolor{comment}{! Samples from uniform distribution }}
\DoxyCodeLine{221         \textcolor{keywordtype}{integer} :: i                                    \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{222 }
\DoxyCodeLine{223         \textcolor{comment}{! Generate vector containg samples from normal distributions }}
\DoxyCodeLine{224         \textcolor{keywordflow}{do} i = 1, dim}
\DoxyCodeLine{225             \textcolor{comment}{! This can be done the Fortran intrinsic random number generator but this }}
\DoxyCodeLine{226             \textcolor{comment}{! is not a good random number generator }}
\DoxyCodeLine{227             \textcolor{comment}{! call random\_number(u\_1)}}
\DoxyCodeLine{228             \textcolor{comment}{! call random\_number(u\_2)}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230             \textcolor{comment}{! Draws from uniform distribution}}
\DoxyCodeLine{231             \textcolor{keyword}{call }ran1(u\_1, seed)}
\DoxyCodeLine{232             \textcolor{keyword}{call }ran1(u\_2, seed)}
\DoxyCodeLine{233 }
\DoxyCodeLine{234             \textcolor{comment}{! Calculate the sample from the normal distribution using the Box-\/Muller transform }}
\DoxyCodeLine{235             x(i) = sqrt(-\/2*log(u\_1))*cos(2*pi*u\_2)}
\DoxyCodeLine{236 \textcolor{keywordflow}{        end do} }
\DoxyCodeLine{237 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=292pt]{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a05315751002a983c9976851c9f21f0f0}\label{namespacevqmc_a05315751002a983c9976851c9f21f0f0}} 
\index{vqmc@{vqmc}!vqmc\_qho@{vqmc\_qho}}
\index{vqmc\_qho@{vqmc\_qho}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_qho()}{vqmc\_qho()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+qho (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), intent(in)}]{alpha\+\_\+const,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{X\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), intent(out)}]{energy\+\_\+mean,  }\item[{real(real64), intent(out)}]{energy\+\_\+variance,  }\item[{real(real64), optional}]{x\+\_\+start }\end{DoxyParamCaption})}



Performs VQMC for QHO. 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em alpha\+\_\+const} & Parameter \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start} & Starting point of MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+burnt} & The burnt and thinned MCMC chain for the random walker \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energies of the each points in the MCMC chain \\
\hline
\end{DoxyParams}


Definition at line 265 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{267 }
\DoxyCodeLine{268         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{269 }
\DoxyCodeLine{270 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma, alpha\_const}
\DoxyCodeLine{271         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{272 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{optional} :: x\_start }
\DoxyCodeLine{273          }
\DoxyCodeLine{274 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate, energy\_mean, energy\_variance}
\DoxyCodeLine{275 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: X\_burnt,\textcolor{comment}{ energy\_chain }}
\DoxyCodeLine{276 \textcolor{comment}{        }}
\DoxyCodeLine{277 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                      \textcolor{comment}{! The natural logarithm of the transition probability}}
\DoxyCodeLine{278 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                    \textcolor{comment}{! Acceptance ratio of the transition probability }}
\DoxyCodeLine{279 \textcolor{keywordtype}{        real}(real64) :: unif\_num                        \textcolor{comment}{! A random sample from the uniform distribution }}
\DoxyCodeLine{280 \textcolor{keywordtype}{        real}(real64) :: energy2\_mean}
\DoxyCodeLine{281 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: start             \textcolor{comment}{! The starting point of the MCMC chain }}
\DoxyCodeLine{282 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: X\_n               \textcolor{comment}{! The proposed step }}
\DoxyCodeLine{283 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: sample\_normal     \textcolor{comment}{! A sample from the normal distribution }}
\DoxyCodeLine{284 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: X    \textcolor{comment}{! Non-\/burnt or thinned MCMC chain}}
\DoxyCodeLine{285         \textcolor{keywordtype}{integer} :: thin\_counter                         \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{286         \textcolor{keywordtype}{integer} :: reset\_counter                        \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{287         \textcolor{keywordtype}{integer} :: accept                               \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{288         \textcolor{keywordtype}{integer} :: i                                    \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{289         \textcolor{keywordtype}{integer} :: i\_bt                                 \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{290         \textcolor{keywordtype}{integer} :: re\_size                              \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{291         \textcolor{keywordtype}{character(len=1)} :: acceptance                  \textcolor{comment}{! Yes/No signpost for acceptance}}
\DoxyCodeLine{292 }
\DoxyCodeLine{293         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{294         re\_size = (n -\/ burn) / thin}
\DoxyCodeLine{295         }
\DoxyCodeLine{296         \textcolor{keyword}{allocate}(x(1: n+1)); x(:) = 0.0\_real64}
\DoxyCodeLine{297         \textcolor{keyword}{allocate}(x\_burnt(1: re\_size +1)); x\_burnt(:) = 0.0\_real64}
\DoxyCodeLine{298         \textcolor{keyword}{allocate}(energy\_chain(1: re\_size + 1)); energy\_chain(:) = 0.0\_real64}
\DoxyCodeLine{299         }
\DoxyCodeLine{300         \textcolor{comment}{! Allow the starting position to take the defualt value }}
\DoxyCodeLine{301         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{302             start = x\_start}
\DoxyCodeLine{303             x(1) = start(1)}
\DoxyCodeLine{304             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{305                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting from provided Markov chain position', F12.8)"{}}\textcolor{comment}{) x(1)}}
\DoxyCodeLine{306 \textcolor{comment}{}\textcolor{keywordflow}{            end if}}
\DoxyCodeLine{307         \textcolor{keywordflow}{else} }
\DoxyCodeLine{308             \textcolor{comment}{! Creates the initial position of the random walker that is within a certain radius  }}
\DoxyCodeLine{309             \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{310             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= qho\%rcut)}
\DoxyCodeLine{311                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{312 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{313             start = sample\_normal}
\DoxyCodeLine{314             x(1) = start(1)}
\DoxyCodeLine{315             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{316                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Generated random Markov chain start position', F12.8)"{}}\textcolor{comment}{) x(1)}}
\DoxyCodeLine{317 \textcolor{comment}{}\textcolor{keywordflow}{            end if}}
\DoxyCodeLine{318 \textcolor{keywordflow}{        end if} }
\DoxyCodeLine{319 }
\DoxyCodeLine{320         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{321         accept = 0 }
\DoxyCodeLine{322         \textcolor{comment}{! Start the counter for the thinning process}}
\DoxyCodeLine{323         thin\_counter = 0}
\DoxyCodeLine{324         \textcolor{comment}{! Start the reset counter }}
\DoxyCodeLine{325         reset\_counter = 0}
\DoxyCodeLine{326 }
\DoxyCodeLine{327         \textcolor{comment}{!Write initial conditions to the output file}}
\DoxyCodeLine{328         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{329             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for alpha = ', F7.4)"{}}) alpha\_const}
\DoxyCodeLine{330             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Sample     Position       Local Energy     Accepted?')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{331 \textcolor{comment}{}            \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6)"{}}) 1, x(1), energy\_chain\textcolor{comment}{(1)}}
\DoxyCodeLine{332 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{333 }
\DoxyCodeLine{334         \textcolor{comment}{! In case burn = 0 to start calculating the chain from the beginning }}
\DoxyCodeLine{335         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{336             energy\_chain(1) = qho\_energy(alpha\_const, x(1))}
\DoxyCodeLine{337             x\_burnt(1) = x(1)}
\DoxyCodeLine{338 }
\DoxyCodeLine{339             \textcolor{keywordflow}{do} i = 2, n+1 }
\DoxyCodeLine{340                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{341                 thin\_counter = 1 + thin\_counter           }
\DoxyCodeLine{342                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{343                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{344                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{345 }
\DoxyCodeLine{346                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{347                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{348             }
\DoxyCodeLine{349                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{350                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{351 }
\DoxyCodeLine{352                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{353                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{354             }
\DoxyCodeLine{355                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{356                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{357                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{358                     x(i) = x\_n(1) }
\DoxyCodeLine{359 }
\DoxyCodeLine{360                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{361                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{362                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{363                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{364                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{365                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{366                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{367                         x\_burnt(i\_bt) = x\_n(1)}
\DoxyCodeLine{368                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{369                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x\_n\textcolor{comment}{(1))}}
\DoxyCodeLine{370 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{371                         thin\_counter = 0}
\DoxyCodeLine{372 }
\DoxyCodeLine{373                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{374                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{375                         accept = 1 + accept }
\DoxyCodeLine{376 }
\DoxyCodeLine{377                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{378                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{379                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{380 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{381 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{382 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{383 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{384                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{385                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{386                     x(i) = x(i-\/1)}
\DoxyCodeLine{387 }
\DoxyCodeLine{388                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain }}
\DoxyCodeLine{389                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{390                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{391                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{392                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{393                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{394                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{395                         x\_burnt(i\_bt) = x(i-\/1)}
\DoxyCodeLine{396                         \textcolor{comment}{! Calculate the local energy at this point}}
\DoxyCodeLine{397                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x(i\textcolor{comment}{-\/1))}}
\DoxyCodeLine{398 \textcolor{comment}{}                        \textcolor{comment}{! Reseting the thin counter }}
\DoxyCodeLine{399                         thin\_counter = 0 }
\DoxyCodeLine{400 }
\DoxyCodeLine{401                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{402 }
\DoxyCodeLine{403                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{404                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{405                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{406 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{407 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{408 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{409 }
\DoxyCodeLine{410 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{411 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{412 }
\DoxyCodeLine{413 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{414         \textcolor{comment}{! Loop to advance the chain to the final burn step and not save any of the outputs}}
\DoxyCodeLine{415         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{416             \textcolor{keywordflow}{do} i = 2, burn}
\DoxyCodeLine{417                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{418                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{419                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{420                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{421                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{422                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{423                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{424                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{425                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{426             }
\DoxyCodeLine{427                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{428                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{429                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{430                     x(i) = x\_n(1) }
\DoxyCodeLine{431                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{432                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{433                     x(i) = x(i-\/1)}
\DoxyCodeLine{434 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{435 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{436 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{437        }
\DoxyCodeLine{438         \textcolor{comment}{! Metropolis Algorithm}}
\DoxyCodeLine{439         \textcolor{keywordflow}{if} (burn >=1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{440             \textcolor{keywordflow}{do} i = burn + 1, n+1 }
\DoxyCodeLine{441                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{442                 thin\_counter = 1 + thin\_counter           }
\DoxyCodeLine{443                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{444                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{445                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{446 }
\DoxyCodeLine{447                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{448                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{449             }
\DoxyCodeLine{450                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{451                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{452 }
\DoxyCodeLine{453                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{454                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{455             }
\DoxyCodeLine{456                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{457                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{458                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{459                     x(i) = x\_n(1) }
\DoxyCodeLine{460 }
\DoxyCodeLine{461                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{462                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{463                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{464                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{465                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{466                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{467                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{468                         x\_burnt(i\_bt) = x\_n(1)}
\DoxyCodeLine{469                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{470                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x\_n\textcolor{comment}{(1))}}
\DoxyCodeLine{471 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{472                         thin\_counter = 0}
\DoxyCodeLine{473 }
\DoxyCodeLine{474                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{475                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{476                         accept = 1 + accept }
\DoxyCodeLine{477 }
\DoxyCodeLine{478                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{479                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{480                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{481 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{482 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{483 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{484 }
\DoxyCodeLine{485 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{486 }
\DoxyCodeLine{487                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{488                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{489                     x(i) = x(i-\/1)}
\DoxyCodeLine{490 }
\DoxyCodeLine{491                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain }}
\DoxyCodeLine{492                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{493                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{494                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{495                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{496                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{497                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{498                         x\_burnt(i\_bt) = x(i-\/1)}
\DoxyCodeLine{499                         \textcolor{comment}{! Calculate the local energy at this point}}
\DoxyCodeLine{500                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x(i\textcolor{comment}{-\/1))}}
\DoxyCodeLine{501 \textcolor{comment}{}                        \textcolor{comment}{! Reseting the thin counter }}
\DoxyCodeLine{502                         thin\_counter = 0 }
\DoxyCodeLine{503 }
\DoxyCodeLine{504                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{505 }
\DoxyCodeLine{506                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{507                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{508                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{509 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{510 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{511 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{512 }
\DoxyCodeLine{513 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{514 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{515 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{516 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{517 }
\DoxyCodeLine{518         \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{519         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{))}}
\DoxyCodeLine{520 \textcolor{comment}{}}
\DoxyCodeLine{521         \textcolor{comment}{! Calculate the mean energy and the variance in the energy}}
\DoxyCodeLine{522         energy\_mean = sum(energy\_chain) / real(re\_size, kind=real64)}
\DoxyCodeLine{523         energy2\_mean = 0.0\_real64}
\DoxyCodeLine{524         \textcolor{keywordflow}{do} i = 1, re\_size}
\DoxyCodeLine{525             energy2\_mean = energy2\_mean + energy\_chain(i)*energy\_chain(i\textcolor{comment}{) }}
\DoxyCodeLine{526 \textcolor{comment}{}\textcolor{keywordflow}{        end do}}
\DoxyCodeLine{527         energy\_variance = (1.0\_real64 / real(re\_size-\/1, kind=real64)) * \textcolor{comment}{\& }}
\DoxyCodeLine{528 \textcolor{comment}{}            (energy2\_mean -\/ (1/real(re\_size, kind=real64)) * energy\_mean\textcolor{comment}{ * energy\_mean)}}
\DoxyCodeLine{529 \textcolor{comment}{}}
\DoxyCodeLine{530         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{531             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Local energy = ', F12.8)"{}}) energy\_mean}
\DoxyCodeLine{532             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Variance = ', F12.8)"{}}) energy\_variance}
\DoxyCodeLine{533             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Acceptance rate = ', F12.8)"{}}) accept\_rate}
\DoxyCodeLine{534             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{535 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{536 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a05315751002a983c9976851c9f21f0f0_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a05315751002a983c9976851c9f21f0f0_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a4856736e8ffc45caa57893a6b96318d3}\label{namespacevqmc_a4856736e8ffc45caa57893a6b96318d3}} 
\index{vqmc@{vqmc}!grid\_qho@{grid\_qho}}
\index{grid\_qho@{grid\_qho}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{grid\_qho()}{grid\_qho()}}
{\footnotesize\ttfamily subroutine vqmc\+::grid\+\_\+qho (\begin{DoxyParamCaption}\item[{real(real64), dimension(\+:), intent(in)}]{alpha\+\_\+array,  }\item[{real(real64), dimension(\+:)}]{energies,  }\item[{real(real64), dimension(\+:)}]{acc\+\_\+rates }\end{DoxyParamCaption})}



Definition at line 542 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{543 }
\DoxyCodeLine{544         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{545 }
\DoxyCodeLine{546 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: alpha\_array}
\DoxyCodeLine{547 }
\DoxyCodeLine{548 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)} :: energies}
\DoxyCodeLine{549 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)} :: acc\_rates}
\DoxyCodeLine{550 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{551 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{552 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: pos\_chain}
\DoxyCodeLine{553 \textcolor{keywordtype}{        real}(real64) :: accept\_rate}
\DoxyCodeLine{554 \textcolor{keywordtype}{        real}(real64) :: energy\_mean}
\DoxyCodeLine{555 \textcolor{keywordtype}{        real}(real64) :: energy\_variance}
\DoxyCodeLine{556         \textcolor{keywordtype}{integer} :: i, ierr}
\DoxyCodeLine{557         \textcolor{keywordtype}{character(len=3)} :: str\_i}
\DoxyCodeLine{558         \textcolor{keywordtype}{character(len=40)} :: tracefile}
\DoxyCodeLine{559 }
\DoxyCodeLine{560         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{561         \textcolor{keyword}{allocate}(variances(\textcolor{keyword}{size}(alpha\_array)))}
\DoxyCodeLine{562 }
\DoxyCodeLine{563         \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{564         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{565         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Alpha       Energy            Acceptance Rate')"{}})}
\DoxyCodeLine{566         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{567             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{568 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{569 }
\DoxyCodeLine{570         \textcolor{comment}{! Loop over values of alpha}}
\DoxyCodeLine{571         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(alpha\_array)}
\DoxyCodeLine{572 }
\DoxyCodeLine{573             \textcolor{comment}{! Calculate energy at current value of alpha}}
\DoxyCodeLine{574             \textcolor{keyword}{call }vqmc\_qho(qho\%sigma, qho\%steps, qho\%burn\_step, qho\%thin\_step\textcolor{comment}{, \&}}
\DoxyCodeLine{575 \textcolor{comment}{}                alpha\_array(i), pos\_chain, accept\_rate, energy\_chain, energy\_mean\textcolor{comment}{, \&}}
\DoxyCodeLine{576 \textcolor{comment}{}                energy\_variance)}
\DoxyCodeLine{577             \textcolor{comment}{! Save energy}}
\DoxyCodeLine{578             energies(i) = energy\_mean}
\DoxyCodeLine{579             variances(i) = energy\_variance}
\DoxyCodeLine{580             acc\_rates(i) = accept\_rate}
\DoxyCodeLine{581 }
\DoxyCodeLine{582             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F7.4, '     ', F12.8, '      ', F12.8)"{}}) alpha\_array\textcolor{comment}{(i), \&}}
\DoxyCodeLine{583 \textcolor{comment}{}                energies(i), accept\_rate}
\DoxyCodeLine{584 }
\DoxyCodeLine{585             \textcolor{keywordflow}{if} (write\_chains) \textcolor{keywordflow}{then}}
\DoxyCodeLine{586                 \textcolor{keyword}{write}(str\_i, \textcolor{stringliteral}{"{}(I3)"{}}) i}
\DoxyCodeLine{587                 \textcolor{keyword}{write}(tracefile, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{'./traces\_out/alpha\_'}, trim(adjustl\textcolor{comment}{(str\_i)), }\textcolor{stringliteral}{'.nc'}}
\DoxyCodeLine{588                 \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{'Writing energy trace to '}, tracefile}
\DoxyCodeLine{589                 \textcolor{keyword}{call }write\_qho\_equilibration(energy\_chain, tracefile, ierr\textcolor{comment}{, qho, \&}}
\DoxyCodeLine{590 \textcolor{comment}{}                    accept\_rate, alpha\_array(i))}
\DoxyCodeLine{591 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{592 }
\DoxyCodeLine{593 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{594 }
\DoxyCodeLine{595         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  End VQMC Runs  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{596         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{597             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  End VQMC Runs  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{598 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{599 }
\DoxyCodeLine{600         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{601             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{602             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('alpha            Energy')"{}})}
\DoxyCodeLine{603             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(alpha\_array)}
\DoxyCodeLine{604                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) alpha\_array(i), energies\textcolor{comment}{(i)}}
\DoxyCodeLine{605 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{606             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{607             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Min Energy = ', F12.8, ' at c = ', F12.8)"{}}) \textcolor{comment}{\&}}
\DoxyCodeLine{608 \textcolor{comment}{}                minval(energies), alpha\_array(minloc(energies, 1))}
\DoxyCodeLine{609             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{610 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{611 }
\DoxyCodeLine{612         \textcolor{comment}{! Write main results file.}}
\DoxyCodeLine{613         \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF output file '}\textcolor{comment}{, \&}}
\DoxyCodeLine{614 \textcolor{comment}{}                    outfile}
\DoxyCodeLine{615         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{616             \textcolor{keyword}{write}(logid, *) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF \&}}
\DoxyCodeLine{617 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&output file '}, outfile}
\DoxyCodeLine{618 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{619         \textcolor{keyword}{call }write\_qho\_main(alpha\_array, energies, variances, outfile, ierr\textcolor{comment}{, qho, acc\_rates)}}
\DoxyCodeLine{620 \textcolor{comment}{}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a4856736e8ffc45caa57893a6b96318d3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=313pt]{namespacevqmc_a4856736e8ffc45caa57893a6b96318d3_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a5d73324fcbe9c3ef7fe11309581af529}\label{namespacevqmc_a5d73324fcbe9c3ef7fe11309581af529}} 
\index{vqmc@{vqmc}!equil\_qho@{equil\_qho}}
\index{equil\_qho@{equil\_qho}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{equil\_qho()}{equil\_qho()}}
{\footnotesize\ttfamily subroutine vqmc\+::equil\+\_\+qho (\begin{DoxyParamCaption}\item[{real(real64), dimension(\+:), intent(in)}]{alpha\+\_\+array }\end{DoxyParamCaption})}



Definition at line 626 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{627 }
\DoxyCodeLine{628         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{629 }
\DoxyCodeLine{630 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: alpha\_array}
\DoxyCodeLine{631 }
\DoxyCodeLine{632 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{633 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energies}
\DoxyCodeLine{634 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{635 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: pos\_chain}
\DoxyCodeLine{636 \textcolor{keywordtype}{        real}(real64) :: accept\_rate}
\DoxyCodeLine{637 \textcolor{keywordtype}{        real}(real64) :: energy\_mean}
\DoxyCodeLine{638 \textcolor{keywordtype}{        real}(real64) :: energy\_variance}
\DoxyCodeLine{639         \textcolor{keywordtype}{integer} :: i, ierr}
\DoxyCodeLine{640         \textcolor{keywordtype}{character(len=3)} :: str\_i}
\DoxyCodeLine{641         \textcolor{keywordtype}{character(len=40)} :: equilfile}
\DoxyCodeLine{642 }
\DoxyCodeLine{643         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{644         \textcolor{keyword}{allocate}(energies(int(qho\%alpha(3)))); energies(:) = 0.0\_real64}
\DoxyCodeLine{645         \textcolor{keyword}{allocate}(variances(\textcolor{keyword}{size}(alpha\_array)))}
\DoxyCodeLine{646 }
\DoxyCodeLine{647         \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{648         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{649         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Alpha       Energy            Acceptance Rate')"{}})}
\DoxyCodeLine{650         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{651             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{652 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{653 }
\DoxyCodeLine{654         \textcolor{comment}{! Loop over values of alpha}}
\DoxyCodeLine{655         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(alpha\_array)}
\DoxyCodeLine{656 }
\DoxyCodeLine{657             \textcolor{comment}{! Calculate energy at current value of alpha}}
\DoxyCodeLine{658             \textcolor{keyword}{call }vqmc\_qho(qho\%sigma, qho\%steps, qho\%burn\_step, qho\%thin\_step\textcolor{comment}{, \&}}
\DoxyCodeLine{659 \textcolor{comment}{}                alpha\_array(i), pos\_chain, accept\_rate, energy\_chain, energy\_mean\textcolor{comment}{, \&}}
\DoxyCodeLine{660 \textcolor{comment}{}                energy\_variance)}
\DoxyCodeLine{661             \textcolor{comment}{! Save energy}}
\DoxyCodeLine{662             energies(i) = sum(energy\_chain) / \textcolor{keyword}{size}(energy\_chain)}
\DoxyCodeLine{663 }
\DoxyCodeLine{664             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F7.4, '     ', F12.8, '      ', F12.8)"{}}) alpha\_array\textcolor{comment}{(i), \&}}
\DoxyCodeLine{665 \textcolor{comment}{}                energies(i), accept\_rate}
\DoxyCodeLine{666 }
\DoxyCodeLine{667             \textcolor{comment}{! Save the energy trace for each value of alpha.}}
\DoxyCodeLine{668             \textcolor{keyword}{write}(str\_i, \textcolor{stringliteral}{"{}(I3)"{}}) i}
\DoxyCodeLine{669             \textcolor{keyword}{write}(equilfile, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{'./equil\_out/alpha\_'}, trim(adjustl(str\_i\textcolor{comment}{)), }\textcolor{stringliteral}{'.nc'}}
\DoxyCodeLine{670             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{'Writing equilibration outfile to '}, equilfile}
\DoxyCodeLine{671             \textcolor{keyword}{call }write\_qho\_equilibration(energy\_chain, equilfile, ierr, qho\textcolor{comment}{, \&}}
\DoxyCodeLine{672 \textcolor{comment}{}                accept\_rate, alpha\_array(i))}
\DoxyCodeLine{673 }
\DoxyCodeLine{674 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{675 }
\DoxyCodeLine{676         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  End VQMC Runs  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{677         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{678             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  End VQMC Runs  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{679 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{680 }
\DoxyCodeLine{681         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{682             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{683             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('alpha            Energy')"{}})}
\DoxyCodeLine{684             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(alpha\_array)}
\DoxyCodeLine{685                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) alpha\_array(i), energies\textcolor{comment}{(i)}}
\DoxyCodeLine{686 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{687             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{688 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{689 }
\DoxyCodeLine{690         \textcolor{keyword}{deallocate}(energies)}
\DoxyCodeLine{691     }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a5d73324fcbe9c3ef7fe11309581af529_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=317pt]{namespacevqmc_a5d73324fcbe9c3ef7fe11309581af529_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a8213f95bb390d7a9eff8260f527c00b8}\label{namespacevqmc_a8213f95bb390d7a9eff8260f527c00b8}} 
\index{vqmc@{vqmc}!vqmc\_h\_2\_plus@{vqmc\_h\_2\_plus}}
\index{vqmc\_h\_2\_plus@{vqmc\_h\_2\_plus}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_h\_2\_plus()}{vqmc\_h\_2\_plus()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+h\+\_\+2\+\_\+plus (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), intent(in)}]{c\+\_\+const,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+a,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+b,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), intent(out)}]{energy\+\_\+mean,  }\item[{real(real64), intent(out)}]{energy\+\_\+variance,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{Dphi\+Dc\+\_\+chain,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start }\end{DoxyParamCaption})}



Performs VQMC for H\+\_\+2\+\_\+plus ~\newline
 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em c\+\_\+const} & Parameter(s) of trial wavefunction \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+a} & Position of hydrogen atom A \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+b} & Position of hydrogen atom B \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start} & Starting point of MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+burnt} & The burnt and thinned MCMC chain for the random walker \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energis of the each points in the MCMC chain \\
\hline
\end{DoxyParams}


Definition at line 721 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{724 }
\DoxyCodeLine{725         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{726 }
\DoxyCodeLine{727 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{728 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma}
\DoxyCodeLine{729 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: c\_const}
\DoxyCodeLine{730 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)}, \textcolor{keywordtype}{optional} :: x\_start}
\DoxyCodeLine{731         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{732         }
\DoxyCodeLine{733          }
\DoxyCodeLine{734 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate, energy\_mean, energy\_variance}
\DoxyCodeLine{735 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_burnt}
\DoxyCodeLine{736 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{737 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: DphiDc\_chain}
\DoxyCodeLine{738 }
\DoxyCodeLine{739 \textcolor{keywordtype}{        real}(real64) :: E\_loc}
\DoxyCodeLine{740 \textcolor{keywordtype}{        real}(real64) :: DphiDc}
\DoxyCodeLine{741 \textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                          \textcolor{comment}{! The natural logarithm of the transition proability}}
\DoxyCodeLine{742 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                        \textcolor{comment}{! Acceptance ratio of the transitional probability }}
\DoxyCodeLine{743 \textcolor{keywordtype}{        real}(real64) :: unif\_num                            \textcolor{comment}{! A random sample from the uniform distribution}}
\DoxyCodeLine{744 \textcolor{keywordtype}{        real}(real64) :: energy2\_mean}
\DoxyCodeLine{745 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: start                 \textcolor{comment}{! Starting point of MCMC chain}}
\DoxyCodeLine{746 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X     \textcolor{comment}{! Unburnt and thinned MCMC chain }}
\DoxyCodeLine{747 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: X\_n                   \textcolor{comment}{! The proposed step }}
\DoxyCodeLine{748 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: sample\_normal         \textcolor{comment}{! A sample from the normal distribution }}
\DoxyCodeLine{749         \textcolor{keywordtype}{integer} :: accept                                   \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{750         \textcolor{keywordtype}{integer} :: thin\_counter                             \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{751         \textcolor{keywordtype}{integer} :: reset\_counter                            \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{752         \textcolor{keywordtype}{integer} :: re\_size                                  \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{753         \textcolor{keywordtype}{integer} :: i\_bt                                     \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{754         \textcolor{keywordtype}{integer} :: i                                        \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{755         \textcolor{keywordtype}{character(len=1)} :: acceptance                      \textcolor{comment}{! Yes/No signpost for acceptance}}
\DoxyCodeLine{756 }
\DoxyCodeLine{757         \textcolor{keywordflow}{if} (write\_log) \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for c = ', F7.4)"{}}) c\_const}
\DoxyCodeLine{758 }
\DoxyCodeLine{759         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{760         re\_size = (n -\/ burn) / thin}
\DoxyCodeLine{761 }
\DoxyCodeLine{762         \textcolor{keyword}{allocate}(x(3, 1:n+1)); x(:, :) = 0.0\_real64}
\DoxyCodeLine{763         \textcolor{keyword}{allocate}(x\_burnt(3, 1:re\_size +1)); x\_burnt(:, :) = 0.0\_real64}
\DoxyCodeLine{764         \textcolor{keyword}{allocate}(energy\_chain(1:re\_size+1)); energy\_chain(:) = 0.0\_real64}
\DoxyCodeLine{765         \textcolor{keyword}{allocate}(dphidc\_chain(1:re\_size+1)); dphidc\_chain(:) = 0.0\_real64}
\DoxyCodeLine{766 }
\DoxyCodeLine{767         \textcolor{comment}{! Allow the starting position to take on the default value}}
\DoxyCodeLine{768         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start)) \textcolor{keywordflow}{then} }
\DoxyCodeLine{769             start = x\_start}
\DoxyCodeLine{770             x(:,1) = start}
\DoxyCodeLine{771             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{772                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting from provided Markov chain position:')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{773 \textcolor{comment}{}                \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('    x = ', F12.8, ' y = ', F12.8, ' z = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{774 \textcolor{comment}{}                    x(1, 1), x(2, 1), x(3, 1)}
\DoxyCodeLine{775 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{776         \textcolor{keywordflow}{else} }
\DoxyCodeLine{777             \textcolor{comment}{! Create the initial position of the random walker that is within a certain radius}}
\DoxyCodeLine{778             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{779             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2plus\%rcut)}
\DoxyCodeLine{780                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{781 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{782             start = sample\_normal}
\DoxyCodeLine{783             x(:,1) = start }
\DoxyCodeLine{784             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{785                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Generated random Markov chain start position:')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{786 \textcolor{comment}{}                \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('X = ', F12.8, ', Y = ', F12.8, ', Z = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{787 \textcolor{comment}{}                    x(1, 1), x(2, 1), x(3, 1)}
\DoxyCodeLine{788 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{789 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{790         }
\DoxyCodeLine{791         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{792         accept = 0  }
\DoxyCodeLine{793         \textcolor{comment}{! Start the counter for the thinning process }}
\DoxyCodeLine{794         thin\_counter = 0}
\DoxyCodeLine{795         \textcolor{comment}{! Start the reset\_counter }}
\DoxyCodeLine{796         reset\_counter = 0}
\DoxyCodeLine{797         }
\DoxyCodeLine{798         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{799             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Sample      X               Y              Z              \&}}
\DoxyCodeLine{800 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&Local Energy     Accepted?')"{}})}
\DoxyCodeLine{801             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8, ' ', F12.6)"{}}\textcolor{comment}{)\&}}
\DoxyCodeLine{802 \textcolor{comment}{}                1, x(1, 1), x(2, 1), x(3, 1), energy\_chain(1)}
\DoxyCodeLine{803 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{804         }
\DoxyCodeLine{805         \textcolor{comment}{! Calculate the local energy of the initial step if not burnt}}
\DoxyCodeLine{806         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{807             \textcolor{keyword}{call }h\_2\_plus\_energy(c\_const, x(:, 1), r\_a, r\_b, e\_loc, dphidc\textcolor{comment}{)}}
\DoxyCodeLine{808 \textcolor{comment}{}            energy\_chain(1) = e\_loc}
\DoxyCodeLine{809             dphidc\_chain(1) = dphidc}
\DoxyCodeLine{810             x\_burnt(:, 1) = x(:, 1)}
\DoxyCodeLine{811 }
\DoxyCodeLine{812             \textcolor{keywordflow}{do} i = 2, n+1}
\DoxyCodeLine{813                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{814                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{815                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{816                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{817                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{818 }
\DoxyCodeLine{819                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{820                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{821 \textcolor{comment}{}           }
\DoxyCodeLine{822                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{823                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{824             }
\DoxyCodeLine{825                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{826                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{827 }
\DoxyCodeLine{828                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{829                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{830                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{831                     x(:, i) = x\_n }
\DoxyCodeLine{832 }
\DoxyCodeLine{833                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{834                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{835                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{836                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{837                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{838                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{839                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{840                         x\_burnt(:, i\_bt) = x\_n}
\DoxyCodeLine{841                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{842                         \textcolor{keyword}{call }h\_2\_plus\_energy(c\_const, x\_n, r\_a, r\_b, e\_loc\textcolor{comment}{, dphidc)}}
\DoxyCodeLine{843 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{844                         dphidc\_chain(i\_bt) = dphidc}
\DoxyCodeLine{845                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{846                         thin\_counter = 0}
\DoxyCodeLine{847 }
\DoxyCodeLine{848                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{849                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{850                         accept = 1 + accept }
\DoxyCodeLine{851 }
\DoxyCodeLine{852                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{853                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{854                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{855 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{856 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{857 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{858 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{859 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{860 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{861                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{862                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{863                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{864 }
\DoxyCodeLine{865                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{866                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{867                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{868                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{869                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{870                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{871                         x\_burnt(:, i\_bt) = x(:, i-\/1)}
\DoxyCodeLine{872                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{873                         \textcolor{keyword}{call }h\_2\_plus\_energy(c\_const, x(:, i-\/1), r\_a, r\_b\textcolor{comment}{, e\_loc, dphidc)}}
\DoxyCodeLine{874 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{875                         dphidc\_chain(i\_bt) = dphidc}
\DoxyCodeLine{876                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{877                         thin\_counter = 0}
\DoxyCodeLine{878 }
\DoxyCodeLine{879                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{880 }
\DoxyCodeLine{881                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{882                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{883                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{884 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{885 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{886 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{887 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{888 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{889 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{890 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{891 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{892         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{893             \textcolor{keywordflow}{do} i = 2, burn}
\DoxyCodeLine{894                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{895                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{896                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{897 }
\DoxyCodeLine{898                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{899                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{900 \textcolor{comment}{}           }
\DoxyCodeLine{901                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{902                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{903             }
\DoxyCodeLine{904                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{905                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{906 }
\DoxyCodeLine{907                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{908                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{909                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{910                     x(:, i) = x\_n }
\DoxyCodeLine{911                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{912                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{913                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{914 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{915 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{916 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{917 }
\DoxyCodeLine{918         \textcolor{comment}{! Execute MCMC chain with burning and thinning}}
\DoxyCodeLine{919         \textcolor{keywordflow}{if} (burn >= 1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{920             \textcolor{comment}{! Metropolis algorithm }}
\DoxyCodeLine{921             \textcolor{keywordflow}{do} i = burn + 1, n+1 }
\DoxyCodeLine{922                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{923                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{924                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{925                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{926                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{927 }
\DoxyCodeLine{928                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{929                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{930 \textcolor{comment}{}                }
\DoxyCodeLine{931                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{932                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{933             }
\DoxyCodeLine{934                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{935                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{936 }
\DoxyCodeLine{937                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{938                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{939                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{940                     x(:, i) = x\_n }
\DoxyCodeLine{941 }
\DoxyCodeLine{942                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{943                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{944                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{945                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{946                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{947                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{948                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{949                         x\_burnt(:, i\_bt) = x\_n}
\DoxyCodeLine{950                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{951                         \textcolor{keyword}{call }h\_2\_plus\_energy(c\_const, x\_n, r\_a, r\_b, e\_loc\textcolor{comment}{, dphidc)}}
\DoxyCodeLine{952 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{953                         dphidc\_chain(i\_bt) = dphidc}
\DoxyCodeLine{954                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{955                         thin\_counter = 0}
\DoxyCodeLine{956 }
\DoxyCodeLine{957                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{958                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{959                         accept = 1 + accept }
\DoxyCodeLine{960 }
\DoxyCodeLine{961                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{962                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{963                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{964 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{965 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{966 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{967 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{968 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{969 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{970                  }
\DoxyCodeLine{971                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{972                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{973                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{974 }
\DoxyCodeLine{975                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                   }}
\DoxyCodeLine{976                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{977                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{978                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{979                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{980                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{981                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{982                         x\_burnt(:, i\_bt) = x(:, i-\/1)}
\DoxyCodeLine{983                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{984                         \textcolor{keyword}{call }h\_2\_plus\_energy(c\_const, x(:, i-\/1), r\_a, r\_b\textcolor{comment}{, e\_loc, dphidc)}}
\DoxyCodeLine{985 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{986                         dphidc\_chain(i\_bt) = dphidc}
\DoxyCodeLine{987                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{988                         thin\_counter = 0}
\DoxyCodeLine{989 }
\DoxyCodeLine{990                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{991 }
\DoxyCodeLine{992                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{993                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{994                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{995 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{996 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{997 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{998 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{999 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{1000 }
\DoxyCodeLine{1001 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1002 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1003 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{1004 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1005 }
\DoxyCodeLine{1006         \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1007         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{))}}
\DoxyCodeLine{1008 \textcolor{comment}{}}
\DoxyCodeLine{1009         \textcolor{comment}{! Calculate the mean energy and the variance in the energy}}
\DoxyCodeLine{1010         energy\_mean = sum(energy\_chain) / real(re\_size, kind=real64)}
\DoxyCodeLine{1011         energy2\_mean = 0.0\_real64}
\DoxyCodeLine{1012         \textcolor{keywordflow}{do} i = 1, re\_size}
\DoxyCodeLine{1013             energy2\_mean = energy2\_mean + energy\_chain(i)*energy\_chain(i\textcolor{comment}{) }}
\DoxyCodeLine{1014 \textcolor{comment}{}\textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1015         energy\_variance = (1.0\_real64 / real(re\_size-\/1, kind=real64)) * \textcolor{comment}{\& }}
\DoxyCodeLine{1016 \textcolor{comment}{}            (energy2\_mean -\/ (1/real(re\_size, kind=real64)) * energy\_mean\textcolor{comment}{ * energy\_mean)}}
\DoxyCodeLine{1017 \textcolor{comment}{}}
\DoxyCodeLine{1018         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1019             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Local energy = ', F12.8)"{}}) energy\_mean}
\DoxyCodeLine{1020             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Variance = ', F12.8)"{}}) energy\_variance}
\DoxyCodeLine{1021             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Acceptance rate = ', F12.8)"{}}) accept\_rate}
\DoxyCodeLine{1022             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1023 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1024 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a8213f95bb390d7a9eff8260f527c00b8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a8213f95bb390d7a9eff8260f527c00b8_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a0a07ef5b098cdc478b253de26c49aadc}\label{namespacevqmc_a0a07ef5b098cdc478b253de26c49aadc}} 
\index{vqmc@{vqmc}!auto\_h\_2\_plus@{auto\_h\_2\_plus}}
\index{auto\_h\_2\_plus@{auto\_h\_2\_plus}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{auto\_h\_2\_plus()}{auto\_h\_2\_plus()}}
{\footnotesize\ttfamily subroutine vqmc\+::auto\+\_\+h\+\_\+2\+\_\+plus (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{c\+\_\+in,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{real(real64), intent(out)}]{c\+\_\+out,  }\item[{real(real64), intent(out)}]{energy\+\_\+out,  }\item[{real(real64), intent(out)}]{variance\+\_\+out,  }\item[{real(real64), intent(out)}]{accept\+\_\+out,  }\item[{character(len=1), intent(out)}]{converged }\end{DoxyParamCaption})}



Definition at line 1031 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1033 }
\DoxyCodeLine{1034         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1035 }
\DoxyCodeLine{1036 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: c\_in}
\DoxyCodeLine{1037 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1038 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: c\_out}
\DoxyCodeLine{1039 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: energy\_out}
\DoxyCodeLine{1040 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: variance\_out}
\DoxyCodeLine{1041 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_out}
\DoxyCodeLine{1042         \textcolor{keywordtype}{character(len=1)}, \textcolor{keywordtype}{intent(out)} :: converged}
\DoxyCodeLine{1043 }
\DoxyCodeLine{1044 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1045 \textcolor{keywordtype}{        real}(real64) :: c\_current, c\_new}
\DoxyCodeLine{1046 \textcolor{keywordtype}{        real}(real64) :: c\_grad}
\DoxyCodeLine{1047 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: pos\_chain}
\DoxyCodeLine{1048 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{1049 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: DphiDc\_chain}
\DoxyCodeLine{1050         \textcolor{keywordtype}{integer} :: k}
\DoxyCodeLine{1051         \textcolor{keywordtype}{integer} :: maxiter = 200}
\DoxyCodeLine{1052 \textcolor{keywordtype}{        real}(real64) :: tol = 1e-\/4\_real64}
\DoxyCodeLine{1053 }
\DoxyCodeLine{1054         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1055         c\_current = c\_in}
\DoxyCodeLine{1056         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1057         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1058 }
\DoxyCodeLine{1059         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1060             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting parameter search for c...')"{}})}
\DoxyCodeLine{1061 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1062 }
\DoxyCodeLine{1063         \textcolor{comment}{! Main iteration loop}}
\DoxyCodeLine{1064         \textcolor{keywordflow}{do} k = 1, maxiter}
\DoxyCodeLine{1065 }
\DoxyCodeLine{1066             \textcolor{comment}{! Calculate gradient at current c}}
\DoxyCodeLine{1067             \textcolor{keyword}{call }vqmc\_h\_2\_plus(h2plus\%sigma, h2plus\%steps, h2plus\%burn\_step\textcolor{comment}{, h2plus\%thin\_step, \&}}
\DoxyCodeLine{1068 \textcolor{comment}{}                    c\_current, r\_a, r\_b, pos\_chain, accept\_out, energy\_chain\textcolor{comment}{, energy\_out, \& }}
\DoxyCodeLine{1069 \textcolor{comment}{}                    variance\_out, dphidc\_chain)}
\DoxyCodeLine{1070             c\_grad = 2.0\_real64 * (sum(energy\_chain * dphidc\_chain) / \textcolor{keyword}{size}\textcolor{comment}{(energy\_chain)) \&}}
\DoxyCodeLine{1071 \textcolor{comment}{}                -\/ (energy\_out * (sum(dphidc\_chain) / \textcolor{keyword}{size}(dphidc\_chain))\textcolor{comment}{)}}
\DoxyCodeLine{1072 \textcolor{comment}{}            \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1073                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('c            Gradient')"{}})}
\DoxyCodeLine{1074                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F13.7, '       ', F13.7)"{}}) c\_current, c\_grad}
\DoxyCodeLine{1075 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1076 }
\DoxyCodeLine{1077             \textcolor{comment}{! Check if gradient is within tolerance.}}
\DoxyCodeLine{1078             \textcolor{keywordflow}{if} (abs(c\_grad) .le. tol) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1079                 c\_out = c\_current}
\DoxyCodeLine{1080                 converged = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{1081                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1082                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Parameter search converged!')"{}})}
\DoxyCodeLine{1083                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1084                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('c = ', F13.7, ', Energy = ', F12.8, ', Variance = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1085 \textcolor{comment}{}                        c\_current, energy\_out, variance\_out}
\DoxyCodeLine{1086                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1087 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{1088                 \textcolor{keywordflow}{exit}}
\DoxyCodeLine{1089 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1090 }
\DoxyCodeLine{1091             \textcolor{comment}{! If not, update c by steepest descent.}}
\DoxyCodeLine{1092             \textcolor{keyword}{call }h\_2\_plus\_update\_c(c\_current, c\_grad, c\_new)}
\DoxyCodeLine{1093             c\_current = c\_new}
\DoxyCodeLine{1094 }
\DoxyCodeLine{1095 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1096 }
\DoxyCodeLine{1097         \textcolor{comment}{! Deal with non-\/convergence}}
\DoxyCodeLine{1098         \textcolor{keywordflow}{if} (k .ge. maxiter) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1099             converged = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{1100             c\_out = c\_current}
\DoxyCodeLine{1101             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1102                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Parameter search NOT converged! Consider changing\&}}
\DoxyCodeLine{1103 \textcolor{stringliteral}{}\textcolor{stringliteral}{                    \& the starting value of c, or the damping in the H\_2\_update\_c\&}}
\DoxyCodeLine{1104 \textcolor{stringliteral}{}\textcolor{stringliteral}{                    \& function.')"{}})}
\DoxyCodeLine{1105 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1106 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1107 }
\DoxyCodeLine{1108         \textcolor{comment}{! Report results}}
\DoxyCodeLine{1109         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   ', A, '             ', F13.7, '      ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1110 \textcolor{comment}{}            bond\_length, converged, c\_out, energy\_out}
\DoxyCodeLine{1111         }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a0a07ef5b098cdc478b253de26c49aadc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{namespacevqmc_a0a07ef5b098cdc478b253de26c49aadc_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb}\label{namespacevqmc_a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb}} 
\index{vqmc@{vqmc}!grid\_h\_2\_plus@{grid\_h\_2\_plus}}
\index{grid\_h\_2\_plus@{grid\_h\_2\_plus}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{grid\_h\_2\_plus()}{grid\_h\_2\_plus()}}
{\footnotesize\ttfamily subroutine vqmc\+::grid\+\_\+h\+\_\+2\+\_\+plus (\begin{DoxyParamCaption}\item[{real(real64), dimension(\+:), intent(in)}]{c\+\_\+array,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{real(real64), intent(out)}]{c\+\_\+out,  }\item[{real(real64), intent(out)}]{energy\+\_\+out,  }\item[{real(real64), intent(out)}]{variance\+\_\+out,  }\item[{real(real64), intent(out)}]{accept\+\_\+out }\end{DoxyParamCaption})}



Definition at line 1117 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1119     }
\DoxyCodeLine{1120         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1121 }
\DoxyCodeLine{1122 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: c\_array}
\DoxyCodeLine{1123 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1124 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: c\_out}
\DoxyCodeLine{1125 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: energy\_out}
\DoxyCodeLine{1126 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: variance\_out}
\DoxyCodeLine{1127 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_out}
\DoxyCodeLine{1128 }
\DoxyCodeLine{1129 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1130 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: pos\_chain}
\DoxyCodeLine{1131 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain, DphiDc\_chain}
\DoxyCodeLine{1132 \textcolor{keywordtype}{        real}(real64) :: accept\_rate, energy, variance}
\DoxyCodeLine{1133 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: param\_energies, param\_accepts\textcolor{comment}{, param\_variances}}
\DoxyCodeLine{1134 \textcolor{comment}{        }\textcolor{keywordtype}{integer} :: i}
\DoxyCodeLine{1135 }
\DoxyCodeLine{1136         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1137         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1138         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1139         \textcolor{keyword}{allocate}(param\_energies(\textcolor{keyword}{size}(c\_array)))}
\DoxyCodeLine{1140         \textcolor{keyword}{allocate}(param\_accepts(\textcolor{keyword}{size}(c\_array)))}
\DoxyCodeLine{1141         \textcolor{keyword}{allocate}(param\_variances(\textcolor{keyword}{size}(c\_array)))}
\DoxyCodeLine{1142 }
\DoxyCodeLine{1143         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1144             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting parameter search for c...')"{}})}
\DoxyCodeLine{1145 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1146 }
\DoxyCodeLine{1147         \textcolor{comment}{! Loop over c values}}
\DoxyCodeLine{1148         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(c\_array)}
\DoxyCodeLine{1149 }
\DoxyCodeLine{1150             \textcolor{comment}{! Calculate energy at current value of c}}
\DoxyCodeLine{1151             \textcolor{keyword}{call }vqmc\_h\_2\_plus(h2plus\%sigma, h2plus\%steps, h2plus\%burn\_step\textcolor{comment}{, h2plus\%thin\_step, \&}}
\DoxyCodeLine{1152 \textcolor{comment}{}                c\_array(i), r\_a, r\_b, pos\_chain, accept\_rate, energy\_chain\textcolor{comment}{, energy, \&}}
\DoxyCodeLine{1153 \textcolor{comment}{}                variance, dphidc\_chain)}
\DoxyCodeLine{1154             \textcolor{comment}{! Save energy}}
\DoxyCodeLine{1155             param\_energies(i) = energy}
\DoxyCodeLine{1156             param\_variances(i) = variance}
\DoxyCodeLine{1157             param\_accepts(i) = accept\_rate}
\DoxyCodeLine{1158 }
\DoxyCodeLine{1159 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1160 }
\DoxyCodeLine{1161         \textcolor{comment}{! Select lowest energy and corresponding c value}}
\DoxyCodeLine{1162         energy\_out = minval(param\_energies)}
\DoxyCodeLine{1163         c\_out = c\_array(minloc(param\_energies, 1))}
\DoxyCodeLine{1164         variance\_out = param\_variances(minloc(param\_energies, 1))}
\DoxyCodeLine{1165         accept\_out = param\_accepts(minloc(param\_energies, 1))}
\DoxyCodeLine{1166 }
\DoxyCodeLine{1167         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   -\/             ', F13.7, '      ', F12.8)"{}})\textcolor{comment}{ \&}}
\DoxyCodeLine{1168 \textcolor{comment}{}            bond\_length, c\_out, energy\_out}
\DoxyCodeLine{1169 }
\DoxyCodeLine{1170         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1171             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1172             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('c                Energy')"{}})}
\DoxyCodeLine{1173             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(c\_array)}
\DoxyCodeLine{1174                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) c\_array(i), param\_energies\textcolor{comment}{(i)}}
\DoxyCodeLine{1175 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{1176             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1177             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Min Energy = ', F12.8, ' at c = ', F12.8)"{}}) energy\_out\textcolor{comment}{, c\_out}}
\DoxyCodeLine{1178 \textcolor{comment}{}            \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1179 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1180     }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{namespacevqmc_a70c9fcecdf5f2a6ffea7dd3c4f0c1eeb_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a169c06cb168984ca6285231ad80a0243}\label{namespacevqmc_a169c06cb168984ca6285231ad80a0243}} 
\index{vqmc@{vqmc}!equil\_h\_2\_plus@{equil\_h\_2\_plus}}
\index{equil\_h\_2\_plus@{equil\_h\_2\_plus}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{equil\_h\_2\_plus()}{equil\_h\_2\_plus()}}
{\footnotesize\ttfamily subroutine vqmc\+::equil\+\_\+h\+\_\+2\+\_\+plus (\begin{DoxyParamCaption}\item[{real(real64), dimension(\+:), intent(in)}]{c\+\_\+array,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{integer, intent(in)}]{bonds\+\_\+pos }\end{DoxyParamCaption})}



Definition at line 1186 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1187 }
\DoxyCodeLine{1188         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1189 }
\DoxyCodeLine{1190 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: c\_array}
\DoxyCodeLine{1191 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1192         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: bonds\_pos}
\DoxyCodeLine{1193 }
\DoxyCodeLine{1194 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1195 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{1196 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energies}
\DoxyCodeLine{1197 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{1198 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: pos\_chain}
\DoxyCodeLine{1199 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: DphiDc\_chain}
\DoxyCodeLine{1200 \textcolor{keywordtype}{        real}(real64) :: accept\_rate}
\DoxyCodeLine{1201 \textcolor{keywordtype}{        real}(real64) :: energy\_mean}
\DoxyCodeLine{1202 \textcolor{keywordtype}{        real}(real64) :: energy\_variance}
\DoxyCodeLine{1203         \textcolor{keywordtype}{integer} :: i, ierr}
\DoxyCodeLine{1204         \textcolor{keywordtype}{character(len=3)} :: str\_i, str\_b}
\DoxyCodeLine{1205         \textcolor{keywordtype}{character(len=40)} :: equilfile}
\DoxyCodeLine{1206 }
\DoxyCodeLine{1207         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1208         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1209         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1210         \textcolor{keyword}{allocate}(energies(\textcolor{keyword}{size}(c\_array))); energies(:) = 0.0\_real64}
\DoxyCodeLine{1211         \textcolor{keyword}{allocate}(variances(\textcolor{keyword}{size}(c\_array)))}
\DoxyCodeLine{1212 }
\DoxyCodeLine{1213         \textcolor{comment}{! Loop over values of c}}
\DoxyCodeLine{1214         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(c\_array)}
\DoxyCodeLine{1215 }
\DoxyCodeLine{1216             \textcolor{comment}{! Calculate energy at current value of c}}
\DoxyCodeLine{1217             \textcolor{keyword}{call }vqmc\_h\_2\_plus(h2plus\%sigma, h2plus\%steps, h2plus\%burn\_step\textcolor{comment}{, h2plus\%thin\_step, \&}}
\DoxyCodeLine{1218 \textcolor{comment}{}                c\_array(i), r\_a, r\_b, pos\_chain, accept\_rate, energy\_chain\textcolor{comment}{, energy\_mean, \&}}
\DoxyCodeLine{1219 \textcolor{comment}{}                energy\_variance, dphidc\_chain)}
\DoxyCodeLine{1220             \textcolor{comment}{! Save energy}}
\DoxyCodeLine{1221             energies(i) = energy\_mean}
\DoxyCodeLine{1222 }
\DoxyCodeLine{1223             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   -\/             ', F13.7, '      ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1224 \textcolor{comment}{}                bond\_length, c\_array(i), energies(i)}
\DoxyCodeLine{1225 }
\DoxyCodeLine{1226             \textcolor{comment}{! Save the energy trace for each value of c}}
\DoxyCodeLine{1227             \textcolor{keyword}{write}(str\_i, \textcolor{stringliteral}{"{}(I3)"{}}) i}
\DoxyCodeLine{1228             \textcolor{keyword}{write}(str\_b, \textcolor{stringliteral}{"{}(I3)"{}}) bonds\_pos}
\DoxyCodeLine{1229             \textcolor{keyword}{write}(equilfile, \textcolor{stringliteral}{"{}(5A)"{}}) \textcolor{stringliteral}{'./equil\_out/b'}, trim(adjustl(str\_b\textcolor{comment}{)), \&}}
\DoxyCodeLine{1230 \textcolor{comment}{}                \textcolor{stringliteral}{'\_c'}, trim(adjustl(str\_i)), \textcolor{stringliteral}{'.nc'}}
\DoxyCodeLine{1231             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{'Writing equilibration outfile to '}, equilfile}
\DoxyCodeLine{1232             \textcolor{keyword}{call }write\_h2plus\_equilibration(energy\_chain, equilfile, ierr\textcolor{comment}{, h2plus, \&}}
\DoxyCodeLine{1233 \textcolor{comment}{}                accept\_rate)}
\DoxyCodeLine{1234 }
\DoxyCodeLine{1235 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1236 }
\DoxyCodeLine{1237         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1238             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1239             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('c                Energy')"{}})}
\DoxyCodeLine{1240             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(c\_array)}
\DoxyCodeLine{1241                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) c\_array(i), energies\textcolor{comment}{(i)}}
\DoxyCodeLine{1242 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{1243             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1244 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1245 }
\DoxyCodeLine{1246         \textcolor{keyword}{deallocate}(energies)}
\DoxyCodeLine{1247         \textcolor{keyword}{deallocate}(variances)}
\DoxyCodeLine{1248     }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a169c06cb168984ca6285231ad80a0243_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=341pt]{namespacevqmc_a169c06cb168984ca6285231ad80a0243_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a12f60b20a934a7eb8c6e3cdaaac0b1cc}\label{namespacevqmc_a12f60b20a934a7eb8c6e3cdaaac0b1cc}} 
\index{vqmc@{vqmc}!vqmc\_h\_2@{vqmc\_h\_2}}
\index{vqmc\_h\_2@{vqmc\_h\_2}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_h\_2()}{vqmc\_h\_2()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+h\+\_\+2 (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), intent(in)}]{a,  }\item[{real(real64), intent(in)}]{beta,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+a,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+b,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+1\+\_\+burnt,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+2\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), intent(out)}]{energy\+\_\+mean,  }\item[{real(real64), intent(out)}]{energy\+\_\+variance,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{Dphi\+Dbeta\+\_\+chain,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start\+\_\+1,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start\+\_\+2 }\end{DoxyParamCaption})}



Performs VQMC for H\+\_\+2 ~\newline
 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em c\+\_\+const} & Parameter(s) of trial wavefunction \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+a} & Position of hydrogen atom A \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+b} & Position of hydrogen atom B \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start\+\_\+1} & Starting point of 1st MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start\+\_\+2} & Starting point of 2nd MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+1\+\_\+burnt} & The burnt and thinned MCMC chain for random walker 1 \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+2\+\_\+burnt} & The burnt and thinned MCMC chain for random walker 2 \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energies of the each points in the MCMC chains \\
\hline
\end{DoxyParams}


Definition at line 1280 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1283 }
\DoxyCodeLine{1284         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{1285 }
\DoxyCodeLine{1286 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1287 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma}
\DoxyCodeLine{1288 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: a, beta}
\DoxyCodeLine{1289 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)}, \textcolor{keywordtype}{optional} :: x\_start\_1, x\_start\_2}
\DoxyCodeLine{1290         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{1291         }
\DoxyCodeLine{1292          }
\DoxyCodeLine{1293 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate, energy\_mean, energy\_variance}
\DoxyCodeLine{1294 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_1\_burnt\textcolor{comment}{, X\_2\_burnt}}
\DoxyCodeLine{1295 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{1296 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: DphiDbeta\_chain}
\DoxyCodeLine{1297 }
\DoxyCodeLine{1298 \textcolor{keywordtype}{        real}(real64) :: E\_loc}
\DoxyCodeLine{1299 \textcolor{keywordtype}{        real}(real64) :: DphiDbeta}
\DoxyCodeLine{1300 \textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                               \textcolor{comment}{! The natural logarithm of the transition proability }}
\DoxyCodeLine{1301 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                             \textcolor{comment}{! Acceptance ratio of the transitional probability                   }}
\DoxyCodeLine{1302 \textcolor{keywordtype}{        real}(real64) :: unif\_num                                 \textcolor{comment}{! A random sample from the uniform distribution}}
\DoxyCodeLine{1303 \textcolor{keywordtype}{        real}(real64) :: energy2\_mean}
\DoxyCodeLine{1304 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: start\_1, start\_2           \textcolor{comment}{! Starting points for the random walkers }}
\DoxyCodeLine{1305 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: X\_n\_1, X\_n\_2               \textcolor{comment}{! The propsed steps for the random walkers }}
\DoxyCodeLine{1306 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: sample\_normal              \textcolor{comment}{! Sample from the normal distribution }}
\DoxyCodeLine{1307 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_1, X\_2   \textcolor{comment}{! Full MCMC chains }}
\DoxyCodeLine{1308         \textcolor{keywordtype}{integer} :: accept                                        \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{1309         \textcolor{keywordtype}{integer} :: thin\_counter                                  \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{1310         \textcolor{keywordtype}{integer} :: reset\_counter                                 \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{1311         \textcolor{keywordtype}{integer} :: re\_size                                       \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{1312         \textcolor{keywordtype}{integer} :: i\_bt                                          \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{1313         \textcolor{keywordtype}{integer} :: i                                             \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{1314         \textcolor{keywordtype}{character(len=1)} :: acceptance}
\DoxyCodeLine{1315         }
\DoxyCodeLine{1316         \textcolor{keywordflow}{if} (write\_log) \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for beta = ', F7.4)"{}}\textcolor{comment}{) beta}}
\DoxyCodeLine{1317 \textcolor{comment}{}}
\DoxyCodeLine{1318         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{1319         re\_size = (n -\/ burn) / thin }
\DoxyCodeLine{1320 }
\DoxyCodeLine{1321         \textcolor{keyword}{allocate}(x\_1(3, 1:n+1)); x\_1(:, :) = 0.0\_real64}
\DoxyCodeLine{1322         \textcolor{keyword}{allocate}(x\_2(3, 1:n+1)); x\_2(:, :) = 0.0\_real64}
\DoxyCodeLine{1323         \textcolor{keyword}{allocate}(x\_1\_burnt(3, 1:re\_size+1)); x\_1\_burnt(:, :) = 0.0\_real64}
\DoxyCodeLine{1324         \textcolor{keyword}{allocate}(x\_2\_burnt(3, 1:re\_size+1)); x\_2\_burnt(:, :) = 0.0\_real64}
\DoxyCodeLine{1325         \textcolor{keyword}{allocate}(energy\_chain(1:re\_size+1)); energy\_chain(:) = 0.0\_real64}
\DoxyCodeLine{1326         \textcolor{keyword}{allocate}(dphidbeta\_chain(1:re\_size+1)); dphidbeta\_chain(:) = 0.0\_real64}
\DoxyCodeLine{1327 }
\DoxyCodeLine{1328         \textcolor{comment}{! Allow the starting position to take on the default value }}
\DoxyCodeLine{1329         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start\_1) .and. \textcolor{keyword}{present}(x\_start\_2)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1330             start\_1 = x\_start\_1}
\DoxyCodeLine{1331             x\_1(:,1) = start\_1}
\DoxyCodeLine{1332             }
\DoxyCodeLine{1333             start\_2 = x\_start\_2}
\DoxyCodeLine{1334             x\_2(:,1) = start\_2}
\DoxyCodeLine{1335 }
\DoxyCodeLine{1336             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1337                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting from provided Markov chain position:')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{1338 \textcolor{comment}{}                \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('    x1 = ', F12.8, ' y1 = ', F12.8, ' z1 = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1339 \textcolor{comment}{}                    x\_1(1, 1), x\_1(2, 1), x\_1(3, 1)}
\DoxyCodeLine{1340                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('    x2 = ', F12.8, ' y2 = ', F12.8, ' z2 = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1341 \textcolor{comment}{}                    x\_2(1, 1), x\_2(2, 1), x\_2(3, 1)}
\DoxyCodeLine{1342 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1343         \textcolor{keywordflow}{else} }
\DoxyCodeLine{1344             \textcolor{comment}{! Create the initial position of random walker 1 that is within a certain radius}}
\DoxyCodeLine{1345             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1346             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2\%rcut)}
\DoxyCodeLine{1347                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1348 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1349             start\_1 = sample\_normal}
\DoxyCodeLine{1350             x\_1(:,1) = start\_1}
\DoxyCodeLine{1351 }
\DoxyCodeLine{1352             \textcolor{comment}{! Create the initial position of random walker 2 that is within a certain radius}}
\DoxyCodeLine{1353             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1354             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2\%rcut)}
\DoxyCodeLine{1355                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1356 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1357             start\_2 = sample\_normal }
\DoxyCodeLine{1358             x\_2(:,1) = start\_2}
\DoxyCodeLine{1359 \textcolor{keywordflow}{        end if} }
\DoxyCodeLine{1360         }
\DoxyCodeLine{1361         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{1362         accept = 0  }
\DoxyCodeLine{1363         \textcolor{comment}{! Start the counter for the thinning process}}
\DoxyCodeLine{1364         thin\_counter = 0}
\DoxyCodeLine{1365         \textcolor{comment}{! Start the reset counter }}
\DoxyCodeLine{1366         reset\_counter = 0}
\DoxyCodeLine{1367 }
\DoxyCodeLine{1368         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1369             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Sample      X1              Y1             Z1             \&}}
\DoxyCodeLine{1370 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&X2              Y2             Z2             \&}}
\DoxyCodeLine{1371 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&Local Energy     Accepted?')"{}})}
\DoxyCodeLine{1372             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8, '   ', F12.8, \&}}
\DoxyCodeLine{1373 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&'   ', F12.8, '   ', F12.8, ' ', F12.6)"{}}) 1, x\_1(1, 1),\textcolor{comment}{ x\_1(2, 1), x\_1(3, 1),\&}}
\DoxyCodeLine{1374 \textcolor{comment}{}                x\_2(1, 1), x\_2(2, 1), x\_2(3, 1), energy\_chain(1)}
\DoxyCodeLine{1375 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1376 }
\DoxyCodeLine{1377         \textcolor{comment}{! Calculate the local energy of the initial step if not burnt}}
\DoxyCodeLine{1378         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1379             \textcolor{keyword}{call }h\_2\_energy(a, beta, x\_1(:,1), x\_2(:,1), r\_a, r\_b, e\_loc\textcolor{comment}{, dphidbeta)}}
\DoxyCodeLine{1380 \textcolor{comment}{}            energy\_chain(1) = e\_loc}
\DoxyCodeLine{1381             dphidbeta\_chain(1) = dphidbeta}
\DoxyCodeLine{1382             x\_1\_burnt(:, 1) = x\_1(:, 1)}
\DoxyCodeLine{1383             x\_2\_burnt(:, 1) = x\_2(:, 1)}
\DoxyCodeLine{1384 }
\DoxyCodeLine{1385             \textcolor{keywordflow}{do} i = 2, n+1 }
\DoxyCodeLine{1386                 \textcolor{comment}{! Initialize thin counter }}
\DoxyCodeLine{1387                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{1388 }
\DoxyCodeLine{1389                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{1390                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1391                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1392 }
\DoxyCodeLine{1393                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{1394                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1395                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1396 }
\DoxyCodeLine{1397                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{1398                 log\_prob\_n = log(h\_2\_prob(a, beta, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{1399 \textcolor{comment}{}}
\DoxyCodeLine{1400                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1401                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{1402 }
\DoxyCodeLine{1403                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{1404                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{1405 }
\DoxyCodeLine{1406                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{1407                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1408                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{1409                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{1410                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{1411 }
\DoxyCodeLine{1412                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                                        }}
\DoxyCodeLine{1413                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1414                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1415                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1416                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1417                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1418                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1419                         x\_1\_burnt(:, i\_bt) = x\_n\_1}
\DoxyCodeLine{1420                         x\_2\_burnt(:, i\_bt) = x\_n\_2}
\DoxyCodeLine{1421                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1422                         \textcolor{keyword}{call }h\_2\_energy(a, beta, x\_n\_1, x\_n\_2, r\_a, r\_b,\textcolor{comment}{ e\_loc, dphidbeta)}}
\DoxyCodeLine{1423 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{1424                         dphidbeta\_chain(i\_bt) = dphidbeta}
\DoxyCodeLine{1425                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1426                         thin\_counter = 0}
\DoxyCodeLine{1427 }
\DoxyCodeLine{1428                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{1429                         accept = 1 + accept }
\DoxyCodeLine{1430                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{1431 }
\DoxyCodeLine{1432                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1433                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{1434                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{1435 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \& '   ', F12.8, '   ', F12.8, '   ', F12.8, ' ', F12.6, '         ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1436 \textcolor{comment}{}                                    (i-\/burn), x\_1\_burnt(1, i-\/burn), x\_1\_burnt\textcolor{comment}{(2, i-\/burn), x\_1\_burnt(3, i-\/burn),\&}}
\DoxyCodeLine{1437 \textcolor{comment}{}                                    x\_2\_burnt(1, i-\/burn), x\_2\_burnt(2, i\textcolor{comment}{-\/burn), x\_2\_burnt(3, i-\/burn),\&}}
\DoxyCodeLine{1438 \textcolor{comment}{}                                    energy\_chain(i-\/burn), acceptance}
\DoxyCodeLine{1439 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{1440 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{1441 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1442                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{1443                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{1444                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{1445                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{1446                 }
\DoxyCodeLine{1447                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{1448                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1449                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1450                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1451                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1452                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1453                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1454                         x\_1\_burnt(:, i\_bt) = x\_1(:, i-\/1)}
\DoxyCodeLine{1455                         x\_2\_burnt(:, i\_bt) = x\_2(:, i-\/1)}
\DoxyCodeLine{1456                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1457                         \textcolor{keyword}{call }h\_2\_energy(a, beta, x\_1(:, i-\/1), x\_2(:, i-\/1\textcolor{comment}{), r\_a, r\_b, e\_loc, dphidbeta)}}
\DoxyCodeLine{1458 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{1459                         dphidbeta\_chain(i\_bt) = dphidbeta}
\DoxyCodeLine{1460                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1461                         thin\_counter = 0}
\DoxyCodeLine{1462 }
\DoxyCodeLine{1463                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{1464 }
\DoxyCodeLine{1465                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1466                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{1467                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{1468 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \& '   ', F12.8, '   ', F12.8, '   ', F12.8, ' ', F12.6, '         ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1469 \textcolor{comment}{}                                    (i\_bt), x\_1\_burnt(1, i\_bt), x\_1\_burnt\textcolor{comment}{(2, i\_bt), x\_1\_burnt(3, i\_bt),\&}}
\DoxyCodeLine{1470 \textcolor{comment}{}                                    x\_2\_burnt(1, i\_bt), x\_2\_burnt(2, i\_bt\textcolor{comment}{), x\_2\_burnt(3, i\_bt),\&}}
\DoxyCodeLine{1471 \textcolor{comment}{}                                    energy\_chain(i\_bt), acceptance}
\DoxyCodeLine{1472 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{1473 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{1474 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1475 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1476 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1477         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1478             \textcolor{keywordflow}{do} i = 2, burn }
\DoxyCodeLine{1479                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{1480                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1481                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1482 }
\DoxyCodeLine{1483                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{1484                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1485                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1486 }
\DoxyCodeLine{1487                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{1488                 log\_prob\_n = log(h\_2\_prob(a, beta, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{1489 \textcolor{comment}{}}
\DoxyCodeLine{1490                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1491                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{1492 }
\DoxyCodeLine{1493                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{1494                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{1495 }
\DoxyCodeLine{1496                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{1497                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1498                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{1499                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{1500                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{1501                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{1502                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{1503                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{1504                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{1505 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1506 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1507 }
\DoxyCodeLine{1508             \textcolor{keywordflow}{if} (write\_log) \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Burning steps completed. -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{1509 \textcolor{comment}{}}
\DoxyCodeLine{1510 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1511 }
\DoxyCodeLine{1512         \textcolor{comment}{! Run MCMC chain with burning and thinning}}
\DoxyCodeLine{1513         \textcolor{keywordflow}{if} (burn >= 1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1514             \textcolor{comment}{! Metropolis algorithm }}
\DoxyCodeLine{1515             \textcolor{keywordflow}{do} i = (burn + 1) , n+1 }
\DoxyCodeLine{1516                 \textcolor{comment}{! Initialize thin counter }}
\DoxyCodeLine{1517                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{1518                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{1519                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1520                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1521 }
\DoxyCodeLine{1522                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{1523                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1524                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1525 }
\DoxyCodeLine{1526                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{1527                 log\_prob\_n = log(h\_2\_prob(a, beta, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{1528 \textcolor{comment}{}}
\DoxyCodeLine{1529                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1530                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{1531 }
\DoxyCodeLine{1532                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{1533                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{1534 }
\DoxyCodeLine{1535                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{1536                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1537                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{1538                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{1539                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{1540 }
\DoxyCodeLine{1541                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                    }}
\DoxyCodeLine{1542                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1543                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1544                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1545                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1546                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1547                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1548                         x\_1\_burnt(:, i\_bt) = x\_n\_1}
\DoxyCodeLine{1549                         x\_2\_burnt(:, i\_bt) = x\_n\_2}
\DoxyCodeLine{1550                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1551                         \textcolor{keyword}{call }h\_2\_energy(a, beta, x\_n\_1, x\_n\_2, r\_a, r\_b,\textcolor{comment}{ e\_loc, dphidbeta)}}
\DoxyCodeLine{1552 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{1553                         dphidbeta\_chain(i\_bt) = dphidbeta}
\DoxyCodeLine{1554                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1555                         thin\_counter = 0}
\DoxyCodeLine{1556 }
\DoxyCodeLine{1557                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{1558                         accept = 1 + accept }
\DoxyCodeLine{1559                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{1560 }
\DoxyCodeLine{1561                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1562                             \textcolor{keywordflow}{if} (mod(i-\/burn, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{1563                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{1564 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \& '   ', F12.8, '   ', F12.8, '   ', F12.8, ' ', F12.6, '         ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1565 \textcolor{comment}{}                                    (i\_bt), x\_1\_burnt(1, i\_bt), x\_1\_burnt\textcolor{comment}{(2, i\_bt), x\_1\_burnt(3, i\_bt),\&}}
\DoxyCodeLine{1566 \textcolor{comment}{}                                    x\_2\_burnt(1, i\_bt), x\_2\_burnt(2, i\_bt\textcolor{comment}{), x\_2\_burnt(3, i\_bt),\&}}
\DoxyCodeLine{1567 \textcolor{comment}{}                                    energy\_chain(i\_bt), acceptance}
\DoxyCodeLine{1568 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{1569 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{1570 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1571                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{1572                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{1573                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{1574                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{1575                 }
\DoxyCodeLine{1576                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                }}
\DoxyCodeLine{1577                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1578                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1579                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1580                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1581                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1582                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1583                         x\_1\_burnt(:, i\_bt) = x\_1(:, i-\/1)}
\DoxyCodeLine{1584                         x\_2\_burnt(:, i\_bt) = x\_2(:, i-\/1)}
\DoxyCodeLine{1585                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1586                         \textcolor{keyword}{call }h\_2\_energy(a, beta, x\_1(:, i-\/1), x\_2(:, i-\/1\textcolor{comment}{), r\_a, r\_b, e\_loc, dphidbeta)}}
\DoxyCodeLine{1587 \textcolor{comment}{}                        energy\_chain(i\_bt) = e\_loc}
\DoxyCodeLine{1588                         dphidbeta\_chain(i\_bt) = dphidbeta}
\DoxyCodeLine{1589                         \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1590                         thin\_counter = 0}
\DoxyCodeLine{1591 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1592 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1593 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1594 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1595 }
\DoxyCodeLine{1596         \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1597         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{))}}
\DoxyCodeLine{1598 \textcolor{comment}{}}
\DoxyCodeLine{1599         \textcolor{comment}{! Calculate the mean energy and the variance in the energy}}
\DoxyCodeLine{1600         energy\_mean = sum(energy\_chain) / real(re\_size, kind=real64)}
\DoxyCodeLine{1601         energy2\_mean = 0.0\_real64}
\DoxyCodeLine{1602         \textcolor{keywordflow}{do} i = 1, re\_size}
\DoxyCodeLine{1603             energy2\_mean = energy2\_mean + energy\_chain(i)*energy\_chain(i\textcolor{comment}{) }}
\DoxyCodeLine{1604 \textcolor{comment}{}\textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1605         energy\_variance = (1.0\_real64 / real(re\_size-\/1, kind=real64)) * \textcolor{comment}{\& }}
\DoxyCodeLine{1606 \textcolor{comment}{}            (energy2\_mean -\/ (1/real(re\_size, kind=real64)) * energy\_mean\textcolor{comment}{ * energy\_mean)}}
\DoxyCodeLine{1607 \textcolor{comment}{}}
\DoxyCodeLine{1608         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1609             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Local energy = ', F12.8)"{}}) energy\_mean}
\DoxyCodeLine{1610             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Variance = ', F12.8)"{}}) energy\_variance}
\DoxyCodeLine{1611             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Acceptance rate = ', F12.8)"{}}) accept\_rate}
\DoxyCodeLine{1612             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1613 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1614 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a12f60b20a934a7eb8c6e3cdaaac0b1cc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a12f60b20a934a7eb8c6e3cdaaac0b1cc_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a70dc752a6b037f137c1264dd8753bac2}\label{namespacevqmc_a70dc752a6b037f137c1264dd8753bac2}} 
\index{vqmc@{vqmc}!auto\_h\_2@{auto\_h\_2}}
\index{auto\_h\_2@{auto\_h\_2}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{auto\_h\_2()}{auto\_h\_2()}}
{\footnotesize\ttfamily subroutine vqmc\+::auto\+\_\+h\+\_\+2 (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{a,  }\item[{real(real64), intent(in)}]{beta\+\_\+in,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{real(real64), intent(out)}]{beta\+\_\+out,  }\item[{real(real64), intent(out)}]{energy\+\_\+out,  }\item[{real(real64), intent(out)}]{variance\+\_\+out,  }\item[{real(real64), intent(out)}]{accept\+\_\+out,  }\item[{character(len=1), intent(out)}]{converged }\end{DoxyParamCaption})}



Definition at line 1620 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1622 }
\DoxyCodeLine{1623         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1624 }
\DoxyCodeLine{1625 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: a}
\DoxyCodeLine{1626 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: beta\_in}
\DoxyCodeLine{1627 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1628 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: beta\_out}
\DoxyCodeLine{1629 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: energy\_out}
\DoxyCodeLine{1630 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: variance\_out}
\DoxyCodeLine{1631 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_out}
\DoxyCodeLine{1632         \textcolor{keywordtype}{character(len=1)}, \textcolor{keywordtype}{intent(out)} :: converged}
\DoxyCodeLine{1633 }
\DoxyCodeLine{1634 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1635 \textcolor{keywordtype}{        real}(real64) :: beta\_current, beta\_new}
\DoxyCodeLine{1636 \textcolor{keywordtype}{        real}(real64) :: beta\_grad}
\DoxyCodeLine{1637 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: e1\_pos\_chain, e2\_pos\_chain}
\DoxyCodeLine{1638 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain, DphiDbeta\_chain}
\DoxyCodeLine{1639         \textcolor{keywordtype}{integer} :: k}
\DoxyCodeLine{1640         \textcolor{keywordtype}{integer} :: maxiter = 200}
\DoxyCodeLine{1641 \textcolor{keywordtype}{        real}(real64) :: tol = 1e-\/4\_real64}
\DoxyCodeLine{1642 }
\DoxyCodeLine{1643         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1644         beta\_current = beta\_in}
\DoxyCodeLine{1645         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1646         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1647 }
\DoxyCodeLine{1648         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1649             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting parameter search for beta...')"{}})}
\DoxyCodeLine{1650 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1651 }
\DoxyCodeLine{1652         \textcolor{comment}{! Main iteration loop}}
\DoxyCodeLine{1653         \textcolor{keywordflow}{do} k = 1, maxiter}
\DoxyCodeLine{1654 }
\DoxyCodeLine{1655             \textcolor{comment}{! Calculate gradient at current beta}}
\DoxyCodeLine{1656             \textcolor{keyword}{call }vqmc\_h\_2(h2\%sigma, h2\%steps, h2\%burn\_step, h2\%thin\_step\textcolor{comment}{, a, \&}}
\DoxyCodeLine{1657 \textcolor{comment}{}                    beta\_current, r\_a, r\_b, e1\_pos\_chain, e2\_pos\_chain, accept\_out\textcolor{comment}{, \&}}
\DoxyCodeLine{1658 \textcolor{comment}{}                    energy\_chain, energy\_out, variance\_out, dphidbeta\_chain\textcolor{comment}{)}}
\DoxyCodeLine{1659 \textcolor{comment}{}            beta\_grad = 2.0\_real64 * ((sum(energy\_chain * dphidbeta\_chain\textcolor{comment}{) / }\textcolor{keyword}{size}\textcolor{comment}{(energy\_chain)) \&}}
\DoxyCodeLine{1660 \textcolor{comment}{}                -\/ energy\_out * (sum(dphidbeta\_chain) / \textcolor{keyword}{size}(energy\_chain\textcolor{comment}{)))}}
\DoxyCodeLine{1661 \textcolor{comment}{}            \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1662                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Beta            Gradient')"{}})}
\DoxyCodeLine{1663                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F13.7, '    ', F13.7)"{}}) beta\_current, beta\_grad}
\DoxyCodeLine{1664 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1665 }
\DoxyCodeLine{1666             \textcolor{comment}{! Check if gradient is within tolerance.}}
\DoxyCodeLine{1667             \textcolor{keywordflow}{if} (abs(beta\_grad) .le. tol) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1668                 beta\_out = beta\_current}
\DoxyCodeLine{1669                 converged = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{1670                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1671                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Parameter search converged!')"{}})}
\DoxyCodeLine{1672                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1673                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Beta = ', F13.7, ', Energy = ', F12.8, ', Variance = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1674 \textcolor{comment}{}                        beta\_current, energy\_out, variance\_out}
\DoxyCodeLine{1675                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1676 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{1677                 \textcolor{keywordflow}{exit}}
\DoxyCodeLine{1678 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1679 }
\DoxyCodeLine{1680             \textcolor{comment}{! If not, update beta by steepest descent.}}
\DoxyCodeLine{1681             \textcolor{keyword}{call }h\_2\_update\_beta(beta\_current, beta\_grad, beta\_new)}
\DoxyCodeLine{1682             beta\_current = beta\_new}
\DoxyCodeLine{1683 }
\DoxyCodeLine{1684 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1685 }
\DoxyCodeLine{1686         \textcolor{comment}{! Deal with non-\/convergence}}
\DoxyCodeLine{1687         \textcolor{keywordflow}{if} (k .ge. maxiter) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1688             converged = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{1689             beta\_out = beta\_current}
\DoxyCodeLine{1690             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1691                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Parameter search NOT converged! Consider changing\&}}
\DoxyCodeLine{1692 \textcolor{stringliteral}{}\textcolor{stringliteral}{                    \& the starting value of beta, or the damping in the H\_2\_update\_beta\&}}
\DoxyCodeLine{1693 \textcolor{stringliteral}{}\textcolor{stringliteral}{                    \& function.')"{}})}
\DoxyCodeLine{1694 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{1695 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1696 }
\DoxyCodeLine{1697         \textcolor{comment}{! Report results}}
\DoxyCodeLine{1698         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   ', A, '             ', F13.7, '      ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1699 \textcolor{comment}{}            bond\_length, converged, beta\_out, energy\_out}
\DoxyCodeLine{1700         }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a70dc752a6b037f137c1264dd8753bac2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{namespacevqmc_a70dc752a6b037f137c1264dd8753bac2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a08bc46270707aab6c2d5114b589c176c}\label{namespacevqmc_a08bc46270707aab6c2d5114b589c176c}} 
\index{vqmc@{vqmc}!grid\_h\_2@{grid\_h\_2}}
\index{grid\_h\_2@{grid\_h\_2}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{grid\_h\_2()}{grid\_h\_2()}}
{\footnotesize\ttfamily subroutine vqmc\+::grid\+\_\+h\+\_\+2 (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{a,  }\item[{real(real64), dimension(\+:), intent(in)}]{beta\+\_\+array,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{real(real64), intent(out)}]{beta\+\_\+out,  }\item[{real(real64), intent(out)}]{energy\+\_\+out,  }\item[{real(real64), intent(out)}]{variance\+\_\+out,  }\item[{real(real64), intent(out)}]{accept\+\_\+out }\end{DoxyParamCaption})}



Definition at line 1706 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1708     }
\DoxyCodeLine{1709         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1710 }
\DoxyCodeLine{1711 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: a}
\DoxyCodeLine{1712 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: beta\_array}
\DoxyCodeLine{1713 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1714 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: beta\_out}
\DoxyCodeLine{1715 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: energy\_out}
\DoxyCodeLine{1716 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: variance\_out}
\DoxyCodeLine{1717 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_out}
\DoxyCodeLine{1718 }
\DoxyCodeLine{1719 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1720 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: e1\_pos\_chain, e2\_pos\_chain}
\DoxyCodeLine{1721 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain, DphiDbeta\_chain}
\DoxyCodeLine{1722 \textcolor{keywordtype}{        real}(real64) :: accept\_rate, energy, variance}
\DoxyCodeLine{1723 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: param\_energies, param\_accepts\textcolor{comment}{, param\_variances}}
\DoxyCodeLine{1724 \textcolor{comment}{        }\textcolor{keywordtype}{integer} :: i}
\DoxyCodeLine{1725 }
\DoxyCodeLine{1726         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1727         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1728         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1729         \textcolor{keyword}{allocate}(param\_energies(\textcolor{keyword}{size}(beta\_array)))}
\DoxyCodeLine{1730         \textcolor{keyword}{allocate}(param\_accepts(\textcolor{keyword}{size}(beta\_array)))}
\DoxyCodeLine{1731         \textcolor{keyword}{allocate}(param\_variances(\textcolor{keyword}{size}(beta\_array)))}
\DoxyCodeLine{1732 }
\DoxyCodeLine{1733         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1734             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting parameter search for beta...')"{}})}
\DoxyCodeLine{1735 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1736 }
\DoxyCodeLine{1737         \textcolor{comment}{! Loop over beta values}}
\DoxyCodeLine{1738         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(beta\_array)}
\DoxyCodeLine{1739 }
\DoxyCodeLine{1740             \textcolor{comment}{! Calculate energy at current value of beta}}
\DoxyCodeLine{1741             \textcolor{keyword}{call }vqmc\_h\_2(h2\%sigma, h2\%steps, h2\%burn\_step, h2\%thin\_step\textcolor{comment}{, a, \&}}
\DoxyCodeLine{1742 \textcolor{comment}{}                    beta\_array(i), r\_a, r\_b, e1\_pos\_chain, e2\_pos\_chain,\textcolor{comment}{ accept\_rate, \&}}
\DoxyCodeLine{1743 \textcolor{comment}{}                    energy\_chain, energy, variance, dphidbeta\_chain)}
\DoxyCodeLine{1744             \textcolor{comment}{! Save energy}}
\DoxyCodeLine{1745             param\_energies(i) = energy}
\DoxyCodeLine{1746             param\_variances(i) = variance}
\DoxyCodeLine{1747             param\_accepts(i) = accept\_rate}
\DoxyCodeLine{1748 }
\DoxyCodeLine{1749 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1750 }
\DoxyCodeLine{1751         \textcolor{comment}{! Select lowest energy and corresponding beta value}}
\DoxyCodeLine{1752         energy\_out = minval(param\_energies)}
\DoxyCodeLine{1753         beta\_out = beta\_array(minloc(param\_energies, 1))}
\DoxyCodeLine{1754         variance\_out = param\_variances(minloc(param\_energies, 1))}
\DoxyCodeLine{1755         accept\_out = param\_accepts(minloc(param\_energies, 1))}
\DoxyCodeLine{1756 }
\DoxyCodeLine{1757         \textcolor{comment}{! Report results}}
\DoxyCodeLine{1758         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   -\/             ', F13.7, '      ', F12.8)"{}})\textcolor{comment}{ \&}}
\DoxyCodeLine{1759 \textcolor{comment}{}            bond\_length, beta\_out, energy\_out}
\DoxyCodeLine{1760 }
\DoxyCodeLine{1761         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1762             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1763             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('beta             Energy')"{}})}
\DoxyCodeLine{1764             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(beta\_array)}
\DoxyCodeLine{1765                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) beta\_array(i), param\_energies\textcolor{comment}{(i)}}
\DoxyCodeLine{1766 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{1767             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1768             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Min Energy = ', F12.8, ' at c = ', F12.8)"{}}) energy\_out\textcolor{comment}{, beta\_out}}
\DoxyCodeLine{1769 \textcolor{comment}{}            \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1770 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1771     }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a08bc46270707aab6c2d5114b589c176c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=313pt]{namespacevqmc_a08bc46270707aab6c2d5114b589c176c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_ab066adc59fec1fcaaba764a46128c935}\label{namespacevqmc_ab066adc59fec1fcaaba764a46128c935}} 
\index{vqmc@{vqmc}!equil\_h\_2@{equil\_h\_2}}
\index{equil\_h\_2@{equil\_h\_2}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{equil\_h\_2()}{equil\_h\_2()}}
{\footnotesize\ttfamily subroutine vqmc\+::equil\+\_\+h\+\_\+2 (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{a,  }\item[{real(real64), dimension(\+:), intent(in)}]{beta\+\_\+array,  }\item[{real(real64), intent(in)}]{bond\+\_\+length,  }\item[{integer, intent(in)}]{bonds\+\_\+pos }\end{DoxyParamCaption})}



Definition at line 1777 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{1778 }
\DoxyCodeLine{1779         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{1780 }
\DoxyCodeLine{1781 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: a}
\DoxyCodeLine{1782 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: beta\_array}
\DoxyCodeLine{1783 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: bond\_length}
\DoxyCodeLine{1784         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: bonds\_pos}
\DoxyCodeLine{1785 }
\DoxyCodeLine{1786 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{1787 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{1788 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energies}
\DoxyCodeLine{1789 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: e1\_pos\_chain, e2\_pos\_chain}
\DoxyCodeLine{1790 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain, DphiDbeta\_chain}
\DoxyCodeLine{1791 \textcolor{keywordtype}{        real}(real64) :: accept\_rate}
\DoxyCodeLine{1792 \textcolor{keywordtype}{        real}(real64) :: energy\_mean}
\DoxyCodeLine{1793 \textcolor{keywordtype}{        real}(real64) :: energy\_variance}
\DoxyCodeLine{1794         \textcolor{keywordtype}{integer} :: i, ierr}
\DoxyCodeLine{1795         \textcolor{keywordtype}{character(len=3)} :: str\_i, str\_b}
\DoxyCodeLine{1796         \textcolor{keywordtype}{character(len=40)} :: equilfile}
\DoxyCodeLine{1797 }
\DoxyCodeLine{1798         \textcolor{comment}{! Initialise}}
\DoxyCodeLine{1799         r\_a = (/-\/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1800         r\_b = (/bond\_length/2, 0.0\_real64, 0.0\_real64/)}
\DoxyCodeLine{1801         \textcolor{keyword}{allocate}(energies(\textcolor{keyword}{size}(beta\_array))); energies(:) = 0.0\_real64}
\DoxyCodeLine{1802         \textcolor{keyword}{allocate}(variances(\textcolor{keyword}{size}(beta\_array)))}
\DoxyCodeLine{1803 }
\DoxyCodeLine{1804         \textcolor{comment}{! Loop over values of beta}}
\DoxyCodeLine{1805         \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(beta\_array)}
\DoxyCodeLine{1806 }
\DoxyCodeLine{1807             \textcolor{comment}{! Calculate energy at current value of beta}}
\DoxyCodeLine{1808             \textcolor{keyword}{call }vqmc\_h\_2(h2\%sigma, h2\%steps, h2\%burn\_step, h2\%thin\_step\textcolor{comment}{, a, \&}}
\DoxyCodeLine{1809 \textcolor{comment}{}                    beta\_array(i), r\_a, r\_b, e1\_pos\_chain, e2\_pos\_chain,\textcolor{comment}{ accept\_rate, \&}}
\DoxyCodeLine{1810 \textcolor{comment}{}                    energy\_chain, energy\_mean, energy\_variance, dphidbeta\_chain\textcolor{comment}{)}}
\DoxyCodeLine{1811 \textcolor{comment}{}            \textcolor{comment}{! Save energy}}
\DoxyCodeLine{1812             energies(i) = energy\_mean}
\DoxyCodeLine{1813 }
\DoxyCodeLine{1814             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F12.8, '   -\/             ', F13.7, '      ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{1815 \textcolor{comment}{}                bond\_length, beta\_array(i), energies(i)}
\DoxyCodeLine{1816 }
\DoxyCodeLine{1817             \textcolor{comment}{! Save the energy trace for each value of c}}
\DoxyCodeLine{1818             \textcolor{keyword}{write}(str\_i, \textcolor{stringliteral}{"{}(I3)"{}}) i}
\DoxyCodeLine{1819             \textcolor{keyword}{write}(str\_b, \textcolor{stringliteral}{"{}(I3)"{}}) bonds\_pos}
\DoxyCodeLine{1820             \textcolor{keyword}{write}(equilfile, \textcolor{stringliteral}{"{}(5A)"{}}) \textcolor{stringliteral}{'./equil\_out/b'}, trim(adjustl(str\_b\textcolor{comment}{)), \&}}
\DoxyCodeLine{1821 \textcolor{comment}{}                \textcolor{stringliteral}{'\_beta'}, trim(adjustl(str\_i)), \textcolor{stringliteral}{'.nc'}}
\DoxyCodeLine{1822             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{'Writing equilibration outfile to '}, equilfile}
\DoxyCodeLine{1823             \textcolor{keyword}{call }write\_h2\_equilibration(energy\_chain, equilfile, ierr, h2\textcolor{comment}{, \&}}
\DoxyCodeLine{1824 \textcolor{comment}{}                accept\_rate)}
\DoxyCodeLine{1825 }
\DoxyCodeLine{1826 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{1827 }
\DoxyCodeLine{1828         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1829             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Results:')"{}})}
\DoxyCodeLine{1830             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('beta             Energy')"{}})}
\DoxyCodeLine{1831             \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(beta\_array)}
\DoxyCodeLine{1832                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8, '    ', F12.8)"{}}) beta\_array(i), energies\textcolor{comment}{(i)}}
\DoxyCodeLine{1833 \textcolor{comment}{}\textcolor{keywordflow}{            end do}}
\DoxyCodeLine{1834             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{1835 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1836 }
\DoxyCodeLine{1837         \textcolor{keyword}{deallocate}(energies)}
\DoxyCodeLine{1838         \textcolor{keyword}{deallocate}(variances)}
\DoxyCodeLine{1839     }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_ab066adc59fec1fcaaba764a46128c935_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=317pt]{namespacevqmc_ab066adc59fec1fcaaba764a46128c935_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}\label{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}} 
\index{vqmc@{vqmc}!ntab@{ntab}}
\index{ntab@{ntab}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{ntab}{ntab}}
{\footnotesize\ttfamily integer, parameter vqmc\+::ntab = 32}



Definition at line 33 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{33     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{parameter} :: ntab = 32}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}\label{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}} 
\index{vqmc@{vqmc}!iv@{iv}}
\index{iv@{iv}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{iv}{iv}}
{\footnotesize\ttfamily integer(int64), dimension(\mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}}), save vqmc\+::iv = 0}



Definition at line 34 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{34     \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{dimension(ntab)}, \textcolor{keywordtype}{save} :: iv = 0 \textcolor{comment}{! 'threadprivate' by default since using MPI}}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a1608372d703310a49afc4243ccf27368}\label{namespacevqmc_a1608372d703310a49afc4243ccf27368}} 
\index{vqmc@{vqmc}!iy@{iy}}
\index{iy@{iy}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{iy}{iy}}
{\footnotesize\ttfamily integer(int64), save vqmc\+::iy = 0}



Definition at line 35 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{35     \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{save} :: iy = 0}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a986f071589794992c4bc31de25c63976}\label{namespacevqmc_a986f071589794992c4bc31de25c63976}} 
\index{vqmc@{vqmc}!seed@{seed}}
\index{seed@{seed}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{seed}{seed}}
{\footnotesize\ttfamily integer(int64), public vqmc\+::seed}



Definition at line 36 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{36     \textcolor{keywordtype}{integer(int64)} :: seed}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}\label{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}} 
\index{vqmc@{vqmc}!logfrac@{logfrac}}
\index{logfrac@{logfrac}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{logfrac}{logfrac}}
{\footnotesize\ttfamily integer vqmc\+::logfrac = 10}



Definition at line 38 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{38     \textcolor{keywordtype}{integer} :: logfrac = 10 \textcolor{comment}{! [TEMPORARY PLACEMENT] 1/logfrac is the fraction of samples to report in the log}}

\end{DoxyCode}
