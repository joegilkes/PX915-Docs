\hypertarget{namespacevqmc}{}\doxysection{vqmc Module Reference}
\label{namespacevqmc}\index{vqmc@{vqmc}}


Contains a random number generator, a sub-\/routine that draws from a normal distribution and a VQMC solver for the three different problems.  


\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacevqmc_aed182179994b5465f5466b4d909a764e}{init\+\_\+ran1}} ()
\begin{DoxyCompactList}\small\item\em Initialise random number generator by drawing a seed from /dev/urandom. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}{ran1}} (sample, dseed)
\begin{DoxyCompactList}\small\item\em Implementation of David Quigley\textquotesingle{}s random number generator. \end{DoxyCompactList}\item 
real(real64) function, dimension(\+:), allocatable \mbox{\hyperlink{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}{linspace}} (start, end, num)
\begin{DoxyCompactList}\small\item\em Adaptation of numpy\textquotesingle{}s linspace function. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}{random\+\_\+normal}} (dim, x)
\begin{DoxyCompactList}\small\item\em Draws a sample from a normal distribution. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_ac8a07ca12229e28074bf9088be5c2b5c}{vqmc\+\_\+qho}} (sigma, N, burn, thin, alpha\+\_\+const, X\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, x\+\_\+start)
\begin{DoxyCompactList}\small\item\em Performs VQMC for QHO. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_adef1f40504be89d534ea89658a169aad}{vqmc\+\_\+h\+\_\+2\+\_\+plus}} (sigma, N, burn, thin, c\+\_\+const, R\+\_\+a, R\+\_\+b, X\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, x\+\_\+start)
\begin{DoxyCompactList}\small\item\em Performs VQMC for H\+\_\+2\+\_\+plus ~\newline
 \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespacevqmc_ac00c311b77347b5ed6258bb64214dd9f}{vqmc\+\_\+h\+\_\+2}} (sigma, N, burn, thin, c\+\_\+const, R\+\_\+a, R\+\_\+b, X\+\_\+1\+\_\+burnt, X\+\_\+2\+\_\+burnt, accept\+\_\+rate, energy\+\_\+chain, x\+\_\+start\+\_\+1, x\+\_\+start\+\_\+2)
\begin{DoxyCompactList}\small\item\em Performs VQMC for H\+\_\+2 ~\newline
 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
integer, parameter \mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}} = 32
\item 
integer(int64), dimension(\mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}}), save \mbox{\hyperlink{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}{iv}} = 0
\item 
integer(int64), save \mbox{\hyperlink{namespacevqmc_a1608372d703310a49afc4243ccf27368}{iy}} = 0
\item 
integer(int64), public \mbox{\hyperlink{namespacevqmc_a986f071589794992c4bc31de25c63976}{seed}}
\item 
integer \mbox{\hyperlink{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}{logfrac}} = 10
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Contains a random number generator, a sub-\/routine that draws from a normal distribution and a VQMC solver for the three different problems. 

Module contains the VQMC solver for quantum harmonic oscillator (QHO), hydrogen ion (H\+\_\+2\+\_\+plus) and hydrogen molecule (H\+\_\+2). It also has the sub\+\_\+routine random normal which generates a sample from a normal distribution using the Box-\/\+Muller transfrom, which is needed for the Metropolis algorythm used in VQMC. The VQMC solvers uses the module \textquotesingle{}solvers\textquotesingle{} to obtain the transitional probabilities needed for the Metropolis algorythm and to calculate the local energies given the position of the random walker. 

\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacevqmc_aed182179994b5465f5466b4d909a764e}\label{namespacevqmc_aed182179994b5465f5466b4d909a764e}} 
\index{vqmc@{vqmc}!init\_ran1@{init\_ran1}}
\index{init\_ran1@{init\_ran1}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{init\_ran1()}{init\_ran1()}}
{\footnotesize\ttfamily subroutine vqmc\+::init\+\_\+ran1}



Initialise random number generator by drawing a seed from /dev/urandom. 



Definition at line 59 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{60 }
\DoxyCodeLine{61         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         \textcolor{keywordtype}{integer} :: fu, rc, l\_seed}
\DoxyCodeLine{64         \textcolor{keywordtype}{character(len=30)} :: c\_seed}
\DoxyCodeLine{65 }
\DoxyCodeLine{66         \textcolor{keyword}{open} (access=\textcolor{stringliteral}{'stream'}, action=\textcolor{stringliteral}{'read'}, file=\textcolor{stringliteral}{'/dev/urandom'}, \&}
\DoxyCodeLine{67         form=\textcolor{stringliteral}{'unformatted'}, iostat=rc, newunit=fu)}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         \textcolor{keywordflow}{if} (rc == 0) \textcolor{keyword}{read} (fu) seed}
\DoxyCodeLine{70 }
\DoxyCodeLine{71         \textcolor{keyword}{close} (fu)}
\DoxyCodeLine{72 }
\DoxyCodeLine{73         \textcolor{keyword}{write}(c\_seed, \textcolor{stringliteral}{"{}(I30)"{}}) seed}
\DoxyCodeLine{74         l\_seed = len(c\_seed)}
\DoxyCodeLine{75         c\_seed = adjustl(c\_seed)}
\DoxyCodeLine{76         c\_seed = c\_seed(7:l\_seed)}
\DoxyCodeLine{77         \textcolor{keyword}{read}(c\_seed, *) seed}
\DoxyCodeLine{78 }
\DoxyCodeLine{79         \textcolor{keywordflow}{if} (seed .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{80             seed = -\/seed}
\DoxyCodeLine{81 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{84             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Initial seed from /dev/urandom: ', I20)"{}}) seed}
\DoxyCodeLine{85             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{86 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{87 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=236pt]{namespacevqmc_aed182179994b5465f5466b4d909a764e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}\label{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651}} 
\index{vqmc@{vqmc}!ran1@{ran1}}
\index{ran1@{ran1}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{ran1()}{ran1()}}
{\footnotesize\ttfamily subroutine vqmc\+::ran1 (\begin{DoxyParamCaption}\item[{real(real64), intent(out)}]{sample,  }\item[{integer(int64), intent(inout)}]{dseed }\end{DoxyParamCaption})}



Implementation of David Quigley\textquotesingle{}s random number generator. 

Variable dseed must be a negative integer. 

Definition at line 102 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{103 }
\DoxyCodeLine{104         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106         \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{intent(inout)} :: dseed}
\DoxyCodeLine{107 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: sample}
\DoxyCodeLine{108 }
\DoxyCodeLine{109         \textcolor{comment}{! Constants defined in Press et al}}
\DoxyCodeLine{110         \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{parameter} :: ia = 16807, im = 2147483647, iq = 1\textcolor{comment}{27773}}
\DoxyCodeLine{111 \textcolor{comment}{}        \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{parameter} :: ir = 2836, \&}
\DoxyCodeLine{112                                      ndiv = 1 + floor((real(im, kind=real64\textcolor{comment}{)-\/1.0)/ntab)}}
\DoxyCodeLine{113 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{parameter} :: am = 1.0/real(im, kind=real64), eps =\textcolor{comment}{ 1.2e-\/7, \&}}
\DoxyCodeLine{114 \textcolor{comment}{}                                   rnmx = 1.0-\/eps}
\DoxyCodeLine{115 }
\DoxyCodeLine{116         \textcolor{comment}{! Loop counters}}
\DoxyCodeLine{117         \textcolor{keywordtype}{integer(int64)} :: j, k}
\DoxyCodeLine{118 }
\DoxyCodeLine{119         \textcolor{comment}{! The following is transcribed directly from Press et al}}
\DoxyCodeLine{120         \textcolor{keywordflow}{if} (dseed<=0 .or. iy==0) \textcolor{keywordflow}{then} \textcolor{comment}{! initialization}}
\DoxyCodeLine{121                                       \textcolor{comment}{! NB this may need to be modified to allow for restarting as iy will be 0}}
\DoxyCodeLine{122             dseed = max(-\/dseed,1)}
\DoxyCodeLine{123 }
\DoxyCodeLine{124             \textcolor{keywordflow}{do} j = ntab+8, 1, -\/1}
\DoxyCodeLine{125                 k = floor(real(dseed, kind=real64)/real(iq, kind=real64)\textcolor{comment}{)}}
\DoxyCodeLine{126 \textcolor{comment}{}                dseed = ia * (dseed-\/k*iq) -\/ ir * k}
\DoxyCodeLine{127                 \textcolor{keywordflow}{if} (dseed < 0) dseed = dseed + im}
\DoxyCodeLine{128                 \textcolor{keywordflow}{if} (j <= ntab) iv(j) = dseed}
\DoxyCodeLine{129 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131             iy = iv(1)}
\DoxyCodeLine{132 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134         k = floor(real(dseed, kind=real64)/real(iq, kind=real64))}
\DoxyCodeLine{135         dseed = ia * (dseed-\/k*iq) -\/ ir * k}
\DoxyCodeLine{136         \textcolor{keywordflow}{if} (dseed < 0) dseed = dseed + im}
\DoxyCodeLine{137         j = 1\_int64 + iy / ndiv}
\DoxyCodeLine{138         iy = iv(j)}
\DoxyCodeLine{139         iv(j) = dseed}
\DoxyCodeLine{140         sample = min(am*iy, rnmx)}
\DoxyCodeLine{141 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a01b80444204a0cd0b5cddde82cbc7651_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}\label{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359}} 
\index{vqmc@{vqmc}!linspace@{linspace}}
\index{linspace@{linspace}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{linspace()}{linspace()}}
{\footnotesize\ttfamily real(real64) function, dimension(\+:), allocatable vqmc\+::linspace (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{start,  }\item[{real(real64), intent(in)}]{end,  }\item[{real(real64), intent(in)}]{num }\end{DoxyParamCaption})}



Adaptation of numpy\textquotesingle{}s linspace function. 

Uses a REAL value for num for compatbility with parameter arrays, then converts to int internally. Returns a length 1 array just containing the start value if num is equal to 1. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em start} & Starting value of the sequence \\
\hline
\mbox{\texttt{ in}}  & {\em end} & End value of the sequence \\
\hline
\mbox{\texttt{ in}}  & {\em num} & Number of samples to generate between start and end value ~\newline
 \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em ls\+\_\+array} & An array with evenly specified numbers over an interval \\
\hline
\end{DoxyRetVals}


Definition at line 166 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{167 }
\DoxyCodeLine{168         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: start, end, num}
\DoxyCodeLine{171 }
\DoxyCodeLine{172 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: ls\_array}
\DoxyCodeLine{173 }
\DoxyCodeLine{174         \textcolor{keywordtype}{integer} :: inum                                         \textcolor{comment}{! The integer type of num}}
\DoxyCodeLine{175         \textcolor{keywordtype}{integer} :: i                                            \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{176 \textcolor{keywordtype}{        real}(real64) :: step                                    \textcolor{comment}{! Spacing between two numbers in the array}}
\DoxyCodeLine{177 }
\DoxyCodeLine{178         \textcolor{comment}{! Handle real value for num}}
\DoxyCodeLine{179         inum = int(num)}
\DoxyCodeLine{180         \textcolor{comment}{! Handle single values}}
\DoxyCodeLine{181         \textcolor{keywordflow}{if} (inum .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{182             \textcolor{keyword}{allocate}(ls\_array(inum))}
\DoxyCodeLine{183             ls\_array(1) = start}
\DoxyCodeLine{184         \textcolor{comment}{! Handle multiple values}}
\DoxyCodeLine{185         \textcolor{keywordflow}{else}}
\DoxyCodeLine{186             \textcolor{comment}{! Generate array}}
\DoxyCodeLine{187             \textcolor{keyword}{allocate}(ls\_array(inum))}
\DoxyCodeLine{188             \textcolor{comment}{! Find step size}}
\DoxyCodeLine{189             step = (\textcolor{keyword}{end }-\/ start) / real(inum-\/1, kind=real64)}
\DoxyCodeLine{190             \textcolor{comment}{! Fill array}}
\DoxyCodeLine{191             \textcolor{keywordflow}{do} i = 1, inum}
\DoxyCodeLine{192                 ls\_array(i) = start + (i-\/1)*step}
\DoxyCodeLine{193 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{194 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{195 }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{namespacevqmc_a6b89c5b7a64a3e438695787b90a62359_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}\label{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335}} 
\index{vqmc@{vqmc}!random\_normal@{random\_normal}}
\index{random\_normal@{random\_normal}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{random\_normal()}{random\_normal()}}
{\footnotesize\ttfamily subroutine vqmc\+::random\+\_\+normal (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{dim,  }\item[{real(real64), dimension(\+:), intent(out)}]{x }\end{DoxyParamCaption})}



Draws a sample from a normal distribution. 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em dim} & The dimension of the random vector \\
\hline
\mbox{\texttt{ out}}  & {\em x} & The sample from the normal distribution \\
\hline
\end{DoxyParams}


Definition at line 212 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{213         }
\DoxyCodeLine{214         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{215 }
\DoxyCodeLine{216         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: dim}
\DoxyCodeLine{217 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)} :: x }
\DoxyCodeLine{218         }
\DoxyCodeLine{219 \textcolor{keywordtype}{        real}(real64) :: u\_1, u\_2                        \textcolor{comment}{! Samples from uniform distribution }}
\DoxyCodeLine{220         \textcolor{keywordtype}{integer} :: i                                    \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{221 }
\DoxyCodeLine{222         \textcolor{comment}{! Generate vector containg samples from normal distributions }}
\DoxyCodeLine{223         \textcolor{keywordflow}{do} i = 1, dim}
\DoxyCodeLine{224             \textcolor{comment}{! This can be done the Fortran intrinsic random number generator but this }}
\DoxyCodeLine{225             \textcolor{comment}{! is not a good random number generator }}
\DoxyCodeLine{226             \textcolor{comment}{! call random\_number(u\_1)}}
\DoxyCodeLine{227             \textcolor{comment}{! call random\_number(u\_2)}}
\DoxyCodeLine{228 }
\DoxyCodeLine{229             \textcolor{comment}{! Draws from uniform distribution}}
\DoxyCodeLine{230             \textcolor{keyword}{call }ran1(u\_1, seed)}
\DoxyCodeLine{231             \textcolor{keyword}{call }ran1(u\_2, seed)}
\DoxyCodeLine{232 }
\DoxyCodeLine{233             \textcolor{comment}{! Calculate the sample from the normal distribution using the Box-\/Muller transform }}
\DoxyCodeLine{234             x(i) = sqrt(-\/2*log(u\_1))*cos(2*pi*u\_2)}
\DoxyCodeLine{235 \textcolor{keywordflow}{        end do} }
\DoxyCodeLine{236 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=292pt]{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_a62ec9b662e5d9b46ec37d52ff93cb335_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_ac8a07ca12229e28074bf9088be5c2b5c}\label{namespacevqmc_ac8a07ca12229e28074bf9088be5c2b5c}} 
\index{vqmc@{vqmc}!vqmc\_qho@{vqmc\_qho}}
\index{vqmc\_qho@{vqmc\_qho}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_qho()}{vqmc\_qho()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+qho (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), intent(in)}]{alpha\+\_\+const,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{X\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), optional}]{x\+\_\+start }\end{DoxyParamCaption})}



Performs VQMC for QHO. 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em alpha\+\_\+const} & Parameter \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start} & Starting point of MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+burnt} & The burnt and thinned MCMC chain for the random walker \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energies of the each points in the MCMC chain \\
\hline
\end{DoxyParams}


Definition at line 264 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{266 }
\DoxyCodeLine{267         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{268 }
\DoxyCodeLine{269 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma, alpha\_const}
\DoxyCodeLine{270         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{271 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{optional} :: x\_start }
\DoxyCodeLine{272          }
\DoxyCodeLine{273 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate}
\DoxyCodeLine{274 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: X\_burnt,\textcolor{comment}{ energy\_chain }}
\DoxyCodeLine{275 \textcolor{comment}{        }}
\DoxyCodeLine{276 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                      \textcolor{comment}{! The natural logarithm of the transition probability}}
\DoxyCodeLine{277 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                    \textcolor{comment}{! Acceptance ratio of the transition probability }}
\DoxyCodeLine{278 \textcolor{keywordtype}{        real}(real64) :: unif\_num                        \textcolor{comment}{! A random sample from the uniform distribution }}
\DoxyCodeLine{279 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: start             \textcolor{comment}{! The starting point of the MCMC chain }}
\DoxyCodeLine{280 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: X\_n               \textcolor{comment}{! The proposed step }}
\DoxyCodeLine{281 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(1)} :: sample\_normal     \textcolor{comment}{! A sample from the normal distribution }}
\DoxyCodeLine{282 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: X    \textcolor{comment}{! Non-\/burnt or thinned MCMC chain}}
\DoxyCodeLine{283         \textcolor{keywordtype}{integer} :: thin\_counter                         \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{284         \textcolor{keywordtype}{integer} :: reset\_counter                        \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{285         \textcolor{keywordtype}{integer} :: accept                               \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{286         \textcolor{keywordtype}{integer} :: i                                    \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{287         \textcolor{keywordtype}{integer} :: i\_bt                                 \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{288         \textcolor{keywordtype}{integer} :: re\_size                              \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{289         \textcolor{keywordtype}{character(len=1)} :: acceptance                  \textcolor{comment}{! Yes/No signpost for acceptance}}
\DoxyCodeLine{290 }
\DoxyCodeLine{291         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{292         re\_size = (n -\/ burn) / thin}
\DoxyCodeLine{293         }
\DoxyCodeLine{294         \textcolor{keyword}{allocate}(x(1: n+1)); x(:) = 0.0\_real64}
\DoxyCodeLine{295         \textcolor{keyword}{allocate}(x\_burnt(1: re\_size +1)); x\_burnt(:) = 0.0\_real64}
\DoxyCodeLine{296         \textcolor{keyword}{allocate}(energy\_chain(1: re\_size + 1)); energy\_chain(:) = 0.0\_real64}
\DoxyCodeLine{297         }
\DoxyCodeLine{298         \textcolor{comment}{! Allow the starting position to take the defualt value }}
\DoxyCodeLine{299         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{300             start = x\_start}
\DoxyCodeLine{301             x(1) = start(1)}
\DoxyCodeLine{302             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{303                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting from provided Markov chain position', F12.8)"{}}\textcolor{comment}{) x(1)}}
\DoxyCodeLine{304 \textcolor{comment}{}\textcolor{keywordflow}{            end if}}
\DoxyCodeLine{305         \textcolor{keywordflow}{else} }
\DoxyCodeLine{306             \textcolor{comment}{! Creates the initial position of the random walker that is within a certain radius  }}
\DoxyCodeLine{307             \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{308             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= qho\%rcut)}
\DoxyCodeLine{309                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{310 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{311             start = sample\_normal}
\DoxyCodeLine{312             x(1) = start(1)}
\DoxyCodeLine{313             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{314                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Generated random Markov chain start position', F12.8)"{}}\textcolor{comment}{) x(1)}}
\DoxyCodeLine{315 \textcolor{comment}{}\textcolor{keywordflow}{            end if}}
\DoxyCodeLine{316 \textcolor{keywordflow}{        end if} }
\DoxyCodeLine{317 }
\DoxyCodeLine{318         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{319         accept = 0 }
\DoxyCodeLine{320         \textcolor{comment}{! Start the counter for the thinning process}}
\DoxyCodeLine{321         thin\_counter = 0}
\DoxyCodeLine{322         \textcolor{comment}{! Start the reset counter }}
\DoxyCodeLine{323         reset\_counter = 0}
\DoxyCodeLine{324 }
\DoxyCodeLine{325         \textcolor{comment}{!Write initial conditions to the output file}}
\DoxyCodeLine{326         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{327             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for alpha = ', F7.4)"{}}) alpha\_const}
\DoxyCodeLine{328             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Sample     Position       Local Energy     Accepted?')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{329 \textcolor{comment}{}            \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6)"{}}) 1, x(1), energy\_chain\textcolor{comment}{(1)}}
\DoxyCodeLine{330 \textcolor{comment}{}\textcolor{keywordflow}{        end if}}
\DoxyCodeLine{331 }
\DoxyCodeLine{332         \textcolor{comment}{! In case burn = 0 to start calculating the chain from the beginning }}
\DoxyCodeLine{333         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{334             energy\_chain(1) = qho\_energy(alpha\_const, x(1))}
\DoxyCodeLine{335             x\_burnt(1) = x(1)}
\DoxyCodeLine{336 }
\DoxyCodeLine{337             \textcolor{keywordflow}{do} i = 2, n+1 }
\DoxyCodeLine{338                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{339                 thin\_counter = 1 + thin\_counter           }
\DoxyCodeLine{340                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{341                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{342                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{343 }
\DoxyCodeLine{344                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{345                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{346             }
\DoxyCodeLine{347                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{348                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{349 }
\DoxyCodeLine{350                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{351                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{352             }
\DoxyCodeLine{353                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{354                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{355                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{356                     x(i) = x\_n(1) }
\DoxyCodeLine{357 }
\DoxyCodeLine{358                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{359                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{360                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{361                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{362                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{363                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{364                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{365                         x\_burnt(i\_bt) = x\_n(1)}
\DoxyCodeLine{366                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{367                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x\_n\textcolor{comment}{(1))}}
\DoxyCodeLine{368 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{369                         thin\_counter = 0}
\DoxyCodeLine{370 }
\DoxyCodeLine{371                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{372                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{373                         accept = 1 + accept }
\DoxyCodeLine{374 }
\DoxyCodeLine{375                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{376                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{377                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{378 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{379 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{380 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{381 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{382                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{383                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{384                     x(i) = x(i-\/1)}
\DoxyCodeLine{385 }
\DoxyCodeLine{386                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain }}
\DoxyCodeLine{387                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{388                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{389                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{390                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{391                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{392                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{393                         x\_burnt(i\_bt) = x(i-\/1)}
\DoxyCodeLine{394                         \textcolor{comment}{! Calculate the local energy at this point}}
\DoxyCodeLine{395                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x(i\textcolor{comment}{-\/1))}}
\DoxyCodeLine{396 \textcolor{comment}{}                        \textcolor{comment}{! Reseting the thin counter }}
\DoxyCodeLine{397                         thin\_counter = 0 }
\DoxyCodeLine{398 }
\DoxyCodeLine{399                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{400 }
\DoxyCodeLine{401                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{402                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{403                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{404 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{405 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{406 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{407 }
\DoxyCodeLine{408 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{409 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{410 }
\DoxyCodeLine{411 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{412         \textcolor{comment}{! Loop to advance the chain to the final burn step and not save any of the outputs}}
\DoxyCodeLine{413         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{414             \textcolor{keywordflow}{do} i = 2, burn}
\DoxyCodeLine{415                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{416                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{417                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{418                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{419                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{420                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{421                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{422                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{423                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{424             }
\DoxyCodeLine{425                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{426                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{427                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{428                     x(i) = x\_n(1) }
\DoxyCodeLine{429                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{430                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{431                     x(i) = x(i-\/1)}
\DoxyCodeLine{432 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{433 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{434 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{435        }
\DoxyCodeLine{436         \textcolor{comment}{! Metropolis Algorithm}}
\DoxyCodeLine{437         \textcolor{keywordflow}{if} (burn >=1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{438             \textcolor{keywordflow}{do} i = burn + 1, n+1 }
\DoxyCodeLine{439                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{440                 thin\_counter = 1 + thin\_counter           }
\DoxyCodeLine{441                 \textcolor{comment}{! Propose the next step}}
\DoxyCodeLine{442                 \textcolor{keyword}{call }random\_normal(1, sample\_normal)}
\DoxyCodeLine{443                 x\_n = x(i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{444 }
\DoxyCodeLine{445                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step}}
\DoxyCodeLine{446                 log\_prob\_n = log(qho\_prob(alpha\_const, x(i-\/1), x\_n(1)))}
\DoxyCodeLine{447             }
\DoxyCodeLine{448                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{449                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{450 }
\DoxyCodeLine{451                 \textcolor{comment}{! Generate sample from uniform distribution }}
\DoxyCodeLine{452                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{453             }
\DoxyCodeLine{454                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio }}
\DoxyCodeLine{455                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{456                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{457                     x(i) = x\_n(1) }
\DoxyCodeLine{458 }
\DoxyCodeLine{459                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{460                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{461                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{462                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{463                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{464                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{465                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{466                         x\_burnt(i\_bt) = x\_n(1)}
\DoxyCodeLine{467                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{468                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x\_n\textcolor{comment}{(1))}}
\DoxyCodeLine{469 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{470                         thin\_counter = 0}
\DoxyCodeLine{471 }
\DoxyCodeLine{472                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{473                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{474                         accept = 1 + accept }
\DoxyCodeLine{475 }
\DoxyCodeLine{476                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{477                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{478                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{479 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{480 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{481 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{482 }
\DoxyCodeLine{483 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{484 }
\DoxyCodeLine{485                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{486                     \textcolor{comment}{! If rejected the proposed step is the current step}}
\DoxyCodeLine{487                     x(i) = x(i-\/1)}
\DoxyCodeLine{488 }
\DoxyCodeLine{489                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain }}
\DoxyCodeLine{490                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{491                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{492                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{493                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{494                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{495                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{496                         x\_burnt(i\_bt) = x(i-\/1)}
\DoxyCodeLine{497                         \textcolor{comment}{! Calculate the local energy at this point}}
\DoxyCodeLine{498                         energy\_chain(i\_bt) = qho\_energy(alpha\_const, x(i\textcolor{comment}{-\/1))}}
\DoxyCodeLine{499 \textcolor{comment}{}                        \textcolor{comment}{! Reseting the thin counter }}
\DoxyCodeLine{500                         thin\_counter = 0 }
\DoxyCodeLine{501 }
\DoxyCodeLine{502                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{503 }
\DoxyCodeLine{504                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{505                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{506                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.6, '     ', A1)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{507 \textcolor{comment}{}                                    (i\_bt), x\_burnt(i\_bt), energy\_chain(i\_bt\textcolor{comment}{), acceptance}}
\DoxyCodeLine{508 \textcolor{comment}{}\textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{509 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{510 }
\DoxyCodeLine{511 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{512 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{513 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{514 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{515 }
\DoxyCodeLine{516         \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{517         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{)) }}
\DoxyCodeLine{518 \textcolor{comment}{}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_ac8a07ca12229e28074bf9088be5c2b5c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=244pt]{namespacevqmc_ac8a07ca12229e28074bf9088be5c2b5c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_adef1f40504be89d534ea89658a169aad}\label{namespacevqmc_adef1f40504be89d534ea89658a169aad}} 
\index{vqmc@{vqmc}!vqmc\_h\_2\_plus@{vqmc\_h\_2\_plus}}
\index{vqmc\_h\_2\_plus@{vqmc\_h\_2\_plus}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_h\_2\_plus()}{vqmc\_h\_2\_plus()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+h\+\_\+2\+\_\+plus (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), dimension(\+:), intent(in)}]{c\+\_\+const,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+a,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+b,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start }\end{DoxyParamCaption})}



Performs VQMC for H\+\_\+2\+\_\+plus ~\newline
 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em c\+\_\+const} & Parameter(s) of trial wavefunction \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+a} & Position of hydrogen atom A \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+b} & Position of hydrogen atom B \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start} & Starting point of MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+burnt} & The burnt and thinned MCMC chain for the random walker \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energis of the each points in the MCMC chain \\
\hline
\end{DoxyParams}


Definition at line 548 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{550 }
\DoxyCodeLine{551         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{552 }
\DoxyCodeLine{553 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{554 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma}
\DoxyCodeLine{555 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(:)} :: c\_const}
\DoxyCodeLine{556 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)}, \textcolor{keywordtype}{optional} :: x\_start}
\DoxyCodeLine{557         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{558         }
\DoxyCodeLine{559          }
\DoxyCodeLine{560 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate}
\DoxyCodeLine{561 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_burnt}
\DoxyCodeLine{562 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{563 }
\DoxyCodeLine{564 \textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                          \textcolor{comment}{! The natural logarithm of the transition proability}}
\DoxyCodeLine{565 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                        \textcolor{comment}{! Acceptance ratio of the transitional probability }}
\DoxyCodeLine{566 \textcolor{keywordtype}{        real}(real64) :: unif\_num                            \textcolor{comment}{! A random sample from the uniform distribution}}
\DoxyCodeLine{567 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: start                 \textcolor{comment}{! Starting point of MCMC chain}}
\DoxyCodeLine{568 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X     \textcolor{comment}{! Unburnt and thinned MCMC chain }}
\DoxyCodeLine{569 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: X\_n                   \textcolor{comment}{! The proposed step }}
\DoxyCodeLine{570 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: sample\_normal         \textcolor{comment}{! A sample from the normal distribution }}
\DoxyCodeLine{571         \textcolor{keywordtype}{integer} :: accept                                   \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{572         \textcolor{keywordtype}{integer} :: thin\_counter                             \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{573         \textcolor{keywordtype}{integer} :: reset\_counter                            \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{574         \textcolor{keywordtype}{integer} :: re\_size                                  \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{575         \textcolor{keywordtype}{integer} :: i\_bt                                     \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{576         \textcolor{keywordtype}{integer} :: i                                        \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{577         \textcolor{keywordtype}{character(len=1)} :: acceptance                      \textcolor{comment}{! Yes/No signpost for acceptance}}
\DoxyCodeLine{578 }
\DoxyCodeLine{579         }
\DoxyCodeLine{580         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{581         re\_size = (n -\/ burn) / thin}
\DoxyCodeLine{582 }
\DoxyCodeLine{583         \textcolor{keyword}{allocate}(x(3, 1:n+1)); x(:, :) = 0.0\_real64}
\DoxyCodeLine{584         \textcolor{keyword}{allocate}(x\_burnt(3, 1:re\_size +1)); x\_burnt(:, :) = 0.0\_real64}
\DoxyCodeLine{585         \textcolor{keyword}{allocate}(energy\_chain(1:re\_size+1)); energy\_chain(:) = 0.0\_real64}
\DoxyCodeLine{586 }
\DoxyCodeLine{587         \textcolor{comment}{! Allow the starting position to take on the default value}}
\DoxyCodeLine{588         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start)) \textcolor{keywordflow}{then} }
\DoxyCodeLine{589             start = x\_start}
\DoxyCodeLine{590             x(:,1) = start}
\DoxyCodeLine{591             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{592                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Starting from provided Markov chain position:')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{593 \textcolor{comment}{}                \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('    x = ', F12.8, ' y = ', F12.8, ' z = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{594 \textcolor{comment}{}                    x(1, 1), x(2, 1), x(3, 1)}
\DoxyCodeLine{595 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{596         \textcolor{keywordflow}{else} }
\DoxyCodeLine{597             \textcolor{comment}{! Create the initial position of the random walker that is within a certain radius}}
\DoxyCodeLine{598             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{599             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2plus\%rcut)}
\DoxyCodeLine{600                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{601 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{602             start = sample\_normal}
\DoxyCodeLine{603             x(:,1) = start }
\DoxyCodeLine{604             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{605                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Generated random Markov chain start position:')"{}}\textcolor{comment}{)}}
\DoxyCodeLine{606 \textcolor{comment}{}                \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('X = ', F12.8, ', Y = ', F12.8, ', Z = ', F12.8)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{607 \textcolor{comment}{}                    x(1, 1), x(2, 1), x(3, 1)}
\DoxyCodeLine{608 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{609 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{610         }
\DoxyCodeLine{611         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{612         accept = 0  }
\DoxyCodeLine{613         \textcolor{comment}{! Start the counter for the thinning process }}
\DoxyCodeLine{614         thin\_counter = 0}
\DoxyCodeLine{615         \textcolor{comment}{! Start the reset\_counter }}
\DoxyCodeLine{616         reset\_counter = 0}
\DoxyCodeLine{617         }
\DoxyCodeLine{618         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{619         \textcolor{keywordflow}{if} (h2plus\%include\_pqn .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{620             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for c = ', F7.4)"{}}) c\_const(1)}
\DoxyCodeLine{621         \textcolor{keywordflow}{else}}
\DoxyCodeLine{622             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Markov chain for c1 = ', F7.4, ', c2 = ', F7.4)"{}}\textcolor{comment}{) \&}}
\DoxyCodeLine{623 \textcolor{comment}{}                c\_const(1), c\_const(2)}
\DoxyCodeLine{624 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{625             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Sample      X               Y              Z              \&}}
\DoxyCodeLine{626 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \&Local Energy     Accepted?')"{}})}
\DoxyCodeLine{627             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8, ' ', F12.6)"{}}\textcolor{comment}{)\&}}
\DoxyCodeLine{628 \textcolor{comment}{}                1, x(1, 1), x(2, 1), x(3, 1), energy\_chain(1)}
\DoxyCodeLine{629 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{630         }
\DoxyCodeLine{631         \textcolor{comment}{! Calculate the local energy of the initial step if not burnt}}
\DoxyCodeLine{632         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{633             energy\_chain(1) = h\_2\_plus\_energy(c\_const, x(:, 1), r\_a, r\_b\textcolor{comment}{)}}
\DoxyCodeLine{634 \textcolor{comment}{}            x\_burnt(:, 1) = x(:, 1)}
\DoxyCodeLine{635 }
\DoxyCodeLine{636             \textcolor{keywordflow}{do} i = 2, n+1}
\DoxyCodeLine{637                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{638                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{639                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{640                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{641                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{642 }
\DoxyCodeLine{643                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{644                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{645 \textcolor{comment}{}           }
\DoxyCodeLine{646                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{647                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{648             }
\DoxyCodeLine{649                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{650                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{651 }
\DoxyCodeLine{652                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{653                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{654                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{655                     x(:, i) = x\_n }
\DoxyCodeLine{656 }
\DoxyCodeLine{657                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{658                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{659                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{660                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{661                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{662                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{663                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{664                         x\_burnt(:, i\_bt) = x\_n}
\DoxyCodeLine{665                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{666                         energy\_chain(i\_bt) = h\_2\_plus\_energy(c\_const, x\_n\textcolor{comment}{, r\_a, r\_b)}}
\DoxyCodeLine{667 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{668                         thin\_counter = 0}
\DoxyCodeLine{669 }
\DoxyCodeLine{670                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{671                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{672                         accept = 1 + accept }
\DoxyCodeLine{673 }
\DoxyCodeLine{674                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{675                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{676                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{677 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{678 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{679 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{680 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{681 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{682 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{683                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{684                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{685                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{686 }
\DoxyCodeLine{687                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{688                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{689                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{690                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{691                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{692                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{693                         x\_burnt(:, i\_bt) = x(:, i-\/1)}
\DoxyCodeLine{694                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{695                         energy\_chain(i\_bt) = h\_2\_plus\_energy(c\_const, x(\textcolor{comment}{:, i-\/1), r\_a, r\_b)}}
\DoxyCodeLine{696 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{697                         thin\_counter = 0}
\DoxyCodeLine{698 }
\DoxyCodeLine{699                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{700 }
\DoxyCodeLine{701                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{702                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{703                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{704 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{705 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{706 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{707 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{708 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{709 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{710 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{711 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{712         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{713             \textcolor{keywordflow}{do} i = 2, burn}
\DoxyCodeLine{714                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{715                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{716                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{717 }
\DoxyCodeLine{718                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{719                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{720 \textcolor{comment}{}           }
\DoxyCodeLine{721                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{722                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{723             }
\DoxyCodeLine{724                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{725                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{726 }
\DoxyCodeLine{727                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{728                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{729                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{730                     x(:, i) = x\_n }
\DoxyCodeLine{731                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{732                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{733                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{734 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{735 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{736 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{737 }
\DoxyCodeLine{738         \textcolor{comment}{! Execute MCMC chain with burning and thinning}}
\DoxyCodeLine{739         \textcolor{keywordflow}{if} (burn >= 1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{740             \textcolor{comment}{! Metropolis algorithm }}
\DoxyCodeLine{741             \textcolor{keywordflow}{do} i = burn + 1, n+1 }
\DoxyCodeLine{742                 \textcolor{comment}{! Add one to the thin counter }}
\DoxyCodeLine{743                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{744                 \textcolor{comment}{! Propose the next step }}
\DoxyCodeLine{745                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{746                 x\_n = x(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{747 }
\DoxyCodeLine{748                 \textcolor{comment}{! Calculate the transition probability between proposed step and current step }}
\DoxyCodeLine{749                 log\_prob\_n = log(h\_2\_plus\_prob(c\_const, x(:, i-\/1), x\_n, r\_a\textcolor{comment}{, r\_b))}}
\DoxyCodeLine{750 \textcolor{comment}{}                }
\DoxyCodeLine{751                 \textcolor{comment}{! Calculate the acceptance ratio }}
\DoxyCodeLine{752                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{753             }
\DoxyCodeLine{754                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{755                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{756 }
\DoxyCodeLine{757                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{758                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{759                     \textcolor{comment}{! If accepted add proposed position to the MCMC chain}}
\DoxyCodeLine{760                     x(:, i) = x\_n }
\DoxyCodeLine{761 }
\DoxyCodeLine{762                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{763                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{764                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{765                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{766                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{767                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{768                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{769                         x\_burnt(:, i\_bt) = x\_n}
\DoxyCodeLine{770                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{771                         energy\_chain(i\_bt) = h\_2\_plus\_energy(c\_const, x\_n\textcolor{comment}{, r\_a, r\_b)}}
\DoxyCodeLine{772 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{773                         thin\_counter = 0}
\DoxyCodeLine{774 }
\DoxyCodeLine{775                         acceptance = \textcolor{stringliteral}{'Y'}}
\DoxyCodeLine{776                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{777                         accept = 1 + accept }
\DoxyCodeLine{778 }
\DoxyCodeLine{779                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{780                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{781                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{782 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{783 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{784 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{785 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{786 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{787 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{788                  }
\DoxyCodeLine{789                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{790                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{791                     x(:, i) = x(:, i-\/1)}
\DoxyCodeLine{792 }
\DoxyCodeLine{793                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                   }}
\DoxyCodeLine{794                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{795                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{796                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{797                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{798                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{799                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{800                         x\_burnt(:, i\_bt) = x(:, i-\/1)}
\DoxyCodeLine{801                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{802                         energy\_chain(i\_bt) = h\_2\_plus\_energy(c\_const, x(\textcolor{comment}{:, i-\/1), r\_a, r\_b)}}
\DoxyCodeLine{803 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{804                         thin\_counter = 0}
\DoxyCodeLine{805 }
\DoxyCodeLine{806                         acceptance = \textcolor{stringliteral}{'N'}}
\DoxyCodeLine{807 }
\DoxyCodeLine{808                         \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{809                             \textcolor{keywordflow}{if} (mod(i\_bt, re\_size/logfrac) .le. 1e-\/6\_real64\textcolor{comment}{) }\textcolor{keywordflow}{then}}
\DoxyCodeLine{810                                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(I8, '   ', F12.8, '   ', F12.8, '   ', F12.8,\&}}
\DoxyCodeLine{811 \textcolor{stringliteral}{}\textcolor{stringliteral}{                                    \&' ', F12.6, '         ', A1)"{}}) (i\_bt\textcolor{comment}{), x\_burnt(1, i\_bt), \&}}
\DoxyCodeLine{812 \textcolor{comment}{}                                    x\_burnt(2, i\_bt), x\_burnt(2, i\_bt), energy\_chain\textcolor{comment}{(i\_bt), \&}}
\DoxyCodeLine{813 \textcolor{comment}{}                                    acceptance}
\DoxyCodeLine{814 \textcolor{keywordflow}{                            end if}}
\DoxyCodeLine{815 \textcolor{keywordflow}{                        end if}}
\DoxyCodeLine{816 }
\DoxyCodeLine{817 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{818 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{819 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{820 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{821 }
\DoxyCodeLine{822         \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{823         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{)) }}
\DoxyCodeLine{824 \textcolor{comment}{}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_adef1f40504be89d534ea89658a169aad_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{namespacevqmc_adef1f40504be89d534ea89658a169aad_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevqmc_ac00c311b77347b5ed6258bb64214dd9f}\label{namespacevqmc_ac00c311b77347b5ed6258bb64214dd9f}} 
\index{vqmc@{vqmc}!vqmc\_h\_2@{vqmc\_h\_2}}
\index{vqmc\_h\_2@{vqmc\_h\_2}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{vqmc\_h\_2()}{vqmc\_h\_2()}}
{\footnotesize\ttfamily subroutine vqmc\+::vqmc\+\_\+h\+\_\+2 (\begin{DoxyParamCaption}\item[{real(real64), intent(in)}]{sigma,  }\item[{integer, intent(in)}]{N,  }\item[{integer, intent(in)}]{burn,  }\item[{integer, intent(in)}]{thin,  }\item[{real(real64), dimension(\+:), intent(in)}]{c\+\_\+const,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+a,  }\item[{real(real64), dimension(3), intent(in)}]{R\+\_\+b,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+1\+\_\+burnt,  }\item[{real(real64), dimension(\+:, \+:), intent(out), allocatable}]{X\+\_\+2\+\_\+burnt,  }\item[{real(real64), intent(out)}]{accept\+\_\+rate,  }\item[{real(real64), dimension(\+:), intent(out), allocatable}]{energy\+\_\+chain,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start\+\_\+1,  }\item[{real(real64), dimension(3), optional}]{x\+\_\+start\+\_\+2 }\end{DoxyParamCaption})}



Performs VQMC for H\+\_\+2 ~\newline
 

Computes 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em sigma} & Step size \\
\hline
\mbox{\texttt{ in}}  & {\em N} & Number of steps to take \\
\hline
\mbox{\texttt{ in}}  & {\em burn} & Number of sample to discard at the beginning \\
\hline
\mbox{\texttt{ in}}  & {\em thin} & The frequency at which we discard the samples from the MCMC chain after burning ~\newline
 \\
\hline
\mbox{\texttt{ in}}  & {\em c\+\_\+const} & Parameter(s) of trial wavefunction \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+a} & Position of hydrogen atom A \\
\hline
\mbox{\texttt{ in}}  & {\em R\+\_\+b} & Position of hydrogen atom B \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start\+\_\+1} & Starting point of 1st MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ in}}  & {\em x\+\_\+start\+\_\+2} & Starting point of 2nd MCMC chain (optional, default is randomly generated) \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+1\+\_\+burnt} & The burnt and thinned MCMC chain for random walker 1 \\
\hline
\mbox{\texttt{ out}}  & {\em X\+\_\+2\+\_\+burnt} & The burnt and thinned MCMC chain for random walker 2 \\
\hline
\mbox{\texttt{ out}}  & {\em accept\+\_\+rate} & The acceptance rate of the MCMC chain \\
\hline
\mbox{\texttt{ out}}  & {\em energy\+\_\+chain} & An array with the local energies of the each points in the MCMC chains \\
\hline
\end{DoxyParams}


Definition at line 856 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{858 }
\DoxyCodeLine{859         \textcolor{keywordtype}{implicit none} }
\DoxyCodeLine{860 }
\DoxyCodeLine{861 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(3)} :: R\_a, R\_b}
\DoxyCodeLine{862 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)} :: sigma}
\DoxyCodeLine{863 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(:)} :: c\_const }
\DoxyCodeLine{864 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)}, \textcolor{keywordtype}{optional} :: x\_start\_1, x\_start\_2}
\DoxyCodeLine{865         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: N, burn, thin }
\DoxyCodeLine{866         }
\DoxyCodeLine{867          }
\DoxyCodeLine{868 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)} :: accept\_rate}
\DoxyCodeLine{869 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_1\_burnt\textcolor{comment}{, X\_2\_burnt}}
\DoxyCodeLine{870 \textcolor{comment}{}\textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energy\_chain}
\DoxyCodeLine{871 }
\DoxyCodeLine{872 \textcolor{keywordtype}{        real}(real64) :: log\_prob\_n                               \textcolor{comment}{! The natural logarithm of the transition proability }}
\DoxyCodeLine{873 \textcolor{keywordtype}{        real}(real64) :: a\_prob\_trans                             \textcolor{comment}{! Acceptance ratio of the transitional probability                   }}
\DoxyCodeLine{874 \textcolor{keywordtype}{        real}(real64) :: unif\_num                                 \textcolor{comment}{! A random sample from the uniform distribution }}
\DoxyCodeLine{875 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: start\_1, start\_2           \textcolor{comment}{! Starting points for the random walkers }}
\DoxyCodeLine{876 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: X\_n\_1, X\_n\_2               \textcolor{comment}{! The propsed steps for the random walkers }}
\DoxyCodeLine{877 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(3)} :: sample\_normal              \textcolor{comment}{! Sample from the normal distribution }}
\DoxyCodeLine{878 \textcolor{keywordtype}{        real}(real64), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable} :: X\_1, X\_2   \textcolor{comment}{! Full MCMC chains }}
\DoxyCodeLine{879         \textcolor{keywordtype}{integer} :: accept                                        \textcolor{comment}{! Number of accepted steps }}
\DoxyCodeLine{880         \textcolor{keywordtype}{integer} :: thin\_counter                                  \textcolor{comment}{! Counter to keep track of the thinning process}}
\DoxyCodeLine{881         \textcolor{keywordtype}{integer} :: reset\_counter                                 \textcolor{comment}{! Counts how many times thin counter was reset}}
\DoxyCodeLine{882         \textcolor{keywordtype}{integer} :: re\_size                                       \textcolor{comment}{! The size of the burnt and thinned array}}
\DoxyCodeLine{883         \textcolor{keywordtype}{integer} :: i\_bt                                          \textcolor{comment}{! Burned/thinned value of i}}
\DoxyCodeLine{884         \textcolor{keywordtype}{integer} :: i                                             \textcolor{comment}{! Loop variable }}
\DoxyCodeLine{885         }
\DoxyCodeLine{886         \textcolor{comment}{! Adjust the output array to be of the burnt and thinned array}}
\DoxyCodeLine{887         re\_size = (n -\/ burn) / thin }
\DoxyCodeLine{888 }
\DoxyCodeLine{889         \textcolor{keyword}{allocate}(x\_1(3, 1:n+1)) }
\DoxyCodeLine{890         \textcolor{keyword}{allocate}(x\_2(3, 1:n+1))}
\DoxyCodeLine{891         \textcolor{keyword}{allocate}(x\_1\_burnt(3, 1:re\_size))}
\DoxyCodeLine{892         \textcolor{keyword}{allocate}(x\_2\_burnt(3, 1:re\_size))}
\DoxyCodeLine{893         \textcolor{keyword}{allocate}(energy\_chain(1: re\_size))}
\DoxyCodeLine{894 }
\DoxyCodeLine{895         \textcolor{comment}{! Allow the starting position to take on the default value }}
\DoxyCodeLine{896         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(x\_start\_1) .and. \textcolor{keyword}{present}(x\_start\_2)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{897             start\_1 = x\_start\_1}
\DoxyCodeLine{898             x\_1(:,1) = start\_1}
\DoxyCodeLine{899             }
\DoxyCodeLine{900             start\_2 = x\_start\_2}
\DoxyCodeLine{901             x\_2(:,1) = start\_2}
\DoxyCodeLine{902         \textcolor{keywordflow}{else} }
\DoxyCodeLine{903             \textcolor{comment}{! Create the initial position of random walker 1 that is within a certain radius}}
\DoxyCodeLine{904             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{905             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2\%rcut)}
\DoxyCodeLine{906                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{907 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{908             start\_1 = sample\_normal}
\DoxyCodeLine{909             x\_1(:,1) = start\_1}
\DoxyCodeLine{910 }
\DoxyCodeLine{911             \textcolor{comment}{! Create the initial position of random walker 2 that is within a certain radius}}
\DoxyCodeLine{912             \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{913             \textcolor{keywordflow}{do} \textcolor{keywordflow}{while}(norm2(sample\_normal) >= h2\%rcut)}
\DoxyCodeLine{914                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{915 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{916             start\_2 = sample\_normal }
\DoxyCodeLine{917             x\_2(:,1) = start\_2}
\DoxyCodeLine{918 \textcolor{keywordflow}{        end if} }
\DoxyCodeLine{919         }
\DoxyCodeLine{920         \textcolor{comment}{! Start the counter for the number of accepted moves}}
\DoxyCodeLine{921         accept = 0  }
\DoxyCodeLine{922         \textcolor{comment}{! Start the counter for the thinning process}}
\DoxyCodeLine{923         thin\_counter = 0}
\DoxyCodeLine{924         \textcolor{comment}{! Start the reset counter }}
\DoxyCodeLine{925         reset\_counter = 0}
\DoxyCodeLine{926 }
\DoxyCodeLine{927         \textcolor{comment}{! Calculate the local energy of the initial step if not burnt}}
\DoxyCodeLine{928         \textcolor{keywordflow}{if} (burn == 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{929             energy\_chain(1) = h\_2\_energy(c\_const, x\_1(:,1), x\_2(:,1), r\_a\textcolor{comment}{, r\_b)}}
\DoxyCodeLine{930 \textcolor{comment}{}            x\_1\_burnt(:, 1) = x\_1(:, 1)}
\DoxyCodeLine{931             x\_2\_burnt(:, 1) = x\_2(:, 1)}
\DoxyCodeLine{932 }
\DoxyCodeLine{933             \textcolor{keywordflow}{do} i = 2, n+1 }
\DoxyCodeLine{934                 \textcolor{comment}{! Initialize thin counter }}
\DoxyCodeLine{935                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{936 }
\DoxyCodeLine{937                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{938                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{939                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{940 }
\DoxyCodeLine{941                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{942                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{943                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{944 }
\DoxyCodeLine{945                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{946                 log\_prob\_n = log(h\_2\_prob(c\_const, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{947 \textcolor{comment}{}}
\DoxyCodeLine{948                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{949                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{950 }
\DoxyCodeLine{951                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{952                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{953 }
\DoxyCodeLine{954                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{955                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{956                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{957                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{958                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{959 }
\DoxyCodeLine{960                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                                        }}
\DoxyCodeLine{961                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{962                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{963                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{964                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{965                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{966                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{967                         x\_1\_burnt(:, i\_bt) = x\_n\_1}
\DoxyCodeLine{968                         x\_2\_burnt(:, i\_bt) = x\_n\_2}
\DoxyCodeLine{969                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{970                         energy\_chain(i\_bt) = h\_2\_energy(c\_const, x\_n\_1, x\_n\_2\textcolor{comment}{, r\_a, r\_b)}}
\DoxyCodeLine{971 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{972                         thin\_counter = 0}
\DoxyCodeLine{973 }
\DoxyCodeLine{974                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{975                         accept = 1 + accept }
\DoxyCodeLine{976 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{977                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{978                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{979                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{980                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{981                 }
\DoxyCodeLine{982                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain}}
\DoxyCodeLine{983                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{984                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{985                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{986                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{987                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{988                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{989                         x\_1\_burnt(:, i\_bt) = x\_1(:, i-\/1)}
\DoxyCodeLine{990                         x\_2\_burnt(:, i\_bt) = x\_2(:, i-\/1)}
\DoxyCodeLine{991                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{992                         energy\_chain(i\_bt) = h\_2\_energy(c\_const, x\_1(:, i\textcolor{comment}{-\/1), x\_2(:, i-\/1), r\_a, r\_b)}}
\DoxyCodeLine{993 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{994                         thin\_counter = 0}
\DoxyCodeLine{995 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{996 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{997 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{998         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (burn >= 2) \textcolor{keywordflow}{then} }
\DoxyCodeLine{999             \textcolor{keywordflow}{do} i = 2, burn }
\DoxyCodeLine{1000                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{1001                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1002                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1003 }
\DoxyCodeLine{1004                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{1005                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1006                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1007 }
\DoxyCodeLine{1008                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{1009                 log\_prob\_n = log(h\_2\_prob(c\_const, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{1010 \textcolor{comment}{}}
\DoxyCodeLine{1011                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1012                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{1013 }
\DoxyCodeLine{1014                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{1015                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{1016 }
\DoxyCodeLine{1017                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{1018                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1019                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{1020                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{1021                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{1022                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{1023                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{1024                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{1025                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{1026 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1027 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1028 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1029 }
\DoxyCodeLine{1030         \textcolor{comment}{! Run MCMC chain with burning and thinning}}
\DoxyCodeLine{1031         \textcolor{keywordflow}{if} (burn >= 1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1032             \textcolor{comment}{! Metropolis algorithm }}
\DoxyCodeLine{1033             \textcolor{keywordflow}{do} i = (burn + 1) , n+1 }
\DoxyCodeLine{1034                 \textcolor{comment}{! Initialize thin counter }}
\DoxyCodeLine{1035                 thin\_counter = 1 + thin\_counter}
\DoxyCodeLine{1036                 \textcolor{comment}{! Propose the next step for random walker 1 }}
\DoxyCodeLine{1037                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1038                 x\_n\_1 = x\_1(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1039 }
\DoxyCodeLine{1040                 \textcolor{comment}{! Propose the next step for random walker 2 }}
\DoxyCodeLine{1041                 \textcolor{keyword}{call }random\_normal(3, sample\_normal)}
\DoxyCodeLine{1042                 x\_n\_2 = x\_2(:, i-\/1) + sigma * sample\_normal}
\DoxyCodeLine{1043 }
\DoxyCodeLine{1044                 \textcolor{comment}{! Calculate the transition probability between the proposed steps and current steps}}
\DoxyCodeLine{1045                 log\_prob\_n = log(h\_2\_prob(c\_const, x\_1(:, i-\/1), x\_2(:, i\textcolor{comment}{-\/1), x\_n\_1, x\_n\_2, r\_a, r\_b))}}
\DoxyCodeLine{1046 \textcolor{comment}{}}
\DoxyCodeLine{1047                 \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1048                 a\_prob\_trans = min(1.0\_real64, exp(log\_prob\_n))}
\DoxyCodeLine{1049 }
\DoxyCodeLine{1050                 \textcolor{comment}{! Generate sample from uniform distribution}}
\DoxyCodeLine{1051                 \textcolor{keyword}{call }ran1(unif\_num, seed)}
\DoxyCodeLine{1052 }
\DoxyCodeLine{1053                 \textcolor{comment}{! Compare the drawn sample from the uniform distribution with the acceptance ratio}}
\DoxyCodeLine{1054                 \textcolor{keywordflow}{if} (a\_prob\_trans >= unif\_num) \textcolor{keywordflow}{then} }
\DoxyCodeLine{1055                     \textcolor{comment}{! If accepted calculate local energy and add proposed position to the MCMC chain}}
\DoxyCodeLine{1056                     x\_1(:, i) = x\_n\_1}
\DoxyCodeLine{1057                     x\_2(:, i) = x\_n\_2 }
\DoxyCodeLine{1058 }
\DoxyCodeLine{1059                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                    }}
\DoxyCodeLine{1060                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1061                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1062                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1063                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1064                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1065                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1066                         x\_1\_burnt(:, i\_bt) = x\_n\_1}
\DoxyCodeLine{1067                         x\_2\_burnt(:, i\_bt) = x\_n\_2}
\DoxyCodeLine{1068                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1069                         energy\_chain(i\_bt) = h\_2\_energy(c\_const, x\_n\_1, x\_n\_2\textcolor{comment}{, r\_a, r\_b)}}
\DoxyCodeLine{1070 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1071                         thin\_counter = 0}
\DoxyCodeLine{1072 }
\DoxyCodeLine{1073                         \textcolor{comment}{! Increment the number of accepted steps }}
\DoxyCodeLine{1074                         accept = 1 + accept }
\DoxyCodeLine{1075 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1076                 \textcolor{keywordflow}{else} }
\DoxyCodeLine{1077                     \textcolor{comment}{! If rejected the proposed step is the current step }}
\DoxyCodeLine{1078                     x\_1(:, i) = x\_1(:, i-\/1)}
\DoxyCodeLine{1079                     x\_2(:, i) = x\_2(:, i-\/1) }
\DoxyCodeLine{1080                 }
\DoxyCodeLine{1081                     \textcolor{comment}{! To determine whether this point should be added to the burnt and thinned MCMC chain                }}
\DoxyCodeLine{1082                     \textcolor{keywordflow}{if} ((i > (burn + 1)) .and. (thin\_counter == thin)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{1083                         \textcolor{comment}{! Increment the reset counter }}
\DoxyCodeLine{1084                         reset\_counter = 1 + reset\_counter}
\DoxyCodeLine{1085                         \textcolor{comment}{! Precalculate i\_bt for shorthand}}
\DoxyCodeLine{1086                         i\_bt = i -\/ burn -\/ (reset\_counter * (thin -\/ 1))}
\DoxyCodeLine{1087                         \textcolor{comment}{! Add to the burn and thinned MCMC chain}}
\DoxyCodeLine{1088                         x\_1\_burnt(:, i\_bt) = x\_1(:, i-\/1)}
\DoxyCodeLine{1089                         x\_2\_burnt(:, i\_bt) = x\_2(:, i-\/1)}
\DoxyCodeLine{1090                         \textcolor{comment}{! Calculate the local energy at this point }}
\DoxyCodeLine{1091                         energy\_chain(i\_bt) = h\_2\_energy(c\_const, x\_1(:, i\textcolor{comment}{-\/1), x\_2(:, i-\/1), r\_a, r\_b)}}
\DoxyCodeLine{1092 \textcolor{comment}{}                        \textcolor{comment}{! Resetting the thin counter }}
\DoxyCodeLine{1093                         thin\_counter = 0}
\DoxyCodeLine{1094 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{1095 \textcolor{keywordflow}{                end if} }
\DoxyCodeLine{1096 \textcolor{keywordflow}{            end do} }
\DoxyCodeLine{1097 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{1098 }
\DoxyCodeLine{1099         \textcolor{comment}{! Calculate the acceptance ratio}}
\DoxyCodeLine{1100         accept\_rate = (real(accept, kind=real64) / real(re\_size, kind=real64\textcolor{comment}{)) }}
\DoxyCodeLine{1101 \textcolor{comment}{}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevqmc_ac00c311b77347b5ed6258bb64214dd9f_cgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}\label{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}} 
\index{vqmc@{vqmc}!ntab@{ntab}}
\index{ntab@{ntab}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{ntab}{ntab}}
{\footnotesize\ttfamily integer, parameter vqmc\+::ntab = 32}



Definition at line 32 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{32     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{parameter} :: ntab = 32}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}\label{namespacevqmc_a86db46440794b9ef7cfd9fbf1fd69930}} 
\index{vqmc@{vqmc}!iv@{iv}}
\index{iv@{iv}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{iv}{iv}}
{\footnotesize\ttfamily integer(int64), dimension(\mbox{\hyperlink{namespacevqmc_a4acb6b64bbac5c4684654d00393f7f24}{ntab}}), save vqmc\+::iv = 0}



Definition at line 33 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{33     \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{dimension(ntab)}, \textcolor{keywordtype}{save} :: iv = 0 \textcolor{comment}{! 'threadprivate' by default since using MPI}}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a1608372d703310a49afc4243ccf27368}\label{namespacevqmc_a1608372d703310a49afc4243ccf27368}} 
\index{vqmc@{vqmc}!iy@{iy}}
\index{iy@{iy}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{iy}{iy}}
{\footnotesize\ttfamily integer(int64), save vqmc\+::iy = 0}



Definition at line 34 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{34     \textcolor{keywordtype}{integer(int64)}, \textcolor{keywordtype}{save} :: iy = 0}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a986f071589794992c4bc31de25c63976}\label{namespacevqmc_a986f071589794992c4bc31de25c63976}} 
\index{vqmc@{vqmc}!seed@{seed}}
\index{seed@{seed}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{seed}{seed}}
{\footnotesize\ttfamily integer(int64), public vqmc\+::seed}



Definition at line 35 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{35     \textcolor{keywordtype}{integer(int64)} :: seed}

\end{DoxyCode}
\mbox{\Hypertarget{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}\label{namespacevqmc_a4f41e2c494f06da125bf9a56314161b5}} 
\index{vqmc@{vqmc}!logfrac@{logfrac}}
\index{logfrac@{logfrac}!vqmc@{vqmc}}
\doxysubsubsection{\texorpdfstring{logfrac}{logfrac}}
{\footnotesize\ttfamily integer vqmc\+::logfrac = 10}



Definition at line 37 of file vqmc.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{37     \textcolor{keywordtype}{integer} :: logfrac = 10 \textcolor{comment}{! [TEMPORARY PLACEMENT] 1/logfrac is the fraction of samples to report in the log}}

\end{DoxyCode}
