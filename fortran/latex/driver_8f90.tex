\hypertarget{driver_8f90}{}\doxysection{repo/src/driver.f90 File Reference}
\label{driver_8f90}\index{repo/src/driver.f90@{repo/src/driver.f90}}
\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
program \mbox{\hyperlink{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}{main}}
\begin{DoxyCompactList}\small\item\em Main program, contains the driver subroutine that runs all other code. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}{driver}} ()
\begin{DoxyCompactList}\small\item\em Subroutine for running the main code (needed for Doxygen compatability). \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}\label{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}} 
\index{driver.f90@{driver.f90}!main@{main}}
\index{main@{main}!driver.f90@{driver.f90}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily program main}



Main program, contains the driver subroutine that runs all other code. 

Packaged as a separate subroutine within this program so that it remains compatible with Doxygen, which otherwise ignores any further documentation. 

Definition at line 14 of file driver.\+f90.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}\label{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}} 
\index{driver.f90@{driver.f90}!driver@{driver}}
\index{driver@{driver}!driver.f90@{driver.f90}}
\doxysubsubsection{\texorpdfstring{driver()}{driver()}}
{\footnotesize\ttfamily subroutine main\+::driver}



Subroutine for running the main code (needed for Doxygen compatability). 

The main driver code for the VQMC program. Links all other modules to run VQMC calculations on the Quantum Harmonic Oscillator (QHO), the Hydrogen Molecular Ion (H2plus) and the Hydrogen Molecule (H2).

Reads inputs from a provided input file, either generated by a Python frontend script or handwritten in the Fortran Namelist I/O format. Determines the problem to be solved, then runs VQMC routines. These can be run over a set parameter space, or in the case of the H2plus and H2 problems, can automatically determine the best variational parameter for the current bond length. Outputs results in Net\+CDF format, to be read by a Python frontend visualisation notebook for analysis.

Also includes extensions to start separate equilibration runs for determining optimal burning/thinning parameters for the Markov chain, and to write the energy traces for each parameter / parameter combination. Also capable of logging the full Markov chain to file (slow, should only be used for debug). 

Definition at line 52 of file driver.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{55 \textcolor{comment}{! SECTION: Variable Declarations}}
\DoxyCodeLine{56 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: p\_arr}
\DoxyCodeLine{59 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: bonds}
\DoxyCodeLine{60 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2plus\_param\_c\_array}
\DoxyCodeLine{61 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2\_param\_a\_array}
\DoxyCodeLine{62 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2\_param\_beta\_array}
\DoxyCodeLine{63 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energies}
\DoxyCodeLine{64 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{65 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: accept\_rates}
\DoxyCodeLine{67 \textcolor{keywordtype}{    real}(real64) :: H2plus\_param\_c\_guess}
\DoxyCodeLine{68 \textcolor{keywordtype}{    real}(real64) :: H2plus\_param\_c\_opt}
\DoxyCodeLine{69 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_beta\_guess}
\DoxyCodeLine{70 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_beta\_opt}
\DoxyCodeLine{71 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_a}
\DoxyCodeLine{72 \textcolor{keywordtype}{    real}(real64) :: energy}
\DoxyCodeLine{73 \textcolor{keywordtype}{    real}(real64) :: variance}
\DoxyCodeLine{74 \textcolor{keywordtype}{    real}(real64) :: accept\_rate}
\DoxyCodeLine{75     }
\DoxyCodeLine{76     \textcolor{keywordtype}{integer} :: b, i}
\DoxyCodeLine{77     \textcolor{keywordtype}{integer} :: logiostat}
\DoxyCodeLine{78     \textcolor{keywordtype}{integer} :: ierr}
\DoxyCodeLine{79     \textcolor{keywordtype}{character(len=1)} :: H2plus\_c\_converged}
\DoxyCodeLine{80     \textcolor{keywordtype}{character(len=1)} :: H2\_beta\_converged}
\DoxyCodeLine{81     \textcolor{keywordtype}{logical} :: exist}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{84 \textcolor{comment}{! SECTION: Initial Setup}}
\DoxyCodeLine{85 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{comment}{! Read the input parameters.}}
\DoxyCodeLine{88     \textcolor{keyword}{call }read\_inputs()}
\DoxyCodeLine{89     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{90     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('System: ', A)"{}}) p\_system}
\DoxyCodeLine{91     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     \textcolor{comment}{! Make sure the equilibration output directory exists if needed.}}
\DoxyCodeLine{94     \textcolor{comment}{! There is no simple way to check directory existence that works}}
\DoxyCodeLine{95     \textcolor{comment}{! with both ifort and gfortran, so mkdir is just run with stderr}}
\DoxyCodeLine{96     \textcolor{comment}{! suppressed instead.}}
\DoxyCodeLine{97     \textcolor{keywordflow}{if} (run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{98         \textcolor{keyword}{call }system(\textcolor{stringliteral}{'mkdir ./equil\_out 2>/dev/null'})}
\DoxyCodeLine{99         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Program started in Equilibration Mode')"{}})}
\DoxyCodeLine{100 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{comment}{! Same directory check as above for write\_chains.}}
\DoxyCodeLine{103     \textcolor{keywordflow}{if} (write\_chains) \textcolor{keywordflow}{then}}
\DoxyCodeLine{104         \textcolor{keyword}{call }system(\textcolor{stringliteral}{'mkdir ./traces\_out 2>/dev/null'})}
\DoxyCodeLine{105         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Program started in full VQMC mode with additional trace outputting')"{}}) }
\DoxyCodeLine{106 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{comment}{! Initialise or update the log file if required.}}
\DoxyCodeLine{109     \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{110         \textcolor{keywordflow}{if}(run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112             \textcolor{comment}{! Check if the logfile exists in current directory}}
\DoxyCodeLine{113             \textcolor{keyword}{inquire}(file=\textcolor{stringliteral}{'params.txt'}, exist=exist)}
\DoxyCodeLine{114 }
\DoxyCodeLine{115             \textcolor{keywordflow}{if} (exist) \textcolor{keywordflow}{then}}
\DoxyCodeLine{116                 \textcolor{comment}{! Open the logfile in 'append' mode}}
\DoxyCodeLine{117                 \textcolor{keyword}{open}(logid, file=logfile, status=\textcolor{stringliteral}{"{}old"{}}, access=\textcolor{stringliteral}{"{}append"{}}, \&}
\DoxyCodeLine{118                 action=\textcolor{stringliteral}{"{}write"{}}, form=\textcolor{stringliteral}{'formatted'}, iostat=logiostat)}
\DoxyCodeLine{119                 \textcolor{keywordflow}{if} (logiostat .ne. 0) \textcolor{keyword}{write}(0, *) \textcolor{stringliteral}{'Error opening log file '}, logfile}
\DoxyCodeLine{120             \textcolor{keywordflow}{else}}
\DoxyCodeLine{121                 \textcolor{comment}{! Create a new logfile}}
\DoxyCodeLine{122                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('New logfile created, as the previous logfile cannot be found.')"{}}) }
\DoxyCodeLine{123                 \textcolor{keyword}{open}(logid, file=logfile, status=\textcolor{stringliteral}{'unknown'}, access=\textcolor{stringliteral}{'sequential'}, \&}
\DoxyCodeLine{124                 form=\textcolor{stringliteral}{'formatted'}, iostat=logiostat)}
\DoxyCodeLine{125                 \textcolor{keywordflow}{if} (logiostat .ne. 0) \textcolor{keyword}{write}(0, *) \textcolor{stringliteral}{'Error opening log file '}, logfile           }
\DoxyCodeLine{126 \textcolor{keywordflow}{            endif}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128             \textcolor{comment}{! Update the logfile about program restart}}
\DoxyCodeLine{129             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{130             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('****** RESTARTED PROGRAM ******')"{}})}
\DoxyCodeLine{131             \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{132 }
\DoxyCodeLine{133         \textcolor{keywordflow}{else} }
\DoxyCodeLine{134             \textcolor{comment}{! Create a new logfile}}
\DoxyCodeLine{135             \textcolor{keyword}{open}(logid, file=logfile, status=\textcolor{stringliteral}{'unknown'}, access=\textcolor{stringliteral}{'sequential'}, \&}
\DoxyCodeLine{136             form=\textcolor{stringliteral}{'formatted'}, iostat=logiostat)}
\DoxyCodeLine{137             \textcolor{keywordflow}{if} (logiostat .ne. 0) \textcolor{keyword}{write}(0, *) \textcolor{stringliteral}{'Error opening log file '}, logfile}
\DoxyCodeLine{138 \textcolor{keywordflow}{        endif} }
\DoxyCodeLine{139 }
\DoxyCodeLine{140         \textcolor{comment}{! Write program details to logfile}}
\DoxyCodeLine{141         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('*** [PROGRAM NAME] log file ***')"{}}) \textcolor{comment}{! include date/time?}}
\DoxyCodeLine{142         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{143         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('System: ', A)"{}}) p\_system}
\DoxyCodeLine{144         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{keywordflow}{    endif} }
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{! If p\_system='test', run test module.}}
\DoxyCodeLine{149     \textcolor{keywordflow}{if} (trim(p\_system)==\textcolor{stringliteral}{'test'}) \textcolor{keywordflow}{then}}
\DoxyCodeLine{150         \textcolor{keyword}{call }unit\_tests()}
\DoxyCodeLine{151         \textcolor{keyword}{call }exit()}
\DoxyCodeLine{152     \textcolor{comment}{! If not, initialise the random number generator.}}
\DoxyCodeLine{153     \textcolor{keywordflow}{else}}
\DoxyCodeLine{154         \textcolor{keyword}{call }init\_ran1()}
\DoxyCodeLine{155 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{158 \textcolor{comment}{! SECTION: VQMC Loops}}
\DoxyCodeLine{159 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{comment}{! Execute problem-\/dependent routines.}}
\DoxyCodeLine{162     \textcolor{keywordflow}{select case}(trim(p\_system))}
\DoxyCodeLine{163 }
\DoxyCodeLine{164     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{165     \textcolor{comment}{!   SUBSECTION: Quantum Harmonic Oscillator}}
\DoxyCodeLine{166     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'QHO'})}
\DoxyCodeLine{169 }
\DoxyCodeLine{170             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{171             \textcolor{keyword}{allocate}(energies(int(qho\%alpha(3)))); energies(:) = 0.0\_real64}
\DoxyCodeLine{172             \textcolor{keyword}{allocate}(accept\_rates(int(qho\%alpha(3)))); accept\_rates(:) = 0.0\_real64}
\DoxyCodeLine{173 }
\DoxyCodeLine{174             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{175             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I3, ' parameter(s).')"{}}) int(qho\%alpha(3))}
\DoxyCodeLine{176             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', I7, ' Steps.')"{}}) \&}
\DoxyCodeLine{177                 qho\%steps, qho\%burn\_step, qho\%thin\_step}
\DoxyCodeLine{178             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{179 }
\DoxyCodeLine{180             \textcolor{comment}{! Set up alpha array.}}
\DoxyCodeLine{181             p\_arr = linspace(qho\%alpha(1), qho\%alpha(2), qho\%alpha(3))}
\DoxyCodeLine{182             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{183             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{184             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{185                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{186                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of alpha values: ')"{}})}
\DoxyCodeLine{187                 \textcolor{keywordflow}{do} i = 1, int(qho\%alpha(3))}
\DoxyCodeLine{188                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{189 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{190                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{191 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193             \textcolor{comment}{! For restart runs, update the results with previous progress}}
\DoxyCodeLine{194             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196                 \textcolor{comment}{! Read results for grid points evaluated in the previous run}}
\DoxyCodeLine{197                 \textcolor{keyword}{call }read\_energies(resfile\_etot,energies,accept\_rates)}
\DoxyCodeLine{198 }
\DoxyCodeLine{199                 \textcolor{comment}{! Print the results read from the previous run}}
\DoxyCodeLine{200                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Read Previous Results -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{201                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Alpha       Energy            Acceptance Rate')"{}})}
\DoxyCodeLine{202                 \textcolor{keywordflow}{do} i = 1, res\%i\_alpha-\/1}
\DoxyCodeLine{203                     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F7.4, '     ', F12.6, '      ', F12.10)"{}}) \&}
\DoxyCodeLine{204                             p\_arr(i), energies(i), accept\_rates(i)}
\DoxyCodeLine{205 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{206             }
\DoxyCodeLine{207 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{208 }
\DoxyCodeLine{209             \textcolor{comment}{! Main VQMC callers.}}
\DoxyCodeLine{210             \textcolor{keywordflow}{if} (run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{211                 \textcolor{keyword}{call }equil\_qho(p\_arr)}
\DoxyCodeLine{212             \textcolor{keywordflow}{else}}
\DoxyCodeLine{213                 \textcolor{keyword}{call }grid\_qho(p\_arr, energies, accept\_rates)}
\DoxyCodeLine{214 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{215 }
\DoxyCodeLine{216     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{217     \textcolor{comment}{!   SUBSECTION: Hydrogen Molecular Ion}}
\DoxyCodeLine{218     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{219 }
\DoxyCodeLine{220         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'H2plus'})}
\DoxyCodeLine{221 }
\DoxyCodeLine{222             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{223             \textcolor{keyword}{allocate}(energies(int(h2plus\%bond(3))))}
\DoxyCodeLine{224             \textcolor{keyword}{allocate}(variances(int(h2plus\%bond(3))))}
\DoxyCodeLine{225             \textcolor{keyword}{allocate}(h2plus\_param\_c\_array(int(h2plus\%bond(3))))}
\DoxyCodeLine{226             \textcolor{keyword}{allocate}(accept\_rates(int(h2plus\%bond(3))))}
\DoxyCodeLine{227             h2plus\_param\_c\_guess = h2plus\%c}
\DoxyCodeLine{228 }
\DoxyCodeLine{229             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{230             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I7, ' bond lengths.')"{}}) int(h2plus\%bond(3))}
\DoxyCodeLine{231             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', \&}}
\DoxyCodeLine{232 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \& I7, ' Steps.')"{}}) h2plus\%steps, h2plus\%burn\_step, h2plus\%thin\_step}
\DoxyCodeLine{233             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{234 }
\DoxyCodeLine{235             \textcolor{comment}{! Set up bond length array}}
\DoxyCodeLine{236             bonds = linspace(h2plus\%bond(1), h2plus\%bond(2), h2plus\%bond(3))}
\DoxyCodeLine{237             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{238                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of bond lengths: ')"{}})}
\DoxyCodeLine{239                 \textcolor{keywordflow}{do} i = 1, int(h2plus\%bond(3))}
\DoxyCodeLine{240                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Bond length ', I4, ': ', F7.4)"{}}) i, bonds(i)}
\DoxyCodeLine{241 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{242                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{243 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245             \textcolor{comment}{! Set up parameter array, if doing a grid search}}
\DoxyCodeLine{246             \textcolor{keywordflow}{if} (h2plus\%auto\_params .eqv. .false.) \textcolor{keywordflow}{then}}
\DoxyCodeLine{247                 p\_arr = linspace(h2plus\%c1(1), h2plus\%c1(2), h2plus\%c1(3))}
\DoxyCodeLine{248                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{249                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{250                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{251                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{252                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of c values: ')"{}})}
\DoxyCodeLine{253                     \textcolor{keywordflow}{do} i = 1, int(h2plus\%c1(3))}
\DoxyCodeLine{254                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{255 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{256                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{257 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{258             \textcolor{keywordflow}{else}}
\DoxyCodeLine{259                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{260                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{261                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{262                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{263                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{264 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{265 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{266 }
\DoxyCodeLine{267             \textcolor{comment}{! Sort out restarting}}
\DoxyCodeLine{268             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{269                 \textcolor{comment}{! Insert optimised parameters and energies into arrays}}
\DoxyCodeLine{270 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272             \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{273             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{274             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Bond Length    Converged?    Optimised c       Energy')"{}})}
\DoxyCodeLine{275             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{276                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{277 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{278 }
\DoxyCodeLine{279             \textcolor{comment}{! Loop over bond lengths}}
\DoxyCodeLine{280             \textcolor{keywordflow}{do} b = 1, int(h2plus\%bond(3))}
\DoxyCodeLine{281 }
\DoxyCodeLine{282                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{283                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Bond Length = ', F7.4, ' -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  ')"{}}) \&}
\DoxyCodeLine{284                         bonds(b)}
\DoxyCodeLine{285 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{286 }
\DoxyCodeLine{287                 \textcolor{comment}{! Main VQMC callers}}
\DoxyCodeLine{288                 \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{289                     \textcolor{keywordflow}{if} (h2plus\%auto\_params) \textcolor{keywordflow}{then}}
\DoxyCodeLine{290 }
\DoxyCodeLine{291                         \textcolor{comment}{! Search for best param at this bond length}}
\DoxyCodeLine{292                         \textcolor{keyword}{call }auto\_h\_2\_plus(h2plus\_param\_c\_guess, bonds(b), h2plus\_param\_c\_opt, \&}
\DoxyCodeLine{293                         energy, variance, accept\_rate, h2plus\_c\_converged)}
\DoxyCodeLine{294 }
\DoxyCodeLine{295                         \textcolor{comment}{! Use current optimised value of c as guess for next bond length's c,}}
\DoxyCodeLine{296                         \textcolor{comment}{! provided calculations converged this loop}}
\DoxyCodeLine{297                         \textcolor{keywordflow}{if} (h2plus\_c\_converged .eq. \textcolor{stringliteral}{'Y'}) h2plus\_param\_c\_guess = h2plus\_param\_c\_opt}
\DoxyCodeLine{298 }
\DoxyCodeLine{299                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{300                         h2plus\_param\_c\_array(b) = h2plus\_param\_c\_opt}
\DoxyCodeLine{301                         energies(b) = energy}
\DoxyCodeLine{302                         variances(b) = variance}
\DoxyCodeLine{303                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{304 }
\DoxyCodeLine{305                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{306 }
\DoxyCodeLine{307                         \textcolor{comment}{! Find best param in grid at this bond length}}
\DoxyCodeLine{308                         \textcolor{keyword}{call }grid\_h\_2\_plus(p\_arr, bonds(b), h2plus\_param\_c\_opt, energy, \&}
\DoxyCodeLine{309                             variance, accept\_rate)}
\DoxyCodeLine{310 }
\DoxyCodeLine{311                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{312                         h2plus\_param\_c\_array(b) = h2plus\_param\_c\_opt}
\DoxyCodeLine{313                         energies(b) = energy}
\DoxyCodeLine{314                         variances(b) = variance}
\DoxyCodeLine{315                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{316 }
\DoxyCodeLine{317 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{318 }
\DoxyCodeLine{319                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{320                     \textcolor{comment}{! Run equilibrations}}
\DoxyCodeLine{321                     \textcolor{keyword}{call }equil\_h\_2\_plus(p\_arr, bonds(b), b)}
\DoxyCodeLine{322 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{323 }
\DoxyCodeLine{324 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{325 }
\DoxyCodeLine{326             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ End VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{327             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{328 }
\DoxyCodeLine{329             \textcolor{comment}{! If not in equilibration mode, write results}}
\DoxyCodeLine{330             \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{331                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF output file '}, \&}
\DoxyCodeLine{332                     outfile}
\DoxyCodeLine{333                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{334                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF \&}}
\DoxyCodeLine{335 \textcolor{stringliteral}{}\textcolor{stringliteral}{                        \&output file '}, outfile}
\DoxyCodeLine{336 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{337 }
\DoxyCodeLine{338                 \textcolor{keyword}{call }write\_h2plus\_main(h2plus\_param\_c\_array, bonds, energies, variances, \&}
\DoxyCodeLine{339                     outfile, ierr, h2plus, accept\_rates)}
\DoxyCodeLine{340 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{341 }
\DoxyCodeLine{342 }
\DoxyCodeLine{343     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{344     \textcolor{comment}{!   SUBSECTION: Hydrogen Molecule}}
\DoxyCodeLine{345     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{346 }
\DoxyCodeLine{347         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'H2'})}
\DoxyCodeLine{348 }
\DoxyCodeLine{349             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{350             \textcolor{keyword}{allocate}(h2\_param\_a\_array(int(h2\%bond(3))))}
\DoxyCodeLine{351             \textcolor{keyword}{allocate}(h2\_param\_beta\_array(int(h2\%bond(3))))}
\DoxyCodeLine{352             \textcolor{keyword}{allocate}(energies(int(h2\%bond(3))))}
\DoxyCodeLine{353             \textcolor{keyword}{allocate}(variances(int(h2\%bond(3))))}
\DoxyCodeLine{354             \textcolor{keyword}{allocate}(accept\_rates(int(h2\%bond(3))))}
\DoxyCodeLine{355             h2\_param\_beta\_guess = h2\%beta}
\DoxyCodeLine{356 }
\DoxyCodeLine{357             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{358             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I7, ' bond lengths.')"{}}) int(h2\%bond(3))}
\DoxyCodeLine{359             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', I7, ' Steps.')"{}}) \&}
\DoxyCodeLine{360                     h2\%steps, h2\%burn\_step, h2\%thin\_step}
\DoxyCodeLine{361                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{362 }
\DoxyCodeLine{363             \textcolor{comment}{! Set up bond length array}}
\DoxyCodeLine{364             bonds = linspace(h2\%bond(1), h2\%bond(2), h2\%bond(3))}
\DoxyCodeLine{365             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{366                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of bond lengths: ')"{}})}
\DoxyCodeLine{367                 \textcolor{keywordflow}{do} i = 1, int(h2\%bond(3))}
\DoxyCodeLine{368                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Bond length ', I4, ': ', F7.4)"{}}) i, bonds(i)}
\DoxyCodeLine{369 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{370                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{371 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{372 }
\DoxyCodeLine{373             \textcolor{comment}{! Set up parameter array, if doing a grid search}}
\DoxyCodeLine{374             \textcolor{keywordflow}{if} (h2\%auto\_params .eqv. .false.) \textcolor{keywordflow}{then}}
\DoxyCodeLine{375                 p\_arr = linspace(h2\%c1(1), h2\%c1(2), h2\%c1(3))}
\DoxyCodeLine{376                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{377                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{378                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{379                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{380                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of beta values: ')"{}})}
\DoxyCodeLine{381                     \textcolor{keywordflow}{do} i = 1, int(h2\%c1(3))}
\DoxyCodeLine{382                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{383 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{384                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{385 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{386             \textcolor{keywordflow}{else}}
\DoxyCodeLine{387                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{388                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{389                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{390                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{391                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{392 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{393 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{394 }
\DoxyCodeLine{395             \textcolor{comment}{! Sort out restarting}}
\DoxyCodeLine{396             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{397                 \textcolor{comment}{! Insert optimised parameters and energies into arrays}}
\DoxyCodeLine{398 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{399 }
\DoxyCodeLine{400             \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{401             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{402             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Bond Length    Converged?    Optimised Beta    Energy')"{}})}
\DoxyCodeLine{403             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{404                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{405 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{406 }
\DoxyCodeLine{407             \textcolor{comment}{! Loop over bond lengths}}
\DoxyCodeLine{408             \textcolor{keywordflow}{do} b = 1, int(h2\%bond(3))}
\DoxyCodeLine{409 }
\DoxyCodeLine{410                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{411                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Bond Length = ', F7.4, ' -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  ')"{}}) \&}
\DoxyCodeLine{412                         bonds(b)}
\DoxyCodeLine{413 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{414 }
\DoxyCodeLine{415                 \textcolor{comment}{! Calculate parameter a at this bond length by Newton-\/Raphson iteration.}}
\DoxyCodeLine{416                 h2\_param\_a = h\_2\_cusp(bonds(b))}
\DoxyCodeLine{417 }
\DoxyCodeLine{418                 \textcolor{comment}{! Main VQMC callers}}
\DoxyCodeLine{419                 \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{420                     \textcolor{comment}{! Either iterate through beta values, or automatically search for best c.}}
\DoxyCodeLine{421                     \textcolor{keywordflow}{if} (h2\%auto\_params) \textcolor{keywordflow}{then} \textcolor{comment}{! ie. if auto searching}}
\DoxyCodeLine{422 }
\DoxyCodeLine{423                         \textcolor{comment}{! Solve value of beta at this bond length.}}
\DoxyCodeLine{424                         \textcolor{keyword}{call }auto\_h\_2(h2\_param\_a, h2\_param\_beta\_guess, bonds(b), h2\_param\_beta\_opt, \&}
\DoxyCodeLine{425                             energy, variance, accept\_rate, h2\_beta\_converged)}
\DoxyCodeLine{426 }
\DoxyCodeLine{427                         \textcolor{comment}{! Use current optimised value of beta as guess for next bond length's beta,}}
\DoxyCodeLine{428                         \textcolor{comment}{! provided calculations converged this loop}}
\DoxyCodeLine{429                         \textcolor{keywordflow}{if} (h2\_beta\_converged .eq. \textcolor{stringliteral}{'Y'}) h2\_param\_beta\_guess = h2\_param\_beta\_opt}
\DoxyCodeLine{430 }
\DoxyCodeLine{431                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{432                         h2\_param\_a\_array(b) = h2\_param\_a}
\DoxyCodeLine{433                         h2\_param\_beta\_array(b) = h2\_param\_beta\_opt}
\DoxyCodeLine{434                         energies(b) = energy}
\DoxyCodeLine{435                         variances(b) = variance}
\DoxyCodeLine{436                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{437                     }
\DoxyCodeLine{438                     \textcolor{keywordflow}{else} \textcolor{comment}{! ie. if doing a grid search}}
\DoxyCodeLine{439 }
\DoxyCodeLine{440                         \textcolor{comment}{! Get best value of beta at this bond length}}
\DoxyCodeLine{441                         \textcolor{keyword}{call }grid\_h\_2(h2\_param\_a, p\_arr, bonds(b), h2\_param\_beta\_opt, energy, \&}
\DoxyCodeLine{442                         variance, accept\_rate)}
\DoxyCodeLine{443 }
\DoxyCodeLine{444                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{445                         h2\_param\_a\_array(b) = h2\_param\_a}
\DoxyCodeLine{446                         h2\_param\_beta\_array(b) = h2\_param\_beta\_opt}
\DoxyCodeLine{447                         energies(b) = energy}
\DoxyCodeLine{448                         variances(b) = variance}
\DoxyCodeLine{449                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{450 }
\DoxyCodeLine{451 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{452 }
\DoxyCodeLine{453                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{454                     \textcolor{comment}{! Run equilibrations}}
\DoxyCodeLine{455                     \textcolor{keyword}{call }equil\_h\_2(h2\_param\_a, p\_arr, bonds(b), b)}
\DoxyCodeLine{456 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{457 }
\DoxyCodeLine{458 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{459 }
\DoxyCodeLine{460             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ End VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{461             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{462 }
\DoxyCodeLine{463             \textcolor{comment}{! If not in equilibration mode, write results}}
\DoxyCodeLine{464             \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{465                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF output file '}, \&}
\DoxyCodeLine{466                     outfile}
\DoxyCodeLine{467                     \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{468                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF \&}}
\DoxyCodeLine{469 \textcolor{stringliteral}{}\textcolor{stringliteral}{                            \&output file '}, outfile}
\DoxyCodeLine{470 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{471 }
\DoxyCodeLine{472                     \textcolor{keyword}{call }write\_h2\_main(h2\_param\_a\_array, h2\_param\_beta\_array, bonds, \&}
\DoxyCodeLine{473                         energies, variances, outfile, ierr, h2, accept\_rates)}
\DoxyCodeLine{474 }
\DoxyCodeLine{475 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{476 }
\DoxyCodeLine{477         \textcolor{comment}{! Default case, for if none of the cases match. Should be invalidated by checks in input\_parser.}}
\DoxyCodeLine{478 \textcolor{keywordflow}{        case default}}
\DoxyCodeLine{479             error stop \textcolor{stringliteral}{'Unknown case. How did you get here?'}}
\DoxyCodeLine{480 \textcolor{keywordflow}{    end select}}
\DoxyCodeLine{481 }
\DoxyCodeLine{482     \textcolor{keywordflow}{if} (write\_log) \textcolor{keyword}{close}(logid)}
\DoxyCodeLine{483 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{driver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=195pt]{driver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph}
\end{center}
\end{figure}
