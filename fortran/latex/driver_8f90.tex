\hypertarget{driver_8f90}{}\doxysection{repo/src/driver.f90 File Reference}
\label{driver_8f90}\index{repo/src/driver.f90@{repo/src/driver.f90}}
\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
program \mbox{\hyperlink{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}{main}}
\begin{DoxyCompactList}\small\item\em Main program, contains the driver subroutine that runs all other code. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}{driver}} ()
\begin{DoxyCompactList}\small\item\em Subroutine for running the main code (needed for Doxygen compatability). \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}\label{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d}} 
\index{driver.f90@{driver.f90}!main@{main}}
\index{main@{main}!driver.f90@{driver.f90}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily program main}



Main program, contains the driver subroutine that runs all other code. 

Packaged as a separate subroutine within this program so that it remains compatible with Doxygen, which otherwise ignores any further documentation. 

Definition at line 14 of file driver.\+f90.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{driver_8f90_a8ec2266d83cd6c0b762cbcbc92c0af3d_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}\label{driver_8f90_aae94725eafaedc467ab9bfefcae9769e}} 
\index{driver.f90@{driver.f90}!driver@{driver}}
\index{driver@{driver}!driver.f90@{driver.f90}}
\doxysubsubsection{\texorpdfstring{driver()}{driver()}}
{\footnotesize\ttfamily subroutine main\+::driver}



Subroutine for running the main code (needed for Doxygen compatability). 

The main driver code for the VQMC program. Links all other modules to run VQMC calculations on the Quantum Harmonic Oscillator (QHO), the Hydrogen Molecular Ion (H2plus) and the Hydrogen Molecule (H2).

Reads inputs from a provided input file, either generated by a Python frontend script or handwritten in the Fortran Namelist I/O format. Determines the problem to be solved, then runs VQMC routines. These can be run over a set parameter space, or in the case of the H2plus and H2 problems, can automatically determine the best variational parameter for the current bond length. Outputs results in Net\+CDF format, to be read by a Python frontend visualisation notebook for analysis.

Also includes extensions to start separate equilibration runs for determining optimal burning/thinning parameters for the Markov chain, and to write the energy traces for each parameter / parameter combination. Also capable of logging the full Markov chain to file (slow, should only be used for debug). 

Definition at line 52 of file driver.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{55 \textcolor{comment}{! SECTION: Variable Declarations}}
\DoxyCodeLine{56 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: p\_arr}
\DoxyCodeLine{59 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: bonds}
\DoxyCodeLine{60 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2plus\_param\_c\_array}
\DoxyCodeLine{61 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2\_param\_a\_array}
\DoxyCodeLine{62 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: H2\_param\_beta\_array}
\DoxyCodeLine{63 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: energies}
\DoxyCodeLine{64 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: variances}
\DoxyCodeLine{65 \textcolor{keywordtype}{    real}(real64), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable} :: accept\_rates}
\DoxyCodeLine{67 \textcolor{keywordtype}{    real}(real64) :: H2plus\_param\_c\_guess}
\DoxyCodeLine{68 \textcolor{keywordtype}{    real}(real64) :: H2plus\_param\_c\_opt}
\DoxyCodeLine{69 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_beta\_guess}
\DoxyCodeLine{70 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_beta\_opt}
\DoxyCodeLine{71 \textcolor{keywordtype}{    real}(real64) :: H2\_param\_a}
\DoxyCodeLine{72 \textcolor{keywordtype}{    real}(real64) :: energy}
\DoxyCodeLine{73 \textcolor{keywordtype}{    real}(real64) :: variance}
\DoxyCodeLine{74 \textcolor{keywordtype}{    real}(real64) :: accept\_rate}
\DoxyCodeLine{75     }
\DoxyCodeLine{76     \textcolor{keywordtype}{integer} :: b, i}
\DoxyCodeLine{77     \textcolor{keywordtype}{integer} :: logiostat}
\DoxyCodeLine{78     \textcolor{keywordtype}{integer} :: ierr}
\DoxyCodeLine{79     \textcolor{keywordtype}{character(len=1)} :: H2plus\_c\_converged}
\DoxyCodeLine{80     \textcolor{keywordtype}{character(len=1)} :: H2\_beta\_converged}
\DoxyCodeLine{81     \textcolor{keywordtype}{logical} :: exist}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{84 \textcolor{comment}{! SECTION: Initial Setup}}
\DoxyCodeLine{85 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{comment}{! Read the input parameters.}}
\DoxyCodeLine{88     \textcolor{keyword}{call }read\_inputs()}
\DoxyCodeLine{89     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{90     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('System: ', A)"{}}) p\_system}
\DoxyCodeLine{91     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     \textcolor{comment}{! Make sure the equilibration output directory exists if needed.}}
\DoxyCodeLine{94     \textcolor{comment}{! There is no simple way to check directory existence that works}}
\DoxyCodeLine{95     \textcolor{comment}{! with both ifort and gfortran, so mkdir is just run with stderr}}
\DoxyCodeLine{96     \textcolor{comment}{! suppressed instead.}}
\DoxyCodeLine{97     \textcolor{keywordflow}{if} (run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{98         \textcolor{keyword}{call }system(\textcolor{stringliteral}{'mkdir ./equil\_out 2>/dev/null'})}
\DoxyCodeLine{99         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Program started in Equilibration Mode')"{}})}
\DoxyCodeLine{100 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{comment}{! Same directory check as above for write\_chains.}}
\DoxyCodeLine{103     \textcolor{keywordflow}{if} (write\_chains) \textcolor{keywordflow}{then}}
\DoxyCodeLine{104         \textcolor{keyword}{call }system(\textcolor{stringliteral}{'mkdir ./traces\_out 2>/dev/null'})}
\DoxyCodeLine{105         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Program started in full VQMC mode with additional trace outputting')"{}}) }
\DoxyCodeLine{106 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110         \textcolor{comment}{! Initialise log file if required.}}
\DoxyCodeLine{111         \textcolor{keyword}{open}(logid, file=logfile, status=\textcolor{stringliteral}{'unknown'}, access=\textcolor{stringliteral}{'sequential'}, \&}
\DoxyCodeLine{112         form=\textcolor{stringliteral}{'formatted'}, iostat=logiostat)}
\DoxyCodeLine{113         \textcolor{keywordflow}{if} (logiostat .ne. 0) \textcolor{keyword}{write}(0, *) \textcolor{stringliteral}{'Error opening log file '}, logfile}
\DoxyCodeLine{114 }
\DoxyCodeLine{115         \textcolor{comment}{! Write program details to logfile}}
\DoxyCodeLine{116         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('*** [PROGRAM NAME] log file ***')"{}}) \textcolor{comment}{! include date/time?}}
\DoxyCodeLine{117         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{118         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('System: ', A)"{}}) p\_system}
\DoxyCodeLine{119         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{120         }
\DoxyCodeLine{121 \textcolor{keywordflow}{    endif} }
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{comment}{! If p\_system='test', run test module.}}
\DoxyCodeLine{124     \textcolor{keywordflow}{if} (trim(p\_system)==\textcolor{stringliteral}{'test'}) \textcolor{keywordflow}{then}}
\DoxyCodeLine{125         \textcolor{keyword}{call }unit\_tests()}
\DoxyCodeLine{126         \textcolor{keyword}{call }exit()}
\DoxyCodeLine{127     \textcolor{comment}{! If not, initialise the random number generator.}}
\DoxyCodeLine{128     \textcolor{keywordflow}{else}}
\DoxyCodeLine{129         \textcolor{keyword}{call }init\_ran1()}
\DoxyCodeLine{130 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{133 \textcolor{comment}{! SECTION: VQMC Loops}}
\DoxyCodeLine{134 \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{135 }
\DoxyCodeLine{136     \textcolor{comment}{! Execute problem-\/dependent routines.}}
\DoxyCodeLine{137     \textcolor{keywordflow}{select case}(trim(p\_system))}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{140     \textcolor{comment}{!   SUBSECTION: Quantum Harmonic Oscillator}}
\DoxyCodeLine{141     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'QHO'})}
\DoxyCodeLine{144 }
\DoxyCodeLine{145             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{146             \textcolor{keyword}{allocate}(energies(int(qho\%alpha(3)))); energies(:) = 0.0\_real64}
\DoxyCodeLine{147             \textcolor{keyword}{allocate}(accept\_rates(int(qho\%alpha(3)))); accept\_rates(:) = 0.0\_real64}
\DoxyCodeLine{148 }
\DoxyCodeLine{149             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{150             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I3, ' parameter(s).')"{}}) int(qho\%alpha(3))}
\DoxyCodeLine{151             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', I7, ' Steps.')"{}}) \&}
\DoxyCodeLine{152                 qho\%steps, qho\%burn\_step, qho\%thin\_step}
\DoxyCodeLine{153             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{154 }
\DoxyCodeLine{155             \textcolor{comment}{! Set up alpha array.}}
\DoxyCodeLine{156             p\_arr = linspace(qho\%alpha(1), qho\%alpha(2), qho\%alpha(3))}
\DoxyCodeLine{157             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{158             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{159             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{160                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{161                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of alpha values: ')"{}})}
\DoxyCodeLine{162                 \textcolor{keywordflow}{do} i = 1, int(qho\%alpha(3))}
\DoxyCodeLine{163                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{164 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{165                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{166 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168             \textcolor{comment}{! For restart runs, update the results with previous progress}}
\DoxyCodeLine{169             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171                 \textcolor{comment}{! Read results for grid points evaluated in the previous run}}
\DoxyCodeLine{172                 \textcolor{keyword}{call }read\_energies(resfile\_etot,energies,accept\_rates)}
\DoxyCodeLine{173 }
\DoxyCodeLine{174                 \textcolor{comment}{! Print the results read from the previous run}}
\DoxyCodeLine{175                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Read Previous Results -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{176                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Alpha       Energy            Acceptance Rate')"{}})}
\DoxyCodeLine{177                 \textcolor{keywordflow}{do} i = 1, res\%i\_alpha-\/1}
\DoxyCodeLine{178                     \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(F7.4, '     ', F12.6, '      ', F12.10)"{}}) \&}
\DoxyCodeLine{179                             p\_arr(i), energies(i), accept\_rates(i)}
\DoxyCodeLine{180 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{181             }
\DoxyCodeLine{182 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184             \textcolor{comment}{! Main VQMC callers.}}
\DoxyCodeLine{185             \textcolor{keywordflow}{if} (run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{186                 \textcolor{keyword}{call }equil\_qho(p\_arr)}
\DoxyCodeLine{187             \textcolor{keywordflow}{else}}
\DoxyCodeLine{188                 \textcolor{keyword}{call }grid\_qho(p\_arr, energies, accept\_rates)}
\DoxyCodeLine{189 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{192     \textcolor{comment}{!   SUBSECTION: Hydrogen Molecular Ion}}
\DoxyCodeLine{193     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'H2plus'})}
\DoxyCodeLine{196 }
\DoxyCodeLine{197             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{198             \textcolor{keyword}{allocate}(energies(int(h2plus\%bond(3))))}
\DoxyCodeLine{199             \textcolor{keyword}{allocate}(variances(int(h2plus\%bond(3))))}
\DoxyCodeLine{200             \textcolor{keyword}{allocate}(h2plus\_param\_c\_array(int(h2plus\%bond(3))))}
\DoxyCodeLine{201             \textcolor{keyword}{allocate}(accept\_rates(int(h2plus\%bond(3))))}
\DoxyCodeLine{202             h2plus\_param\_c\_guess = h2plus\%c}
\DoxyCodeLine{203 }
\DoxyCodeLine{204             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{205             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I7, ' bond lengths.')"{}}) int(h2plus\%bond(3))}
\DoxyCodeLine{206             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', \&}}
\DoxyCodeLine{207 \textcolor{stringliteral}{}\textcolor{stringliteral}{                \& I7, ' Steps.')"{}}) h2plus\%steps, h2plus\%burn\_step, h2plus\%thin\_step}
\DoxyCodeLine{208             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{209 }
\DoxyCodeLine{210             \textcolor{comment}{! Set up bond length array}}
\DoxyCodeLine{211             bonds = linspace(h2plus\%bond(1), h2plus\%bond(2), h2plus\%bond(3))}
\DoxyCodeLine{212             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{213                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of bond lengths: ')"{}})}
\DoxyCodeLine{214                 \textcolor{keywordflow}{do} i = 1, int(h2plus\%bond(3))}
\DoxyCodeLine{215                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Bond length ', I4, ': ', F7.4)"{}}) i, bonds(i)}
\DoxyCodeLine{216 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{217                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{218 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{219 }
\DoxyCodeLine{220             \textcolor{comment}{! Set up parameter array, if doing a grid search}}
\DoxyCodeLine{221             \textcolor{keywordflow}{if} (h2plus\%auto\_params .eqv. .false.) \textcolor{keywordflow}{then}}
\DoxyCodeLine{222                 p\_arr = linspace(h2plus\%c1(1), h2plus\%c1(2), h2plus\%c1(3))}
\DoxyCodeLine{223                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{224                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{225                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{226                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{227                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of c values: ')"{}})}
\DoxyCodeLine{228                     \textcolor{keywordflow}{do} i = 1, int(h2plus\%c1(3))}
\DoxyCodeLine{229                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{230 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{231                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{232 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{233             \textcolor{keywordflow}{else}}
\DoxyCodeLine{234                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{235                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{236                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{237                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{238                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{239 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{240 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{241 }
\DoxyCodeLine{242             \textcolor{comment}{! Sort out restarting}}
\DoxyCodeLine{243             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{244                 \textcolor{comment}{! Insert optimised parameters and energies into arrays}}
\DoxyCodeLine{245 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{246 }
\DoxyCodeLine{247             \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{248             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{249             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Bond Length    Converged?    Optimised c       Energy')"{}})}
\DoxyCodeLine{250             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{251                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{252 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{253 }
\DoxyCodeLine{254             \textcolor{comment}{! Loop over bond lengths}}
\DoxyCodeLine{255             \textcolor{keywordflow}{do} b = 1, int(h2plus\%bond(3))}
\DoxyCodeLine{256 }
\DoxyCodeLine{257                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{258                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Bond Length = ', F7.4, ' -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  ')"{}}) \&}
\DoxyCodeLine{259                         bonds(b)}
\DoxyCodeLine{260 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{261 }
\DoxyCodeLine{262                 \textcolor{comment}{! Main VQMC callers}}
\DoxyCodeLine{263                 \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{264                     \textcolor{keywordflow}{if} (h2plus\%auto\_params) \textcolor{keywordflow}{then}}
\DoxyCodeLine{265 }
\DoxyCodeLine{266                         \textcolor{comment}{! Search for best param at this bond length}}
\DoxyCodeLine{267                         \textcolor{keyword}{call }auto\_h\_2\_plus(h2plus\_param\_c\_guess, bonds(b), h2plus\_param\_c\_opt, \&}
\DoxyCodeLine{268                         energy, variance, accept\_rate, h2plus\_c\_converged)}
\DoxyCodeLine{269 }
\DoxyCodeLine{270                         \textcolor{comment}{! Use current optimised value of c as guess for next bond length's c,}}
\DoxyCodeLine{271                         \textcolor{comment}{! provided calculations converged this loop}}
\DoxyCodeLine{272                         \textcolor{keywordflow}{if} (h2plus\_c\_converged .eq. \textcolor{stringliteral}{'Y'}) h2plus\_param\_c\_guess = h2plus\_param\_c\_opt}
\DoxyCodeLine{273 }
\DoxyCodeLine{274                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{275                         h2plus\_param\_c\_array(b) = h2plus\_param\_c\_opt}
\DoxyCodeLine{276                         energies(b) = energy}
\DoxyCodeLine{277                         variances(b) = variance}
\DoxyCodeLine{278                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{279 }
\DoxyCodeLine{280                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{281 }
\DoxyCodeLine{282                         \textcolor{comment}{! Find best param in grid at this bond length}}
\DoxyCodeLine{283                         \textcolor{keyword}{call }grid\_h\_2\_plus(p\_arr, bonds(b), h2plus\_param\_c\_opt, energy, \&}
\DoxyCodeLine{284                             variance, accept\_rate)}
\DoxyCodeLine{285 }
\DoxyCodeLine{286                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{287                         h2plus\_param\_c\_array(b) = h2plus\_param\_c\_opt}
\DoxyCodeLine{288                         energies(b) = energy}
\DoxyCodeLine{289                         variances(b) = variance}
\DoxyCodeLine{290                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{291 }
\DoxyCodeLine{292 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{293 }
\DoxyCodeLine{294                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{295                     \textcolor{comment}{! Run equilibrations}}
\DoxyCodeLine{296                     \textcolor{keyword}{call }equil\_h\_2\_plus(p\_arr, bonds(b), b)}
\DoxyCodeLine{297 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{298 }
\DoxyCodeLine{299 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{300 }
\DoxyCodeLine{301             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ End VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{302             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{303 }
\DoxyCodeLine{304             \textcolor{comment}{! If not in equilibration mode, write results}}
\DoxyCodeLine{305             \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{306                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF output file '}, \&}
\DoxyCodeLine{307                     outfile}
\DoxyCodeLine{308                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{309                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF \&}}
\DoxyCodeLine{310 \textcolor{stringliteral}{}\textcolor{stringliteral}{                        \&output file '}, outfile}
\DoxyCodeLine{311 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{312 }
\DoxyCodeLine{313                 \textcolor{keyword}{call }write\_h2plus\_main(h2plus\_param\_c\_array, bonds, energies, variances, \&}
\DoxyCodeLine{314                     outfile, ierr, h2plus, accept\_rates)}
\DoxyCodeLine{315 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{316 }
\DoxyCodeLine{317 }
\DoxyCodeLine{318     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{319     \textcolor{comment}{!   SUBSECTION: Hydrogen Molecule}}
\DoxyCodeLine{320     \textcolor{comment}{! -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{321 }
\DoxyCodeLine{322         \textcolor{keywordflow}{case}(\textcolor{stringliteral}{'H2'})}
\DoxyCodeLine{323 }
\DoxyCodeLine{324             \textcolor{comment}{! Initialise}}
\DoxyCodeLine{325             \textcolor{keyword}{allocate}(h2\_param\_a\_array(int(h2\%bond(3))))}
\DoxyCodeLine{326             \textcolor{keyword}{allocate}(h2\_param\_beta\_array(int(h2\%bond(3))))}
\DoxyCodeLine{327             \textcolor{keyword}{allocate}(energies(int(h2\%bond(3))))}
\DoxyCodeLine{328             \textcolor{keyword}{allocate}(variances(int(h2\%bond(3))))}
\DoxyCodeLine{329             \textcolor{keyword}{allocate}(accept\_rates(int(h2\%bond(3))))}
\DoxyCodeLine{330             h2\_param\_beta\_guess = h2\%beta}
\DoxyCodeLine{331 }
\DoxyCodeLine{332             \textcolor{comment}{! Print out system info.}}
\DoxyCodeLine{333             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Doing VQMC runs across ', I7, ' bond lengths.')"{}}) int(h2\%bond(3))}
\DoxyCodeLine{334             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Steps: ', I10, ', Burn Steps: ', I7, ', Thin Every ', I7, ' Steps.')"{}}) \&}
\DoxyCodeLine{335                     h2\%steps, h2\%burn\_step, h2\%thin\_step}
\DoxyCodeLine{336                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{337 }
\DoxyCodeLine{338             \textcolor{comment}{! Set up bond length array}}
\DoxyCodeLine{339             bonds = linspace(h2\%bond(1), h2\%bond(2), h2\%bond(3))}
\DoxyCodeLine{340             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{341                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of bond lengths: ')"{}})}
\DoxyCodeLine{342                 \textcolor{keywordflow}{do} i = 1, int(h2\%bond(3))}
\DoxyCodeLine{343                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Bond length ', I4, ': ', F7.4)"{}}) i, bonds(i)}
\DoxyCodeLine{344 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{345                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{346 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{347 }
\DoxyCodeLine{348             \textcolor{comment}{! Set up parameter array, if doing a grid search}}
\DoxyCodeLine{349             \textcolor{keywordflow}{if} (h2\%auto\_params .eqv. .false.) \textcolor{keywordflow}{then}}
\DoxyCodeLine{350                 p\_arr = linspace(h2\%c1(1), h2\%c1(2), h2\%c1(3))}
\DoxyCodeLine{351                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{352                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{353                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{354                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Grid search across linearly spaced parameters enabled.')"{}})}
\DoxyCodeLine{355                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Array of beta values: ')"{}})}
\DoxyCodeLine{356                     \textcolor{keywordflow}{do} i = 1, int(h2\%c1(3))}
\DoxyCodeLine{357                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(F12.8)"{}}) p\_arr(i)}
\DoxyCodeLine{358 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{359                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{360 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{361             \textcolor{keywordflow}{else}}
\DoxyCodeLine{362                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{363                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{364                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{365                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('Automatic search across parameters enabled.')"{}})}
\DoxyCodeLine{366                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{367 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{368 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{369 }
\DoxyCodeLine{370             \textcolor{comment}{! Sort out restarting}}
\DoxyCodeLine{371             \textcolor{keywordflow}{if} (run\_restart) \textcolor{keywordflow}{then}}
\DoxyCodeLine{372                 \textcolor{comment}{! Insert optimised parameters and energies into arrays}}
\DoxyCodeLine{373 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{374 }
\DoxyCodeLine{375             \textcolor{comment}{! Set up printed output for the loop.}}
\DoxyCodeLine{376             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{377             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('Bond Length    Converged?    Optimised Beta    Energy')"{}})}
\DoxyCodeLine{378             \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{379                 \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Begin VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{380 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{381 }
\DoxyCodeLine{382             \textcolor{comment}{! Loop over bond lengths}}
\DoxyCodeLine{383             \textcolor{keywordflow}{do} b = 1, int(h2\%bond(3))}
\DoxyCodeLine{384 }
\DoxyCodeLine{385                 \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{386                     \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}('  -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Bond Length = ', F7.4, ' -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/  ')"{}}) \&}
\DoxyCodeLine{387                         bonds(b)}
\DoxyCodeLine{388 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{389 }
\DoxyCodeLine{390                 \textcolor{comment}{! Calculate parameter a at this bond length by Newton-\/Raphson iteration.}}
\DoxyCodeLine{391                 h2\_param\_a = h\_2\_cusp(bonds(b))}
\DoxyCodeLine{392 }
\DoxyCodeLine{393                 \textcolor{comment}{! Main VQMC callers}}
\DoxyCodeLine{394                 \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{395                     \textcolor{comment}{! Either iterate through beta values, or automatically search for best c.}}
\DoxyCodeLine{396                     \textcolor{keywordflow}{if} (h2\%auto\_params) \textcolor{keywordflow}{then} \textcolor{comment}{! ie. if auto searching}}
\DoxyCodeLine{397 }
\DoxyCodeLine{398                         \textcolor{comment}{! Solve value of beta at this bond length.}}
\DoxyCodeLine{399                         \textcolor{keyword}{call }auto\_h\_2(h2\_param\_a, h2\_param\_beta\_guess, bonds(b), h2\_param\_beta\_opt, \&}
\DoxyCodeLine{400                             energy, variance, accept\_rate, h2\_beta\_converged)}
\DoxyCodeLine{401 }
\DoxyCodeLine{402                         \textcolor{comment}{! Use current optimised value of beta as guess for next bond length's beta,}}
\DoxyCodeLine{403                         \textcolor{comment}{! provided calculations converged this loop}}
\DoxyCodeLine{404                         \textcolor{keywordflow}{if} (h2\_beta\_converged .eq. \textcolor{stringliteral}{'Y'}) h2\_param\_beta\_guess = h2\_param\_beta\_opt}
\DoxyCodeLine{405 }
\DoxyCodeLine{406                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{407                         h2\_param\_a\_array(b) = h2\_param\_a}
\DoxyCodeLine{408                         h2\_param\_beta\_array(b) = h2\_param\_beta\_opt}
\DoxyCodeLine{409                         energies(b) = energy}
\DoxyCodeLine{410                         variances(b) = variance}
\DoxyCodeLine{411                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{412                     }
\DoxyCodeLine{413                     \textcolor{keywordflow}{else} \textcolor{comment}{! ie. if doing a grid search}}
\DoxyCodeLine{414 }
\DoxyCodeLine{415                         \textcolor{comment}{! Get best value of beta at this bond length}}
\DoxyCodeLine{416                         \textcolor{keyword}{call }grid\_h\_2(h2\_param\_a, p\_arr, bonds(b), h2\_param\_beta\_opt, energy, \&}
\DoxyCodeLine{417                         variance, accept\_rate)}
\DoxyCodeLine{418 }
\DoxyCodeLine{419                         \textcolor{comment}{! Append energy and parameters to arrays}}
\DoxyCodeLine{420                         h2\_param\_a\_array(b) = h2\_param\_a}
\DoxyCodeLine{421                         h2\_param\_beta\_array(b) = h2\_param\_beta\_opt}
\DoxyCodeLine{422                         energies(b) = energy}
\DoxyCodeLine{423                         variances(b) = variance}
\DoxyCodeLine{424                         accept\_rates(b) = accept\_rate}
\DoxyCodeLine{425 }
\DoxyCodeLine{426 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{427 }
\DoxyCodeLine{428                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{429                     \textcolor{comment}{! Run equilibrations}}
\DoxyCodeLine{430                     \textcolor{keyword}{call }equil\_h\_2(h2\_param\_a, p\_arr, bonds(b), b)}
\DoxyCodeLine{431 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{432 }
\DoxyCodeLine{433 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{434 }
\DoxyCodeLine{435             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ End VQMC Runs -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/')"{}})}
\DoxyCodeLine{436             \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}('')"{}})}
\DoxyCodeLine{437 }
\DoxyCodeLine{438             \textcolor{comment}{! If not in equilibration mode, write results}}
\DoxyCodeLine{439             \textcolor{keywordflow}{if} (.not. run\_equil) \textcolor{keywordflow}{then}}
\DoxyCodeLine{440                 \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF output file '}, \&}
\DoxyCodeLine{441                     outfile}
\DoxyCodeLine{442                     \textcolor{keywordflow}{if} (write\_log) \textcolor{keywordflow}{then}}
\DoxyCodeLine{443                         \textcolor{keyword}{write}(logid, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{'Calculations finished, writing results to NetCDF \&}}
\DoxyCodeLine{444 \textcolor{stringliteral}{}\textcolor{stringliteral}{                            \&output file '}, outfile}
\DoxyCodeLine{445 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{446 }
\DoxyCodeLine{447                     \textcolor{keyword}{call }write\_h2\_main(h2\_param\_a\_array, h2\_param\_beta\_array, bonds, \&}
\DoxyCodeLine{448                         energies, variances, outfile, ierr, h2, accept\_rates)}
\DoxyCodeLine{449 }
\DoxyCodeLine{450 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{451 }
\DoxyCodeLine{452         \textcolor{comment}{! Default case, for if none of the cases match. Should be invalidated by checks in input\_parser.}}
\DoxyCodeLine{453 \textcolor{keywordflow}{        case default}}
\DoxyCodeLine{454             error stop \textcolor{stringliteral}{'Unknown case. How did you get here?'}}
\DoxyCodeLine{455 \textcolor{keywordflow}{    end select}}
\DoxyCodeLine{456 }
\DoxyCodeLine{457     \textcolor{keywordflow}{if} (write\_log) \textcolor{keyword}{close}(logid)}
\DoxyCodeLine{458 }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{driver_8f90_aae94725eafaedc467ab9bfefcae9769e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=195pt]{driver_8f90_aae94725eafaedc467ab9bfefcae9769e_icgraph}
\end{center}
\end{figure}
